1.springcloudçš„å­¦ä¹ ï¼šå‚è€ƒçº¯æ´çš„å¾®ç¬‘ï¼šhttp://www.ityouknow.com/spring-cloud.html
    1ç”¨äºå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿ,å…¶ä¸­çš„å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ï¼š
        1.æœåŠ¡å‘ç°æ³¨å†Œ:(Spring Cloud Netflix)
            Netflix Eureka: (æœåŠ¡ä¸­å¿ƒã€‚å®ç°äº‘ç«¯ä¸­é—´å±‚æœåŠ¡å‘ç°)
            Netflix Hystrix: (ç†”æ–­å™¨,å®¹é”™ç®¡ç†å·¥å…·ã€‚å½“æŸä¸ªæœåŠ¡æ•…éšœæ—¶,ä¸‹çº¿æœåŠ¡ä¿è¯æ•´ä½“æœåŠ¡ä¸é˜»å¡)
            Netflix Zuul: (äº‘ç«¯è·¯ç”±å™¨ã€‚urlè¯·æ±‚çš„æ‹¦æˆªä¸å¤„ç†,å¯¹è¯·æ±‚çš„æœåŠ¡ç›´æ¥å¼•å¯¼åˆ°å¯¹åº”æœåŠ¡åŒº)
            Netflix Archaius:(é…ç½®ç®¡ç†çš„APIã€‚é…ç½®å¾ˆå¤šä¸œè¥¿ï¼Œèƒ½å¤ŸåŠ¨æ€è·å–é…ç½®ï¼Œæ— éœ€é‡å¯)
        2.é…ç½®ä¸­å¿ƒï¼š(Spring Cloud Config)
            é›†ä¸­åŒ–ç®¡ç†é›†ç¾¤é…ç½®ã€‚å¯ä»¥æŠŠé…ç½®æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨,ç›®å‰æ”¯æŒæœ¬åœ°å­˜å‚¨,Gitä»¥åŠSubversionã€‚
        3.æ¶ˆæ¯æ€»çº¿ï¼š(Spring Cloud Bus)
            ç¡®ä¿å„ä¸ªæœåŠ¡é—´çš„æ¶ˆæ¯ç•…é€šã€‚ç”¨äºåœ¨é›†ç¾¤ä¸­ä¼ æ’­çŠ¶æ€å˜åŒ–ï¼Œå¯ä¸Spring Cloud Configè”åˆå®ç°çƒ­éƒ¨ç½²
        4.è´Ÿè½½å‡è¡¡ï¼š(Spring Cloud Cluster)
            å–ä»£Spring Integrationã€‚æä¾›åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é›†ç¾¤æ‰€éœ€è¦çš„åŸºç¡€åŠŸèƒ½æ”¯æŒï¼Œ
            å¦‚ï¼šé€‰ä¸¾ã€é›†ç¾¤çš„çŠ¶æ€ä¸€è‡´æ€§ã€å…¨å±€é”ã€tokensç­‰å¸¸è§çŠ¶æ€æ¨¡å¼çš„æŠ½è±¡å’Œå®ç°ã€‚
        5.æ–­è·¯å™¨:
        6.æ•°æ®ç›‘æ§ï¼š(Spring Cloud Sleuth)
            æ—¥å¿—æ”¶é›†ã€‚åˆ†å¸ƒå¼è¿½è¸ªè§£å†³æ–¹æ¡ˆ
        å…¶ä»–ï¼š
            Spring Cloud for Cloud Foundryï¼š (å¼€æºPaasäº‘å¹³å°çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆ,èƒ½å¤Ÿå¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•åº”ç”¨ç¨‹åº)
            Spring Cloud Consul: (æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°ä¸é…ç½®å·¥å…·ï¼Œä¸Dockerå®¹å™¨å¯ä»¥æ— ç¼é›†æˆ)
            Spring Cloud Security: (å®‰å…¨æ§åˆ¶,ä¸åŒæƒé™è®¿é—®ä¸åŒæœåŠ¡)
            Spring Cloud Data Flowï¼š
                (åˆ†å¸ƒå¼æµå¤„ç†å’Œæ‰¹å¤„ç†æ•°æ®é€šé“çš„å®ç°ã€‚æ•°æ®æŠ½å–,å®æ—¶åˆ†æ,å’Œæ•°æ®å¯¼å…¥/å¯¼å‡ºã€‚åˆ›å»ºå’Œç¼–é…æ•°æ®é€šé“ ï¼ˆdata pipelinesï¼‰ã€‚)
            Spring Cloud Streamï¼š(æ˜¯ä¸€ä¸ªåˆ›å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡åº”ç”¨çš„æ¡†æ¶ã€‚å®ç°ä»»åŠ¡ä¹‹é—´çš„äº‹ä»¶è§¦å‘æœºåˆ¶)
            Spring Cloud Taskï¼š(çŸ­å‘½å¾®æœåŠ¡çš„ä»»åŠ¡ç®¡ç†ï¼Œä»»åŠ¡è°ƒåº¦çš„å·¥ä½œã€‚ç±»ä¼¼äºå®šæ—¶ä»»åŠ¡)
            Spring Cloud Zookeeperï¼š(åˆ†å¸ƒå¼çš„æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†,å°è£…å¤æ‚ä¸šåŠ¡æä¾›ç®€å•æ¥å£ã€‚é…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡)
            Spring Cloud Connectorsï¼š(æä¾›åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„è¿æ¥)
            Spring Cloud Starters: (æä¾›å¼€ç®±å³ç”¨çš„ä¾èµ–ç®¡ç†,ç±»ä¼¼äºmaven)
            Spring Cloud CLIï¼š(å‘½ä»¤è¡Œæ–¹å¼å¿«é€Ÿå»ºç«‹äº‘ç»„ä»¶)

    2.å’Œspringbootå…³ç³»ï¼š(ä¾èµ–å…³ç³»ã€‚spring -> spring boot > Spring Cloud è¿™æ ·çš„å…³ç³»)
        spring:IoC,Beanç»„ä»¶ç®¡ç†
        springboot: (å¿«é€Ÿå¼€å‘å•ä¸ªå¾®æœåŠ¡)
        springcloud: (å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶)

    3.springcloudçš„ä¼˜åŠ¿ï¼š(å¾®æœåŠ¡æ¡†æ¶æœ‰dubbo,Kubernetes,Spring Cloud)
        1.å±äºspringå®¶æ—,springä¼ä¸šå æ¯”å¤§ï¼Œåç»­çš„ç»´æŠ¤å‡çº§ç©ºé—´å¤§ã€‚
        2.ä½œä¸ºç»„ä»¶springbootçš„åŠŸèƒ½å¼ºå¤§
        3.å¾®æœåŠ¡æ–¹é¢çš„æ²»ç†è€ƒè™‘å…¨é¢,
        4.æ•™ç¨‹å¾ˆå¤š,ä»£ç ç®€å•ã€‚
        5.æˆæœ¬ä½,å’Œdockerå…¼å®¹,åœ¨äº‘å¤„ç†æ–¹é¢æœ‰ä¸€å¸­ä¹‹åœ°

    4.å¸¸ç”¨çš„ç»„ä»¶ï¼š(springcloudæ˜¯åŸºäºnetflixçš„å¼€æºæ¡†æ¶)
        1.Eurekaï¼š(æœåŠ¡æ³¨å†Œå’Œå‘ç°,c/sæ¶æ„,å®ƒåº”è¯¥æ˜¯èƒ½å¤ŸçŸ¥é“å“ªäº›æœåŠ¡æ˜¯æ­£å¸¸çš„ï¼Œå“ªäº›æœåŠ¡æ˜¯å¼‚å¸¸çš„,å¾®é¡µé¢æŸ¥çœ‹æœåŠ¡è¿è¡Œæƒ…å†µï¼Œæš‚æ—¶æ— é€šçŸ¥)
            åœ¨AWSäº‘ä¸­ä½¿ç”¨, å®šä½æœåŠ¡æ¥è¿›è¡Œä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚
            Server: ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ç±»ä¼¼äºå¤§ç®¡å®¶
            Client: æ¥åˆ°Eureka Server,å¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚ä½¿Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
            1.åŸºæœ¬æ¶æ„ï¼š
                Eureka Server: æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°
                    1.åœ¨pom.xmlä¸­æ·»åŠ spring-cloud-starterå’Œspring-cloud-starter-eureka-server.ä¸€å®šè¦å†™ç‰ˆæœ¬å·.springbootçš„ç‰ˆæœ¬æ˜¯1.5.3å‘è¡Œç‰ˆ
                    2.åœ¨å¯åŠ¨ç±»å¢åŠ @EnableEurekaServer
                    3.åœ¨Application.propertiesä¸­é…ç½®æ¨¡å—åå­—ï¼Œç«¯å£ï¼Œä¸æ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤çš„æœåŠ¡å™¨åœ°å€
                Service Provider: å°†è‡ªèº«æœåŠ¡æ³¨å†Œåˆ°Eurekaï¼Œä»è€Œä½¿æœåŠ¡æ¶ˆè´¹æ–¹èƒ½å¤Ÿæ‰¾åˆ°
                Service Consumer: ä»Eureka Serverè·å–æ³¨å†ŒæœåŠ¡åˆ—è¡¨ï¼Œä»è€Œèƒ½å¤Ÿæ¶ˆè´¹æœåŠ¡
            2.é›†ç¾¤æ“ä½œ: (å¤šä¸ªæ³¨å†Œä¸­å¿ƒ,æœ€å¥½æ˜¯å¤šå°æœºå™¨æµ‹è¯•)
                Eurekaé€šè¿‡äº’ç›¸æ³¨å†Œçš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²ï¼Œé…ç½®å¤šä¸ªserviceUrl
                ä¸¤ä¸ªserverç»“ç‚¹çš„é…ç½®ï¼š(ä¸æ¨è)
                    æ¯ä¸ªç»“ç‚¹åˆ›å»º1ä¸ªapplication-???.propertiesæ–‡ä»¶ã€‚å†…å®¹ä¸­å°†éœ€è¦æ³¨å†Œçš„æœåŠ¡æŒ‡å‘åˆ«å¤„åå­—
                    å› ä¸ºæ˜¯åŒä¸€å°æœºå™¨ï¼Œæ‰€ä»¥éœ€è¦ ä¿®æ”¹hostsæ–‡ä»¶ä¿®æ”¹127.0.0.1 peer1å’Œ127.0.0.1 peer2
                    æ‰“åŒ…é¡¹ç›®å¹¶å¯åŠ¨é¡¹ç›®ï¼š
                        java -jar xx.jar --spring.profiles.active=peer1
                        java -jar xx.jar --spring.profiles.active=peer2
                å¤šä¸ªserverç»“ç‚¹çš„é…ç½®ï¼š(ymlæ–‡ä»¶é…ç½®)
                    åœ¨ymlæ–‡ä»¶ä¸­å¤šæ¬¡é…ç½®ç›¸åŒå‚æ•°ï¼Œå–å€¼ä¸åŒ
                    ---åœ¨ymlä¸­è¡¨ç¤ºæ–‡æ¡£åˆ†å‰²çº¿
                    åŒä¸€å°ç”µè„‘é…ç½®æ—¶ï¼Œéœ€è¦ä¿®æ”¹hostsæ–‡ä»¶çš„æ˜ å°„,(æœ¬æœºæµ‹è¯•æ²¡æœ‰æˆåŠŸï¼Œä¸çŸ¥åŸå› ......)
                    ç‰¹æ®Šå¯åŠ¨ï¼š   java -jar xx.jar --spring.profiles.active=peer3
                                java -jar xx.jar --spring.profiles.active=peer4
                                java -jar xx.jar --spring.profiles.active=peer5
        2.FeignæœåŠ¡çš„æä¾›å’Œæ¶ˆè´¹ï¼š
            æœåŠ¡æä¾›è€…å®ç°ï¼š
                1.åœ¨pomä¸­å¢åŠ spring-cloud-starter-eurekaå’Œspring-cloud-dependencies
                2.åœ¨å¯åŠ¨ç±»å¢åŠ @EnableEurekaServer
                3.åœ¨application.propertiesé…ç½®æœåŠ¡ä¸­å¿ƒåœ°å€,é»˜è®¤æ³¨å†ŒæœåŠ¡
                4.controllerå®ç°æ¥å£
            æœåŠ¡çš„æ¶ˆè´¹è€…å®ç°ï¼šfeignè°ƒç”¨å®ç°
                1.åœ¨pomä¸­å¢åŠ spring-cloud-starter-eurekaå’Œspring-cloud-dependencieså’Œspring-cloud-starter-feign
                2.åœ¨å¯åŠ¨ç±»å¢åŠ @EnableEurekaServerå’Œ@EnableFeignClients(è¿œç¨‹è°ƒç”¨)
                3.ä½¿ç”¨Feignå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¹¶å£°æ˜æœåŠ¡æ–¹æ˜¯è°ï¼Œå†åœ¨æ¥å£ä¸­å®šä¹‰urlè·¯å¾„æ–¹æ³•ï¼Œä»¥ä¾¿è°ƒç”¨å¯¹åº”åå­—æœåŠ¡
                4.åˆ›å»ºcontrollerï¼Œæ³¨å…¥Feignæ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è°ƒç”¨è¿œç«¯æ–¹æ³•
                5.åœ¨feignæ¥å£å’ŒæœåŠ¡æ¥å£ï¼Œä¸€å®šè¦å£°æ˜å‚æ•°åå­—@RequestParam("")
            æœåŠ¡çš„è´Ÿè½½å‡è¡¡,æ¢ä¸€ä¸‹æœåŠ¡æä¾›æ–¹çš„ç«¯å£ç»§ç»­æ³¨å†Œå°±å¯ä»¥äº†ã€‚

        3.ç†”æ–­å™¨(CircuitBreaker):(é˜²æ­¢æœåŠ¡æä¾›æ–¹çš„ä¸­æ–­å¯¼è‡´çš„é›ªå´©ã€‚æ‰€æœ‰ç›¸åŒæ¥å£æœåŠ¡å´©æºƒäº†ï¼Œæ‰ä¼šè°ƒç”¨å¯¹åº”çš„å›è°ƒæ–¹æ³•)
            å¼€å…³è½¬æ¢é€»è¾‘ï¼š(é˜ˆå€¼ä¸€èˆ¬ä¸º50%,æ—¶é—´çª—å£é»˜è®¤ä¸º5ç§’)
                1.å…³é—­çŠ¶æ€æ—¶ï¼š
                    å°è¯•callservice,æˆåŠŸ,è®¾ç½®å…³é—­çŠ¶æ€
                    å°è¯•callservice,å¤±è´¥ä½†ä½äºå¼€å…³çš„é˜ˆå€¼ï¼Œè¿˜æ˜¯è®¾ç½®å…³é—­çŠ¶æ€
                    å°è¯•callservice,å¤±è´¥ä¸”åˆ°è¾¾å¼€å…³çš„é˜ˆå€¼,è®¾ç½®ä¸ºæ‰“å¼€çŠ¶æ€
                2.æ‰“å¼€çŠ¶æ€æ—¶ï¼š
                    ç­‰å¾…ç†”æ–­å™¨æ—¶é—´çª—å£ç»“æŸ,è®¾ç½®ä¸ºåŠæ‰“å¼€çŠ¶æ€
                3.åŠæ‰“å¼€çŠ¶æ€ï¼š
                    å°è¯•callservice,å¤±è´¥ï¼Œè®¾ç½®ä¸ºæ‰“å¼€çŠ¶æ€
                    å°è¯•callservice,æˆåŠŸï¼Œè®¾ç½®ä¸ºå…³é—­çŠ¶æ€
            Hystrixç‰¹æ€§ï¼š(ä½œç”¨åœ¨æ¶ˆè´¹è€…ç«¯,ç¡®ä¿æ¶ˆè´¹è€…ç«¯æ­£å¸¸)
                æ–­è·¯å™¨æœºåˆ¶ï¼š(å®ç°å¼€å…³è½¬æ¢æœºåˆ¶,å¹¶ä¸”èƒ½å¤Ÿè‡ªæˆ‘æ£€æµ‹å¹¶æ¢å¤)
                Fallbackï¼š(è¯·æ±‚å¼‚å¸¸æ—¶è¿”å›é»˜è®¤å€¼æ¥å®ç°å¼€å…³çŠ¶æ€)
                èµ„æºéš”ç¦»ï¼š
                    çº¿ç¨‹æ± ï¼š(æ–°å¼€çº¿ç¨‹å°è¯•è®¿é—®,ä¸å½±å“æ­£å¸¸ä¸šåŠ¡ï¼Œä½†æœ‰ç»´æŠ¤çº¿ç¨‹æ± çš„å¼€é”€)
                    ä¿¡å·æ¨¡å¼ï¼š
            ä»£ç ä½¿ç”¨æ–¹å¼ï¼š
                1.åœ¨æ¶ˆè´¹è€…ç«¯application.propertiesè®¾ç½®ç†”æ–­å¼€å¯feign.hystrix.enabled=true
                2.åˆ›å»ºå›è°ƒç±»,é‡å†™æ¥å£çš„è¯·æ±‚å¤±è´¥æ–¹æ³•,åå­—ç›¸åŒ
                3.åœ¨è¿œç«¯è°ƒç”¨æ¥å£è®¾ç½®å›è°ƒç±»åå­—ã€‚
            ç†”æ–­ç›‘æ§Hystrix Dashboardå’ŒTurbineï¼šã€ç†”æ–­ç›‘æ§ã€‘
                å®ƒæ˜¯é’ˆå¯¹Hystrixè¿›è¡Œå®æ—¶ç›‘æ§çš„å·¥å…·ï¼ŒTurbineå°†å¤šä¸ªæœåŠ¡çš„æ•°æ®æ±‡æ€»å¹¶æ˜¾ç¤ºåˆ°Hystrix Dashboard
                jaråŒ…ä¾èµ–ï¼š<dependency>
                            <groupId>org.springframework.cloud</groupId>
                            <artifactId>spring-cloud-starter-hystrix</artifactId>
                          </dependency>
                          <dependency>
                            <groupId>org.springframework.cloud</groupId>
                            <artifactId>spring-cloud-starter-hystrix-dashboard</artifactId>
                          </dependency>
                          <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-starter-actuator</artifactId>
                          </dependency>
                å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableHystrixDashboard
                æ£€æŸ¥ï¼šhttpï¼š//localhost:9001/hystrix

                Netflixæä¾›å¼€æºé¡¹ç›®TurbineæŠŠå¤šä¸ªhystrix.streamçš„å†…å®¹èšåˆä¸ºä¸€ä¸ªæ•°æ®æºä¾›Dashboardå±•ç¤ºï¼š
                    jaråŒ…ä¾èµ–ï¼š<dependencies>
                                <dependency>
                                    <groupId>org.springframework.cloud</groupId>
                                    <artifactId>spring-cloud-starter-turbine</artifactId>
                                </dependency>
                                <dependency>
                                    <groupId>org.springframework.cloud</groupId>
                                    <artifactId>spring-cloud-netflix-turbine</artifactId>
                                </dependency>
                                <dependency>
                                    <groupId>org.springframework.boot</groupId>
                                    <artifactId>spring-boot-starter-actuator</artifactId>
                                </dependency>
                                <dependency>
                                    <groupId>org.springframework.cloud</groupId>
                                    <artifactId>spring-cloud-starter-hystrix-dashboard</artifactId>
                                </dependency>
                              </dependencies>
                    é…ç½®æ–‡ä»¶ï¼š
                        spring.application.name=hystrix-dashboard-turbine
                        server.port=8001
                        turbine.appConfig=node01,node02
                        turbine.aggregator.clusterConfig= default    //æŒ‡å®šèšåˆå“ªäº›é›†ç¾¤,å¤šä¸ªä½¿ç”¨â€,â€åˆ†å‰²ï¼Œé»˜è®¤ä¸ºdefault
                        turbine.clusterNameExpression= new String("default")
                        eureka.client.serviceUrl.defaultZone=http://localhost:8000/eureka/
                    å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableTurbine
        4.é…ç½®ä¸­å¿ƒgitï¼šspring cloud config
            å›½å†…å¤–çš„åŒç±»äº§å“ï¼š360çš„QConfã€æ·˜å®çš„diamondã€ç™¾åº¦çš„disconfã€Apache Commons Configurationã€ownerã€cfg4j
            åŠŸèƒ½ç‚¹ï¼šæä¾›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒ
                   é›†ä¸­ç®¡ç†å„ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ ğŸŒ¿ğŸŒ¿ğŸŒ¿
                   é…ç½®æ–‡ä»¶ä¿®æ”¹ä¹‹åï¼Œå¯ä»¥å¿«é€Ÿçš„ç”Ÿæ•ˆ ğŸŒ¿ğŸŒ¿ğŸŒ¿
                   å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†
                   æ”¯æŒå¤§çš„å¹¶å‘æŸ¥è¯¢ ğŸŒ¿ğŸŒ¿ğŸŒ¿
                   æ”¯æŒå„ç§è¯­è¨€
            æ¦‚å¿µï¼šSpring Cloud Configé¡¹ç›®æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆ
            åŸç†ï¼šåŒ…å«äº†Clientå’ŒServerä¸¤ä¸ªéƒ¨åˆ†ã€‚serveræä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ã€ä»¥æ¥å£çš„å½¢å¼å°†é…ç½®æ–‡ä»¶çš„å†…å®¹æä¾›å‡ºå»ã€‚clienté€šè¿‡æ¥å£è·å–æ•°æ®ã€å¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–è‡ªå·±çš„åº”ç”¨ã€‚
                 ä½¿ç”¨gitæˆ–è€…svnå­˜æ”¾é…ç½®æ–‡ä»¶
            æ“ä½œä¸¾ä¾‹ï¼š
                1.åœ¨gitä¸Šåˆ›æ–‡ä»¶å¤¹config-repoï¼š ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæ¥å£
                2.serverç«¯ï¼š
                    jaråŒ…ä¾èµ–ï¼š<dependencies>
                                <dependency>
                                    <groupId>org.springframework.cloud</groupId>
                                    <artifactId>spring-cloud-config-server</artifactId>
                                </dependency>
                              </dependencies>
                    é…ç½®æ–‡ä»¶ï¼š
                        server:
                          port: 8001
                        spring:
                          application:
                            name: spring-cloud-config-server
                          cloud:
                            config:
                              server:
                                git:
                                  uri: https://github.com/ityouknow/spring-cloud-starter/     # é…ç½®gitä»“åº“çš„åœ°å€
                                  search-paths: config-repo                                   # gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯ä»¥é…ç½®å¤šä¸ªåœ°å€ï¼Œç”¨,åˆ†å‰²ã€‚
                                  username:                                                   # gitä»“åº“çš„è´¦å·
                                  password:                                                   # gitä»“åº“çš„å¯†ç 
                    æœ¬åœ°å­˜å‚¨ï¼š
                        spring.profiles.active=native
                        spring.cloud.config.server.native.searchLocations=file:E:/properties/
                    å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableConfigServer
                    æ£€æŸ¥ï¼šhttp://localhost:8001/é…ç½®æ–‡ä»¶å/profileå
                    é…ç½®æ–‡ä»¶çš„è½¬åŒ–è§„åˆ™ï¼š
                        /{application}/{profile}[/{label}]
                        /{application}-{profile}.yml
                        /{label}/{application}-{profile}.yml
                        /{application}-{profile}.properties
                        /{label}/{application}-{profile}.properties
                        æ¯”å¦‚ï¼šneo-config-dev.propertiesä¸ºä¾‹å­ã€‚å®ƒçš„applicationæ˜¯neo-configï¼Œprofileæ˜¯dev
                3.clientç«¯ï¼š
                    jaråŒ…ä¾èµ–ï¼š<dependencies>
                                <dependency>
                                    <groupId>org.springframework.cloud</groupId>
                                    <artifactId>spring-cloud-starter-config</artifactId>
                                </dependency>
                                <dependency>
                                    <groupId>org.springframework.boot</groupId>
                                    <artifactId>spring-boot-starter-web</artifactId>
                                </dependency>
                                <dependency>
                                    <groupId>org.springframework.boot</groupId>
                                    <artifactId>spring-boot-starter-test</artifactId>
                                    <scope>test</scope>
                                </dependency>
                              </dependencies>
                    é…ç½®æ–‡ä»¶ï¼š
                        application.propertiesï¼š
                            spring.application.name=spring-cloud-config-client
                            server.port=8002
                        bootstrap.propertiesï¼š
                            spring.cloud.config.name=neo-config
                            spring.cloud.config.profile=dev
                            spring.cloud.config.uri=http://localhost:8001/
                            spring.cloud.config.label=master
                    å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableConfigServer
                    æ£€æŸ¥ï¼šç›´æ¥ä½¿ç”¨@valueå°±å¯ä»¥è·å–é…ç½®ä¸­çš„æ•°æ®
                    âš ï¸ï¼šspringbooté¡¹ç›®åªæœ‰åœ¨å¯åŠ¨çš„æ—¶å€™æ‰ä¼šè·å–é…ç½®æ–‡ä»¶çš„å€¼ï¼Œä¿®æ”¹githubä¿¡æ¯åï¼Œclientç«¯å¹¶æ²¡æœ‰å†æ¬¡å»è·å–
        5.é…ç½®ä¸­å¿ƒsvnå’Œrefreshï¼š
            jaråŒ…ä¾èµ–ï¼š<dependencies>
                        <dependency>
                            <groupId>org.springframework.cloud</groupId>
                            <artifactId>spring-cloud-config-server</artifactId>
                        </dependency>
                        <dependency>
                            <groupId>org.tmatesoft.svnkit</groupId>
                            <artifactId>svnkit</artifactId>
                        </dependency>
                      </dependencies>
            é…ç½®æ–‡ä»¶ï¼š
                server:
                  port: 8001
                spring:
                  cloud:
                    config:
                      server:
                        svn:
                          uri: http://192.168.0.6/svn/repo/config-repo
                          username: username
                          password: password
                        default-label: trunk
                  profiles:
                    active: subversion
                  application:
                    name: spring-cloud-config-server
            å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableConfigServer
            refreshå®¢æˆ·ç«¯åˆ·æ–°æœºåˆ¶ï¼š å®¢æˆ·ç«¯å¹¶ä¸èƒ½ä¸»åŠ¨æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–ï¼Œä»è€Œä¸»åŠ¨å»è·å–æ–°çš„é…ç½®ã€‚æ¯ä¸ªå®¢æˆ·ç«¯é€šè¿‡POSTæ–¹æ³•è§¦å‘å„è‡ªçš„/refreshã€‚
                jaråŒ…ä¾èµ–ï¼š<dependency>
                             <groupId>org.springframework.boot</groupId>
                             <artifactId>spring-boot-starter-actuator</artifactId>
                          </dependency>
                          å®ƒæ˜¯ä¸€ä¸ªç›‘æ§åŠŸèƒ½ï¼Œå…¶ä¸­æœ‰refreshåŠŸèƒ½
                å¼€å¯æ›´æ–°æœºåˆ¶ï¼šéœ€è¦ç»™åŠ è½½å˜é‡çš„ç±»ä¸Šé¢åŠ è½½@RefreshScopeï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ/refreshçš„æ—¶å€™å°±ä¼šæ›´æ–°æ­¤ç±»ä¸‹é¢çš„å˜é‡å€¼ã€‚ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                å®‰å…¨è®¤è¯ï¼šapplication.propertiesä¸‹æš‚æ—¶è§£é™¤å®‰å…¨è®¤è¯ management.security.enabled=false

                ä½¿ç”¨githubçš„webhookè‡ªåŠ¨åˆ·æ–°å®¢æˆ·ç«¯çš„é…ç½®ï¼š
                    æ¦‚å¿µï¼šWebHookæ˜¯å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶,é€šè¿‡å‘é€http postè¯·æ±‚çš„æ–¹å¼æ¥é€šçŸ¥ä¿¡æ¯æ¥æ”¶æ–¹ã€‚ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                        Payload URLï¼šè§¦å‘åå›è°ƒçš„URL
                        Content typeï¼šæ•°æ®æ ¼å¼,ä¸¤ç§ä¸€èˆ¬ä½¿ç”¨json
                        Secretï¼šç”¨ä½œç»™POSTçš„bodyåŠ å¯†çš„å­—ç¬¦ä¸²ã€‚é‡‡ç”¨HMACç®—æ³•
                        eventsï¼šè§¦å‘çš„äº‹ä»¶åˆ—è¡¨ã€‚push/create/delete
        6.é…ç½®ä¸­å¿ƒæœåŠ¡åŒ–å’Œé«˜å¯ç”¨ï¼šæ¢ä¸ªç«¯å£å†é…ç½®ä¸€ä¸ªEurekaæœåŠ¡å™¨å®Œæˆé«˜å¯ç”¨åŠŸèƒ½
            å°†serverç«¯å½“åšä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°eurekaä¸­ï¼Œclientç«¯å»eurekaä¸­å»è·å–é…ç½®ä¸­å¿ƒserverç«¯çš„æœåŠ¡æ—¢å¯
            serverç«¯æ”¹é€ ï¼š
                <dependencies>
                	<dependency>
                		<groupId>org.springframework.cloud</groupId>
                		<artifactId>spring-cloud-config-server</artifactId>
                	</dependency>
                	<dependency>
                		<groupId>org.springframework.cloud</groupId>
                		<artifactId>spring-cloud-starter-eureka</artifactId>
                	</dependency>
                </dependencies>
                é…ç½®æ–‡ä»¶ï¼š
                    server:
                    server:
                      port: 8001
                    spring:
                      application:
                        name: spring-cloud-config-server
                      cloud:
                        config:
                          server:
                            git:
                              uri: https://github.com/ityouknow/spring-cloud-starter/     # é…ç½®gitä»“åº“çš„åœ°å€
                              search-paths: config-repo                             # gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼Œç”¨,åˆ†å‰²ã€‚
                              username: username                                        # gitä»“åº“çš„è´¦å·
                              password: password                                    # gitä»“åº“çš„å¯†ç 
                    eureka:
                      client:
                        serviceUrl:
                          defaultZone: http://localhost:8000/eureka/   ## æ³¨å†Œä¸­å¿ƒeurkaåœ°å€
                å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient
            å®¢æˆ·ç«¯æ”¹é€ ï¼š
                <dependencies>
                	<dependency>
                		<groupId>org.springframework.cloud</groupId>
                		<artifactId>spring-cloud-starter-config</artifactId>
                	</dependency>
                	<dependency>
                		<groupId>org.springframework.boot</groupId>
                		<artifactId>spring-boot-starter-web</artifactId>
                	</dependency>
                	<dependency>
                		<groupId>org.springframework.cloud</groupId>
                		<artifactId>spring-cloud-starter-eureka</artifactId>
                	</dependency>
                	<dependency>
                		<groupId>org.springframework.boot</groupId>
                		<artifactId>spring-boot-starter-test</artifactId>
                		<scope>test</scope>
                	</dependency>
                </dependencies>
                é…ç½®æ–‡ä»¶ï¼š
                    spring.application.name=spring-cloud-config-client
                    server.port=8002
                    spring.cloud.config.name=neo-config
                    spring.cloud.config.profile=dev
                    spring.cloud.config.label=master
                    spring.cloud.config.discovery.enabled=true
                    spring.cloud.config.discovery.serviceId=spring-cloud-config-server
                    eureka.client.serviceUrl.defaultZone=http://localhost:8000/eureka/
                å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient
        7.é…ç½®ä¸­å¿ƒå’Œæ¶ˆæ¯æ€»çº¿ï¼šé…ç½®ä¸­å¿ƒç»ˆç»“ç‰ˆ ä½¿ç”¨Spring cloud bus è§£å†³è‡ªåŠ¨åˆ·æ–°å¤§é‡é…ç½®
            Spring cloud busé€šè¿‡è½»é‡æ¶ˆæ¯ä»£ç†è¿æ¥å„ä¸ªåˆ†å¸ƒçš„èŠ‚ç‚¹ã€‚ç›®å‰å”¯ä¸€å®ç°çš„æ–¹å¼æ˜¯ç”¨AMQPæ¶ˆæ¯ä»£ç†ä½œä¸ºé€šé“ã€‚
            Spring Cloud Busåšé…ç½®æ›´æ–°çš„æ­¥éª¤: ã€æœ¬è´¨æ˜¯æ¶ˆæ¯çš„å¹¿æ’­ã€‘ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                1ã€æäº¤ä»£ç è§¦å‘postç»™å®¢æˆ·ç«¯Aå‘é€bus/refresh
                2ã€å®¢æˆ·ç«¯Aæ¥æ”¶åˆ°è¯·æ±‚ä»Serverç«¯æ›´æ–°é…ç½®å¹¶ä¸”å‘é€ç»™Spring Cloud Bus
                3ã€Spring Cloud busæ¥åˆ°æ¶ˆæ¯å¹¶é€šçŸ¥ç»™å…¶å®ƒå®¢æˆ·ç«¯
                4ã€å…¶å®ƒå®¢æˆ·ç«¯æ¥æ”¶åˆ°é€šçŸ¥ï¼Œè¯·æ±‚Serverç«¯è·å–æœ€æ–°é…ç½®
                5ã€å…¨éƒ¨å®¢æˆ·ç«¯å‡è·å–åˆ°æœ€æ–°çš„é…ç½®
            jaråŒ…ä¾èµ–ï¼š<dependency>
                       <groupId>org.springframework.cloud</groupId>
                       <artifactId>spring-cloud-starter-bus-amqp</artifactId>
                      </dependency>
            é…ç½®æ–‡ä»¶ï¼š
                ## åˆ·æ–°æ—¶ï¼Œå…³é—­å®‰å…¨éªŒè¯
                management.security.enabled=false
                ## å¼€å¯æ¶ˆæ¯è·Ÿè¸ª
                spring.cloud.bus.trace.enabled=true
                spring.rabbitmq.host=192.168.9.89
                spring.rabbitmq.port=5672
                spring.rabbitmq.username=admin
                spring.rabbitmq.password=123456
            åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯bus/refresh,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®çš„ç›®çš„
            æ”¹è¿›ç‰ˆæœ¬ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                1ã€æäº¤ä»£ç è§¦å‘postè¯·æ±‚ç»™bus/refresh
                2ã€serverç«¯æ¥æ”¶åˆ°è¯·æ±‚å¹¶å‘é€ç»™Spring Cloud Bus
                3ã€Spring Cloud busæ¥åˆ°æ¶ˆæ¯å¹¶é€šçŸ¥ç»™å…¶å®ƒå®¢æˆ·ç«¯
                4ã€å…¶å®ƒå®¢æˆ·ç«¯æ¥æ”¶åˆ°é€šçŸ¥ï¼Œè¯·æ±‚Serverç«¯è·å–æœ€æ–°é…ç½®
                5ã€å…¨éƒ¨å®¢æˆ·ç«¯å‡è·å–åˆ°æœ€æ–°çš„é…ç½®

                jaråŒ…ä¾èµ–ï¼š<dependencies>
                            <dependency>
                                <groupId>org.springframework.cloud</groupId>
                                <artifactId>spring-cloud-config-server</artifactId>
                            </dependency>
                            <dependency>
                                <groupId>org.springframework.cloud</groupId>
                                <artifactId>spring-cloud-starter-bus-amqp</artifactId>
                            </dependency>
                            <dependency>
                                <groupId>org.springframework.cloud</groupId>
                                <artifactId>spring-cloud-starter-eureka</artifactId>
                            </dependency>
                          </dependencies>
                é…ç½®æ–‡ä»¶ï¼š
                    server:
                      port: 8001
                    spring:
                      application:
                        name: spring-cloud-config-server
                      cloud:
                        config:
                          server:
                            git:
                              uri: https://github.com/ityouknow/spring-cloud-starter/   # é…ç½®gitä»“åº“çš„åœ°å€
                              search-paths: config-repo                                 # gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼Œç”¨,åˆ†å‰²ã€‚
                              username: username                                        # gitä»“åº“çš„è´¦å·
                              password: password                                        # gitä»“åº“çš„å¯†ç 
                      rabbitmq:
                        host: 192.168.0.6
                        port: 5672
                        username: admin
                        password: 123456
                    eureka:
                      client:
                        serviceUrl:
                          defaultZone: http://localhost:8000/eureka/   ## æ³¨å†Œä¸­å¿ƒeurkaåœ°å€
                    management:
                      security:
                         enabled: false
            å±€éƒ¨åˆ·æ–°é…ç½®ï¼š/bus/refresh?destination=customers:8000
            è·Ÿè¸ªæ€»çº¿äº‹ä»¶ï¼šspring.cloud.bus.trace.enabled=true
            æ³¨æ„âš ï¸ï¸ï¸âš ï¸ï¸ï¸âš ï¸ï¸ï¸ï¼šæ—§ç‰ˆæœ¬çš„bus/refreshæ‰§è¡Œåï¼Œå‘é€è¯·æ±‚çš„æœåŠ¡ä¼šä»eurekaçš„æ³¨å†Œä¸­å¿ƒæ’¤é”€ã€‚è§£å†³åŠæ³•ï¼šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„spring cloud
                <properties>
                	<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
                	<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
                	<java.version>1.8</java.version>
                	<spring-cloud.version>Dalston.SR1</spring-cloud.version>
                </properties>
        8.æœåŠ¡ç½‘å…³zuul: {è·¯ç”±è½¬å‘}
            Spring Cloud Zuulå°±æ˜¯æä¾›è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€æƒé™è®¤è¯çš„ä¸€ä¸ªAPI gatewayã€‚
            Zuulæ˜¯Netflixå‡ºå“çš„ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚
            ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ï¼šnginx=åå‘ä»£ç†æœåŠ¡å™¨ï¼Œzuul=åå‘ä»£ç†ç½‘å…³ã€‚äºŒè€…æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚
            jaråŒ…ä¾èµ–ï¼š<dependency>
                        <groupId>org.springframework.cloud</groupId>
                        <artifactId>spring-cloud-starter-zuul</artifactId>
                      </dependency>
            é…ç½®æ–‡ä»¶ï¼š
                spring.application.name=gateway-service-zuul
                server.port=8888
                #è¿™é‡Œçš„é…ç½®è¡¨ç¤ºï¼Œè®¿é—®/it/** ç›´æ¥é‡å®šå‘åˆ°http://www.ityouknow.com/**
                zuul.routes.baidu.path=/it/**
                zuul.routes.baidu.url=http://www.ityouknow.com/
            å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableZuulProxy
            æœåŠ¡åŒ–ï¼š
                é€ä¸ªæ¡ç›®é…ç½®è·¯ç”±è½¬å‘æœ‰å±€é™ã€‚
                è§£å†³åŠæ³•ï¼šå°†Zuulæ³¨å†Œåˆ°eureka serverä¸Šå»å‘ç°å…¶ä»–æœåŠ¡ï¼Œå°±å¯ä»¥å®ç°å¯¹serviceIdçš„æ˜ å°„
                jaråŒ…ä¾èµ–ï¼š<dependency>
                           <groupId>org.springframework.cloud</groupId>
                           <artifactId>spring-cloud-starter-eureka</artifactId>
                          </dependency>
                é…ç½®æ–‡ä»¶ï¼š
                    spring.application.name=gateway-service-zuul
                    server.port=8888
                    zuul.routes.api-a.path=/producer/**
                    zuul.routes.api-a.serviceId=spring-cloud-producer
                    eureka.client.serviceUrl.defaultZone=http://localhost:8000/eureka/
                ç½‘å…³çš„é»˜è®¤è·¯ç”±è§„åˆ™ï¼šæœåŠ¡åæ˜ å°„è·¯ç”±
                    Zuulä¼šä»£ç†æ‰€æœ‰æ³¨å†Œåˆ°Eureka Serverçš„å¾®æœåŠ¡ï¼Œ
                    å¹¶ä¸”Zuulçš„è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼šhttp://ZUUL_HOST:ZUUL_PORT/å¾®æœåŠ¡åœ¨Eurekaä¸Šçš„serviceId/**
                    ä¼šè¢«è½¬å‘åˆ°serviceIdå¯¹åº”çš„å¾®æœåŠ¡ã€‚
            Zuulçš„æ ¸å¿ƒï¼š
                Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®ç°å¯¹å¤–æœåŠ¡çš„æ§åˆ¶ã€‚Filterçš„ç”Ÿå‘½å‘¨æœŸæœ‰4ä¸ªï¼Œåˆ†åˆ«æ˜¯â€œPREâ€ã€â€œROUTINGâ€ã€â€œPOSTâ€ã€â€œERRORâ€
                    PRE: åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚å®ç°èº«ä»½éªŒè¯
                    ROUTING: å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚
                    POST: è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚ ä¸ºå“åº”æ·»åŠ HTTP headerç­‰æ“ä½œ
                    ERROR: åœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œã€‚
                é»˜è®¤Filter:
                    preï¼š3ä¸ªã€‚æ¯”å¦‚ServletDetectionFilter
                    route: 5ä¸ªã€‚æ¯”å¦‚SimpleHostRoutingFilter
                    post: 2ä¸ªã€‚æ¯”å¦‚SendResponseFilter
                é…ç½®æ–‡ä»¶ä¸­ç¦ç”¨è¿‡æ»¤å™¨ï¼šapplication.yml
                    zuul:
                    	FormBodyWrapperFilter:
                    		pre:
                    			disable: true
                è‡ªåŠ¨ç§»Filter: ç»§æ‰¿ZuulFilterç±»ã€‚ä»£ç ä¸¾ä¾‹å¦‚ä¸‹
                    public class TokenFilter extends ZuulFilter {
                        @Override
                        public String filterType() {
                            return "pre"; // å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨
                        }
                        @Override
                        public int filterOrder() {
                            return 0; // filteræ‰§è¡Œé¡ºåºï¼Œé€šè¿‡æ•°å­—æŒ‡å®š ,ä¼˜å…ˆçº§ä¸º0ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½
                        }
                        @Override
                        public boolean shouldFilter() {
                            return true;// æ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ï¼Œæ­¤å¤„ä¸ºtrueï¼Œè¯´æ˜éœ€è¦è¿‡æ»¤
                        }
                        @Override
                        public Object run() {
                            RequestContext ctx = RequestContext.getCurrentContext();
                            HttpServletRequest request = ctx.getRequest();
                            String token = request.getParameter("token");// è·å–è¯·æ±‚çš„å‚æ•°

                            if (StringUtils.isNotBlank(token)) {
                                ctx.setSendZuulResponse(true); //å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”±
                                ctx.setResponseStatusCode(200);
                                ctx.set("isSuccess", true);
                                return null;
                            } else {
                                ctx.setSendZuulResponse(false); //ä¸å¯¹å…¶è¿›è¡Œè·¯ç”±
                                ctx.setResponseStatusCode(400);
                                ctx.setResponseBody("token is empty");
                                ctx.set("isSuccess", false);
                                return null;
                            }
                        }

                    }
                    æ·»åŠ è‡ªå®šä¹‰filteråˆ°é¡¹ç›®ï¼š
                       @Bean
                       public TokenFilter tokenFilter() {
                        return new TokenFilter();
                       }
            zuulè·¯ç”±ç†”æ–­ï¼š
                æœåŠ¡é™çº§ï¼šæœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥è¿”å›æˆ‘ä»¬é¢„è®¾çš„ä¿¡æ¯ã€‚
                ç»§æ‰¿ZuulFallbackProvideræ¥å£ï¼Œå®ç°å…¶ä¸­ç†”æ–­çš„è·¯ç”±å’Œå“åº”ã€‚æˆ–è€…ç›´æ¥ç»§æ‰¿æœ€æ–°ç‰ˆæœ¬çš„FallbackProviderã€‚ä»£ç å¦‚ä¸‹ï¼š
                    @Component
                    public class ProducerFallback implements FallbackProvider {
                        //æŒ‡å®šè¦å¤„ç†çš„ serviceã€‚
                        @Override
                        public String getRoute() {
                            return "spring-cloud-producer";
                        }
                        public ClientHttpResponse fallbackResponse() {
                            return new ClientHttpResponse() {
                                @Override
                                public HttpStatus getStatusCode() throws IOException {
                                    return HttpStatus.OK;
                                }
                                @Override
                                public int getRawStatusCode() throws IOException {
                                    return 200;
                                }
                                @Override
                                public String getStatusText() throws IOException {
                                    return "OK";
                                }
                                @Override
                                public void close() {
                                }
                                @Override
                                public InputStream getBody() throws IOException {
                                    return new ByteArrayInputStream("The service is unavailable.".getBytes());
                                }
                                @Override
                                public HttpHeaders getHeaders() {
                                    HttpHeaders headers = new HttpHeaders();
                                    headers.setContentType(MediaType.APPLICATION_JSON);
                                    return headers;
                                }
                            };
                        }
                        @Override
                        public ClientHttpResponse fallbackResponse(Throwable cause) {
                            if (cause != null && cause.getCause() != null) {
                                String reason = cause.getCause().getMessage();
                                logger.info("Excption {}",reason);
                            }
                            return fallbackResponse();
                        }
                    }
                    âš ï¸ï¼šZuulç›®å‰åªæ”¯æŒæœåŠ¡çº§åˆ«çš„ç†”æ–­ï¼Œä¸æ”¯æŒå…·ä½“åˆ°æŸä¸ªURLè¿›è¡Œç†”æ–­ã€‚
            zuulçš„è·¯ç”±é‡è¯•ï¼šä¸Spring Retryç»„åˆä½¿ç”¨
                jaråŒ…ä¾èµ–ï¼š<dependency>
                            <groupId>org.springframework.retry</groupId>
                            <artifactId>spring-retry</artifactId>
                          </dependency>
                å¼€å¯Zuul retry:
                    zuul.retryable=true #æ˜¯å¦å¼€å¯é‡è¯•åŠŸèƒ½
                    ribbon.MaxAutoRetries=2 #å¯¹å½“å‰æœåŠ¡çš„é‡è¯•æ¬¡æ•°
                    ribbon.MaxAutoRetriesNextServer=0   #åˆ‡æ¢ç›¸åŒServerçš„æ¬¡æ•°
            zuulé«˜å¯ç”¨ï¼š
                åœ¨Zuulçš„å‰ç«¯ä½¿ç”¨Nginxæˆ–è€…F5è¿›è¡Œè´Ÿè½½è½¬å‘ä»¥è¾¾åˆ°é«˜å¯ç”¨æ€§ã€‚
        9.springcloudçš„ä½¿ç”¨é€‰å‹æ€è€ƒï¼Ÿèƒ½å¤Ÿä½¿ç”¨ï¼ŸğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            ç­”ï¼šspring cloud å¿…é¡»åŸºäº spring boot
                å¸‚åœºï¼šé˜¿é‡Œï¼Œç¾å›¢
                å­¦ä¹ ï¼šçº¯æ´çš„å¾®ç¬‘
                å‰åæŒ‡è´£åˆ’åˆ†ï¼š
                    Spring Cloudåªæ˜¯åç«¯æœåŠ¡æ²»ç†çš„ä¸€å¥—æ¡†æ¶ï¼›springæ¨èä½¿ç”¨thymeleadä½œä¸ºå‰ç«¯æ¨¡ç‰ˆå¼•æ“
                    ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‰ç«¯appæˆ–è€…ç½‘é¡µé€šè¿‡zuulæ¥è°ƒç”¨åç«¯çš„æœåŠ¡ï¼Œå¦‚æœåŒ…å«é™æ€èµ„æºä¹Ÿå¯ä»¥ä½¿ç”¨nginxåšä¸€ä¸‹ä»£ç†è½¬å‘ã€‚
                æµ‹è¯•ï¼šSpring-boot-starter-testæ”¯æŒé¡¹ç›®ä¸­å„å±‚æ–¹æ³•çš„æµ‹è¯•ï¼Œä¹Ÿæ”¯æŒcontrollerå±‚çš„å„ç§å±æ€§ã€‚
                é…ç½®ï¼šæ¨èä½¿ç”¨redisç¼“å­˜æ¥åšsessionå…±äº«
                éƒ¨ç½²ï¼šjava -jar app.jar --spring.profiles.active=devå°±æ˜¯å¯åŠ¨æµ‹è¯•ç¯å¢ƒçš„é…ç½®æ–‡ä»¶
                     æ¨èä½¿ç”¨jenkinsæ¥éƒ¨ç½²Spring Booté¡¹ç›®
                å¼€å‘ï¼šSpring Cloudå’Œè€é¡¹ç›®å¯ä»¥æ··åˆä½¿ç”¨ï¼Œé€šè¿‡zuulæ¥æ”¯æŒã€‚ä¹Ÿå°±æ˜¯ç½‘å…³è·¯ç”±è½¬ç§»
                è¿ç»´ï¼šTurbineã€zipkinå¯ä»¥ç”¨æ¥åšç†”æ–­å’Œæ€§èƒ½ç›‘æ§ï¼›
                     åŠ¨æ€ä¸Šä¸‹çº¿æŸä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡jenkinsæ¥å®ç°
                     Eurekaä¼šé—´éš”ä¸€æ®µæ—¶é—´æ¥æ£€æµ‹æœåŠ¡çš„å¯ç”¨æ€§
            spring cloudæ¶æ„ï¼š
                1ã€å¤–éƒ¨æˆ–è€…å†…éƒ¨çš„éSpring Cloudé¡¹ç›®éƒ½ç»Ÿä¸€é€šè¿‡APIç½‘å…³ï¼ˆZuulï¼‰æ¥è®¿é—®å†…éƒ¨æœåŠ¡.
                2ã€ç½‘å…³æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»æ³¨å†Œä¸­å¿ƒï¼ˆEurekaï¼‰è·å–å¯ç”¨æœåŠ¡
                3ã€ç”±Ribbonè¿›è¡Œå‡è¡¡è´Ÿè½½åï¼Œåˆ†å‘åˆ°åç«¯çš„å…·ä½“å®ä¾‹
                4ã€å¾®æœåŠ¡ä¹‹é—´é€šè¿‡Feignè¿›è¡Œé€šä¿¡å¤„ç†ä¸šåŠ¡
                5ã€Hystrixè´Ÿè´£å¤„ç†æœåŠ¡è¶…æ—¶ç†”æ–­
                6ã€Turbineç›‘æ§æœåŠ¡é—´çš„è°ƒç”¨å’Œç†”æ–­ç›¸å…³æŒ‡æ ‡
        10.springcloudçš„æ¶æ„æ¼”è¿›
            ä¼ ç»Ÿæ¶æ„å‘å±•å²ï¼š
                å•ä½“æ¶æ„ï¼šå…¸å‹ä»£è¡¨å°±æ˜¯ä¸€ä¸ªåº”ç”¨ã€ä¸€ä¸ªæ•°æ®åº“ã€ä¸€ä¸ªwebå®¹å™¨å°±å¯ä»¥è·‘èµ·æ¥ã€‚ä¼˜å…ˆæ»¡è¶³å¿«é€Ÿä¸Šçº¿çš„è¦æ±‚ï¼Œä¹Ÿä¾¿äºå¿«é€Ÿè·Ÿè¿›å¸‚åœº
                å‚ç›´æ¶æ„ï¼šSSHå±‚çº§ã€‚åº”å¯¹æ›´å¤§çš„æµé‡,å°±ä¼šå¯¹åŸæœ‰çš„ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ã€‚
                æœåŠ¡åŒ–æ¶æ„ï¼šSOAä»£è¡¨é¢å‘æœåŠ¡çš„æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºæ ¹æ®ä¸åŒçš„èŒè´£åˆ’åˆ†ä¸ºä¸åŒçš„æ¨¡å—ï¼Œä¸åŒçš„æ¨¡å—ç›´æ¥é€šè¿‡ç‰¹å®šçš„åè®®å’Œæ¥å£è¿›è¡Œäº¤äº’
                          åœ¨è¿™ä¸ªé˜¶æ®µå¯ä»¥ä½¿ç”¨WebServiceæˆ–è€…dubboæ¥æœåŠ¡æ²»ç†ã€‚
            SOAå’Œå¾®æœåŠ¡æ¶æ„ï¼š
                å¾®æœåŠ¡æ¶æ„æ˜¯SOAæ¶æ„æ€æƒ³çš„ä¸€ç§æ‰©å±•ï¼Œæ›´åŠ å¼ºè°ƒæœåŠ¡ä¸ªä½“çš„ç‹¬ç«‹æ€§ã€æ‹†åˆ†ç²’åº¦æ›´å°ã€‚
            å¾®æœåŠ¡æ¶æ„ï¼š
                æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„è§£è€¦
                Eureka: æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚Eurekaå†…éƒ¨å·²ç»æä¾›å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ï¼Œåªéœ€è¦å¢åŠ ç›¸åº”çš„æœåŠ¡ç«¯å®ä¾‹æ—¢å¯ã€‚
                Hystrix: åœ¨æŸä¸ªæœåŠ¡è¿ç»­è°ƒç”¨Næ¬¡ä¸å“åº”çš„æƒ…å†µä¸‹,é€šçŸ¥è°ƒç”¨ç«¯è°ƒç”¨å¤±è´¥ã€‚
                Hystrix Dashboardå’ŒTurbine: é’ˆå¯¹Hystrixè¿›è¡Œå®æ—¶ç›‘æ§çš„å·¥å…·ã€‚æ±‡æ€»ç³»ç»Ÿå†…å¤šä¸ªæœåŠ¡çš„æ•°æ®å¹¶æ˜¾ç¤ºåˆ°Hystrix Dashboardä¸Š,è¿™ä¸ªå·¥å…·å°±æ˜¯Turbineã€‚
                é…ç½®ä¸­å¿ƒï¼šspring cloud config-->git-->refresh-->spring cloud bus
                æœåŠ¡ç½‘å…³ï¼šSpring Cloud Zuulè·¯ç”±æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚
                é“¾è·¯è·Ÿè¸ªï¼šSpring Cloud Sleuthå’ŒZipkinã€‚
                        é€šè¿‡Sleuthå¯ä»¥å¾ˆæ¸…æ¥šçš„äº†è§£åˆ°ä¸€ä¸ªæœåŠ¡è¯·æ±‚ç»è¿‡äº†å“ªäº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å¤„ç†èŠ±è´¹äº†å¤šé•¿æ—¶é—´ã€‚ä»è€Œè®©æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç†æ¸…å„å¾®æœåŠ¡é—´çš„è°ƒç”¨å…³ç³»
        11.Dubboå’ŒSpring cloudåŒºåˆ«ï¼Ÿ
            Dubboçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼šZookeeper
                   æœåŠ¡è°ƒç”¨æ–¹å¼ï¼šRPC   //Dubboå®šä½æœåŠ¡æ²»ç†ã€Spring Cloudæ˜¯ä¸€ä¸ªç”Ÿæ€
                   æœåŠ¡ç›‘æ§ï¼šDubbo-monitor
        12.ä½¿ç”¨Spring Cloud Sleuthå’ŒZipkinè¿›è¡Œåˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ª
            ç›®çš„ï¼šè§£å†³åµŒå¥—çš„æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæ‰¾åˆ°å…·ä½“å¤±è´¥çš„æœåŠ¡ä¿¡æ¯åœ°å€ã€‚
            åº”ç”¨ï¼šæ·˜å®çš„â€œé¹°çœ¼â€ã€äº¬ä¸œçš„â€œHydraâ€ã€å¤§ä¼—ç‚¹è¯„çš„â€œCATâ€ã€æ–°æµªçš„â€œWatchmanâ€ã€å”¯å“ä¼šçš„â€œMicroscopeâ€ã€çªçªç½‘çš„â€œTracingâ€
            Spring Cloud Sleuth:
                ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡è·Ÿè¸ªç³»ç»Ÿï¼Œä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ï¼šæ•°æ®æ”¶é›†ã€æ•°æ®å­˜å‚¨å’Œæ•°æ®å±•ç¤ºã€‚
                æœåŠ¡è¿½è¸ªçš„è¿½è¸ªå•å…ƒæ˜¯ä»å®¢æˆ·å‘èµ·è¯·æ±‚ï¼ˆrequestï¼‰æŠµè¾¾è¢«è¿½è¸ªç³»ç»Ÿçš„è¾¹ç•Œå¼€å§‹ï¼Œåˆ°è¢«è¿½è¸ªç³»ç»Ÿå‘å®¢æˆ·è¿”å›å“åº”ï¼ˆresponseï¼‰ä¸ºæ­¢çš„è¿‡ç¨‹ï¼Œç§°ä¸ºä¸€ä¸ªâ€œtraceâ€ã€‚
                ä¸€ä¸ªtrace=nä¸ªspan
            ZipKin: å­˜å‚¨è¿½è¸ªä¿¡æ¯æ•°æ®,zpkin uiå±•ç¤ºæ•°æ®ã€‚æ¯ä¸ªæœåŠ¡å‘zipkinæŠ¥å‘Šè®¡æ—¶æ•°æ®ï¼Œzipkinä¼šæ ¹æ®è°ƒç”¨å…³ç³»é€šè¿‡Zipkin UIç”Ÿæˆä¾èµ–å…³ç³»å›¾
                å¯æ’æ‹”æ•°æ®å­˜å‚¨æ–¹å¼ï¼šIn-Memoryã€MySqlã€Cassandraä»¥åŠElasticsearch
            å¿«é€Ÿä¸Šæ‰‹ï¼š ã€åˆ›å»ºzipkin-serverå’Œæ·»åŠ zipkinæ”¯æŒã€‘
                jaråŒ…ä¾èµ–ï¼š<dependencies>
                           <dependency>
                               <groupId>org.springframework.cloud</groupId>
                               <artifactId>spring-cloud-starter-eureka</artifactId>
                           </dependency>
                           <dependency>
                               <groupId>io.zipkin.java</groupId>
                               <artifactId>zipkin-server</artifactId>
                           </dependency>
                           <dependency>
                               <groupId>io.zipkin.java</groupId>
                               <artifactId>zipkin-autoconfigure-ui</artifactId>
                           </dependency>
                           <dependency>
                               <groupId>org.springframework.cloud</groupId>
                               <artifactId>spring-cloud-starter-zipkin</artifactId>
                           </dependency>
                         </dependencies>
                å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableZipkinServer
                é…ç½®æ–‡ä»¶ï¼š
                    eureka:
                      client:
                        serviceUrl:
                          defaultZone: http://localhost:8761/eureka/
                    server:
                      port: 9000
                    spring:
                      application:
                        name: zipkin-server
                      zipkin:
                          base-url: http://localhost:9000
                      sleuth:
                        sampler:
                          percentage: 1.0
                é»˜è®¤é‡‡æ ·ç®—æ³•ï¼šReservoir samplingï¼Œå…·ä½“å®ç°ç±»PercentageBasedSamplerã€‚é»˜è®¤æ¯”ä¾‹æ˜¯0.1=10%
                            å¯ä»¥è®¾ç½®spring.sleuth.sampler.percentage
        13.æ³¨å†Œä¸­å¿ƒConsulä½¿ç”¨è¯¦è§£ï¼š
            èƒŒæ™¯ï¼šeureka2.xå¼€å‘é‡åˆ°å›°éš¾ï¼Œå›½å†…å¤§å¤šä½¿ç”¨eureka1.x
            åŒç±»äº§å“ï¼šeureka,Consul,zookeeper,etcd   ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            æ¦‚å¿µï¼šConsulçš„æ–¹æ¡ˆæ›´â€œä¸€ç«™å¼â€ï¼Œå†…ç½®äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æ¡†æ¶ã€åˆ†å¸ƒä¸€è‡´æ€§åè®®å®ç°ã€å¥åº·æ£€æŸ¥ã€Key/Value å­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒæ–¹æ¡ˆï¼Œä¸å†éœ€è¦ä¾èµ–å…¶å®ƒå·¥å…·ï¼ˆæ¯”å¦‚ ZooKeeper ç­‰ï¼‰
            å·¥ä½œåŸç†ï¼š
                1ã€å½“Producerå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå‘Consulå‘é€ä¸€ä¸ªpostè¯·æ±‚ï¼Œå‘Šè¯‰Consulè‡ªå·±çš„IPå’ŒPort      //ç±»ä¼¼äºæ³¨å†Œæ“ä½œ
                2ã€Consulæ¥æ”¶åˆ°Producerçš„æ³¨å†Œåï¼Œæ¯éš”10sï¼ˆé»˜è®¤ï¼‰ä¼šå‘Producerå‘é€ä¸€ä¸ªå¥åº·æ£€æŸ¥çš„è¯·æ±‚ï¼Œæ£€éªŒProduceræ˜¯å¦å¥åº·
                3ã€å½“Consumerå‘é€GETæ–¹å¼è¯·æ±‚/api/addressåˆ°Produceræ—¶ï¼Œä¼šå…ˆä»Consulä¸­æ‹¿åˆ°ä¸€ä¸ªå­˜å‚¨æœåŠ¡IPå’ŒPortçš„ä¸´æ—¶è¡¨ï¼Œä»è¡¨ä¸­æ‹¿åˆ°Producerçš„IPå’ŒPortåå†å‘é€GETæ–¹å¼è¯·æ±‚/api/address
                4ã€è¯¥ä¸´æ—¶è¡¨æ¯éš”10sä¼šæ›´æ–°ï¼ŒåªåŒ…å«æœ‰é€šè¿‡äº†å¥åº·æ£€æŸ¥çš„Producer
            åŒºåˆ«ï¼šeurekaå°±æ˜¯ä¸ªservletç¨‹åºï¼Œè·‘åœ¨servletå®¹å™¨ä¸­; Consulåˆ™æ˜¯goç¼–å†™è€Œæˆ
            å®‰è£…å’Œå¯åŠ¨æ“ä½œï¼š
                å¯åŠ¨ï¼šconsul agent -dev
                æ£€æŸ¥ï¼šhttp://localhost:8500
            ConsulæœåŠ¡ç«¯ï¼š
                jaråŒ…ä¾èµ–ï¼š
                    <dependencies>
                    	<dependency>
                    		<groupId>org.springframework.boot</groupId>
                    		<artifactId>spring-boot-starter-actuator</artifactId>       //å¥åº·æ£€æŸ¥ä¾èµ–äºæ­¤åŒ…ã€‚
                    	</dependency>
                    	<dependency>
                    		<groupId>org.springframework.cloud</groupId>
                    		<artifactId>spring-cloud-starter-consul-discovery</artifactId>
                    	</dependency>
                    	<dependency>
                    		<groupId>org.springframework.boot</groupId>
                    		<artifactId>spring-boot-starter-web</artifactId>
                    	</dependency>
                    	<dependency>
                    		<groupId>org.springframework.boot</groupId>
                    		<artifactId>spring-boot-starter-test</artifactId>
                    		<scope>test</scope>
                    	</dependency>
                    </dependencies>
                    Spring Bootç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯2.0.3.RELEASEï¼ŒSpring Cloud æœ€æ–°ç‰ˆæœ¬æ˜¯Finchley.RELEASEä¾èµ–äºSpring Boot 2.x.
                é…ç½®æ–‡ä»¶ï¼š
                    spring.application.name=spring-cloud-consul-producer
                    server.port=8501
                    spring.cloud.consul.host=localhost
                    spring.cloud.consul.port=8500
                    #æ³¨å†Œåˆ°consulçš„æœåŠ¡åç§°
                    spring.cloud.consul.discovery.serviceName=service-producer
                å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient
            Consulæ¶ˆè´¹ç«¯ï¼š
                é…ç½®æ–‡ä»¶ï¼š
                    spring.application.name=spring-cloud-consul-consumer
                    server.port=8503
                    spring.cloud.consul.host=127.0.0.1
                    spring.cloud.consul.port=8500
                    #è®¾ç½®ä¸éœ€è¦æ³¨å†Œåˆ° consul ä¸­
                    spring.cloud.consul.discovery.register=false
                ä½¿ç”¨ç±»ï¼š
                    @Autowired
                    private LoadBalancerClient loadBalancer;
                    @Autowired
                    private DiscoveryClient discoveryClient;
                æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡ï¼š
                    @RestController
                    public class CallHelloController {
                        @Autowired
                        private LoadBalancerClient loadBalancer;
                        @RequestMapping("/call")
                        public String call() {
                            ServiceInstance serviceInstance = loadBalancer.choose("service-producer");
                            System.out.println("æœåŠ¡åœ°å€ï¼š" + serviceInstance.getUri());
                            System.out.println("æœåŠ¡åç§°ï¼š" + serviceInstance.getServiceId());
                            String callServiceResult = new RestTemplate().getForObject(serviceInstance.getUri().toString() + "/hello", String.class);
                            System.out.println(callServiceResult);
                            return callServiceResult;
                        }
                    }
        14.Spring Cloudå¼€æºè½¯ä»¶ï¼š
            awesome-spring-cloudï¼šçŸ¥è¯†åº“
            PiggyMetricsï¼šä¸ªäººè´¢åŠ¡ç³»ç»Ÿ
            spaascloud-masterï¼šæ¨¡æ‹Ÿå•†åŸ
            Cloud-Adminï¼šå¾®æœåŠ¡åŒ–å¼€å‘å¹³å°
            spring-cloud-rest-tccï¼šäº‹åŠ¡é©±åŠ¨
            pig:è„šæ‰‹æ¶
            xxpay-master:èšåˆæ”¯ä»˜
            spring-boot-cloudï¼š
            FCat:ä¼ä¸šçº§åŸºç¡€åŠŸèƒ½æ¡†æ¶ã€‚
            spring-cloud-examples:æ•™ç¨‹
        15.æœåŠ¡ç½‘å…³Spring Cloud GateWay: å®˜æ–¹è‡ªå·±çš„ç½‘å…³ç»„ä»¶ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            æ¦‚å¿µï¼šSpring Cloud Gatewayä½¿ç”¨éé˜»å¡APIï¼Œæ”¯æŒWebSocketsï¼Œæ”¯æŒé™æµç­‰æ–°ç‰¹æ€§ã€‚åŸºäºSpring5.0
                Route: è·¯ç”±
                Predicate: æ–­è¨€
                Filter: è¿‡æ»¤å™¨
            å¿«é€Ÿä¸Šæ‰‹ï¼š
                ç½‘å…³è·¯ç”±é…ç½®ï¼š
                    ymlæ–‡ä»¶é…ç½®
                    é€šè¿‡@Beanè‡ªå®šä¹‰RouteLocatorï¼Œåœ¨å¯åŠ¨ä¸»ç±»Applicationä¸­é…ç½®
                ç‰ˆæœ¬ä½¿ç”¨ï¼šspring-boot-starter-parentï¼š2.0.6.RELEASE
                        spring-cloud-dependencies:Finchley.SR2
                jaråŒ…ä¾èµ–ï¼š<dependency>
                            <groupId>org.springframework.cloud</groupId>
                            <artifactId>spring-cloud-starter-gateway</artifactId>
                          </dependency>
                          Spring Cloud Gatewayæ˜¯ä½¿ç”¨netty+webfluxå®ç°å› æ­¤ä¸éœ€è¦å†å¼•å…¥webæ¨¡å—ã€‚
                é…ç½®è·¯ç”±è§„åˆ™ï¼š
                    server:
                      port: 8080
                    spring:
                      cloud:
                        gateway:
                          routes:
                          - id: neo_route
                            uri: http://www.ityouknow.com
                            predicates:
                            - Path=/spring-cloud
                åœ¨å¯åŠ¨ç±»è‡ªå®šä¹‰è½¬å‘ï¼š
                    @Bean
                    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
                        return builder.routes()
                                .route("path_route", r -> r.path("/about")
                                        .uri("http://ityouknow.com"))
                                .build();
                    }
            è·¯ç”±è§„åˆ™ï¼š
                Spring Cloud Gatewayæ˜¯é€šè¿‡Spring WebFluxçš„HandlerMappingåšä¸ºåº•å±‚æ”¯æŒæ¥åŒ¹é…åˆ°è½¬å‘è·¯ç”±ï¼Œ
                Spring Cloud Gatewayå†…ç½®äº†å¾ˆå¤šPredicateså·¥å‚ï¼Œè¿™äº›Predicateså·¥å‚é€šè¿‡ä¸åŒçš„HTTPè¯·æ±‚å‚æ•°æ¥åŒ¹é…ï¼Œå¤šä¸ªPredicateså·¥å‚å¯ä»¥ç»„åˆä½¿ç”¨ã€‚
                æ–­è¨€åŒ¹é…ï¼šå¯ä»¥å•ç‹¬å’Œç»„åˆä½¿ç”¨
                    æ—¶é—´åŒ¹é…ï¼šAfter/Before/Between
                        spring:
                          cloud:
                            gateway:
                              routes:
                               - id: time_route
                                uri: http://ityouknow.com
                                predicates:
                                 - After=2018-01-20T06:06:06+08:00[Asia/Shanghai]
                    CookieåŒ¹é…ï¼š
                        spring:
                          cloud:
                            gateway:
                              routes:
                               - id: cookie_route
                                 uri: http://ityouknow.com
                                 predicates:
                                 - Cookie=ityouknow, kee.e
                    å…¶ä»–ï¼š- Header=X-Request-Id, \d+
                         - Host=**.ityouknow.com
                         - Method=GET
                         - Path=/foo/{segment}
                         - Query=smile
                         - RemoteAddr=192.168.1.1/24
                    å„ç§PredicatesåŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªè·¯ç”±æ—¶ï¼Œè¯·æ±‚å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶æ‰è¢«è¿™ä¸ªè·¯ç”±åŒ¹é…ã€‚
                    ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„è°“è¯æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘
            æœåŠ¡åŒ–å’Œè¿‡æ»¤å™¨ï¼š
                 Spring Cloud Gateway æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ,Spring Cloud Gatewayé»˜è®¤å°±ä¼šä»£ç†æœåŠ¡ä¸­å¿ƒçš„æ‰€æœ‰æœåŠ¡
                 jaråŒ…ä¾èµ–ï¼š<dependency>
                            <groupId>org.springframework.cloud</groupId>
                            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
                           </dependency>
                           <dependency>
                               <groupId>org.springframework.cloud</groupId>
                               <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
                           </dependency>
                 æœåŠ¡ç½‘å…³æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š
                    <dependency>
                        <groupId>org.springframework.cloud</groupId>
                        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
                    </dependency>
                    é…ç½®æ–‡ä»¶ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                        server:
                          port: 8888
                        spring:
                          application:
                            name: cloud-gateway-eureka
                          cloud:
                            gateway:
                             discovery:
                                locator:
                                 enabled: true      //æ˜¯å¦ä¸æœåŠ¡æ³¨å†Œå’Œå‘ç°ç»„ä»¶è¿›è¡Œç»“åˆ
                        eureka:
                          client:
                            service-url:
                              defaultZone: http://localhost:8000/eureka/    //æ³¨å†Œä¸­å¿ƒçš„åœ°å€
                        logging:
                          level:
                            org.springframework.cloud.gateway: debug
                    è®¿é—®æµ‹è¯•ï¼šhttp://ç½‘å…³åœ°å€ï¼šç«¯å£/æœåŠ¡ä¸­å¿ƒæ³¨å†Œ serviceId/å…·ä½“çš„url ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                        æ¯”å¦‚æœåŠ¡SPRING-CLOUD-PRODUCERï¼šhttp://localhost:9000/hello
                        ç½‘å…³ä»£ç†è®¿é—®ï¼šhttp://localhost:8888/SPRING-CLOUD-PRODUCER/hello
                 åŸºäºFilter(è¿‡æ»¤å™¨)å®ç°çš„é«˜çº§åŠŸèƒ½ï¼š
                    ç”Ÿå‘½å‘¨æœŸåªæœ‰preå’Œpost
                    åˆ†ç±»ï¼šGatewayFilter å’Œ GlobalFilterã€‚
                         GlobalFilterä¼šåº”ç”¨åˆ°æ‰€æœ‰çš„è·¯ç”±ä¸Šï¼Œè€ŒGatewayFilterå°†åº”ç”¨åˆ°å•ä¸ªè·¯ç”±æˆ–è€…ä¸€ä¸ªåˆ†ç»„çš„è·¯ç”±ä¸Šã€‚
                    ä½œç”¨ï¼šGatewayFilterå¯ä»¥ä¿®æ”¹è¯·æ±‚çš„Httpçš„è¯·æ±‚æˆ–è€…å“åº”ï¼Œæˆ–è€…æ ¹æ®è¯·æ±‚æˆ–è€…å“åº”åšä¸€äº›ç‰¹æ®Šçš„é™åˆ¶ã€‚åšè·¯ç”±é…ç½®
                    æ–‡ä»¶é…ç½®ï¼š
                        server:
                          port: 8888
                        spring:
                          application:
                            name: cloud-gateway-eureka
                          cloud:
                            gateway:
                             discovery:
                                locator:
                                 enabled: true
                             routes:
                             - id: add_request_parameter_route
                               uri: http://localhost:9000
                               filters:
                               - AddRequestParameter=foo,bar
                               predicates:
                                 - Method=GET
                        eureka:
                          client:
                            service-url:
                              defaultZone: http://localhost:8000/eureka/
                        logging:
                          level:
                            org.springframework.cloud.gateway: debug
                    æœåŠ¡è·¯ç”±è½¬å‘ï¼šã€å°†Filterä½œç”¨åˆ°æ¯ä¸ªåº”ç”¨çš„å®ä¾‹ä¸Šã€‘
                        #æ ¼å¼ä¸ºï¼šlb://åº”ç”¨æ³¨å†ŒæœåŠ¡å    //è¿™é‡Œçš„lbæ˜¯ä¸€ç§åè®®ï¼Œè´Ÿè½½å‡è¡¡åè®®ã€‚
                        uri: lb://spring-cloud-producer
            Filterçš„å¸¸ç”¨åŠŸèƒ½ï¼š
                ä¿®æ”¹è¯·æ±‚è·¯å¾„çš„è¿‡æ»¤å™¨ï¼š
                    StripPrefix Filteræ˜¯ä¸€ä¸ªè¯·æ±‚è·¯å¾„æˆªå–çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥åšç‰¹æ®Šä¸šåŠ¡çš„è½¬å‘ã€‚
                        æ–‡ä»¶é…ç½®ï¼š
                            spring:
                              cloud:
                                gateway:
                                  routes:
                                  - id: nameRoot
                                    uri: http://nameservice
                                    predicates:
                                    - Path=/name/**
                                    filters:
                                    - StripPrefix=2
                            æ¯”å¦‚ï¼šhttp://name/bar/fooä¼šè¢«è½¬å‘æˆhttp://nameservice/foo
                    PrefixPath Filteræ˜¯åœ¨URLè·¯å¾„å‰é¢æ·»åŠ ä¸€éƒ¨åˆ†çš„å‰ç¼€
                        spring:
                          cloud:
                            gateway:
                              routes:
                              - id: prefixpath_route
                                uri: http://example.org
                                filters:
                                - PrefixPath=/mypath
                é™é€Ÿè·¯ç”±å™¨ï¼šåŸºäºredisçš„é™æµï¼Œç¨³å®šé«˜å¹¶å‘æœåŠ¡
                    jaråŒ…ä¾èµ–ï¼š<dependency>
                                 <groupId>org.springframework.cloud</groupId>
                                 <artifactId>spring-boot-starter-data-redis-reactive</artifactId>
                              </dependency>
                    æ–‡ä»¶é…ç½®ï¼š
                        spring:
                          application:
                            name: cloud-gateway-eureka
                          redis:
                            host: localhost
                            password:
                            port: 6379
                          cloud:
                            gateway:
                             discovery:
                                locator:
                                 enabled: true
                             routes:
                             - id: requestratelimiter_route
                               uri: http://example.org
                               filters:
                               - name: RequestRateLimiter   //å›ºå®šå€¼
                                 args:
                                   redis-rate-limiter.replenishRate: 10
                                   redis-rate-limiter.burstCapacity: 20  //ä»¤ç‰Œæ¡¶å®¹é‡
                                   key-resolver: "#{@userKeyResolver}"  //ä½¿ç”¨SpELæŒ‰åç§°å¼•ç”¨bean
                               predicates:
                                 - Method=GET
                    é¡¹ç›®ä¸­è®¾ç½®é™æµçš„ç­–ç•¥ï¼Œåˆ›å»ºConfigç±»ï¼š
                        //æ ¹æ®è¯·æ±‚å‚æ•°ä¸­çš„ user å­—æ®µæ¥é™æµ
                        public class Config {
                            @Bean
                            KeyResolver userKeyResolver() {
                                return exchange -> Mono.just(exchange.getRequest().getQueryParams().getFirst("user"));
                            }
                        }
                        //æ ¹æ®ipåœ°å€é™æµ
                        @Bean
                        public KeyResolver ipKeyResolver() {
                            return exchange -> Mono.just(exchange.getRequest().getRemoteAddress().getHostName());
                        }
                ç†”æ–­è·¯ç”±å™¨ï¼š
                    Spring Cloud Gatewayä¹Ÿå¯ä»¥åˆ©ç”¨Hystrixçš„ç†”æ–­ç‰¹æ€§ï¼Œåœ¨æµé‡è¿‡å¤§æ—¶è¿›è¡ŒæœåŠ¡é™çº§ã€‚ã€å°±æ˜¯è¿”å›é¢„è®¾å¼‚å¸¸ç»“æœã€‘
                    jaråŒ…ä¾èµ–ï¼š<dependency>
                                 <groupId>org.springframework.cloud</groupId>
                                 <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
                              </dependency>
                    æ–‡ä»¶é…ç½®ï¼šä»¥æœåŠ¡åçš„æ–¹å¼å¯¹æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡è¿›è¡Œç†”æ–­å›è°ƒæ“ä½œ
                        spring:
                          cloud:
                            gateway:
                              routes:
                              - id: hystrix_route
                                uri: lb://spring-cloud-producer
                                predicates:
                                - Path=/consumingserviceendpoint
                                filters:
                                - name: Hystrix
                                  args:
                                    name: fallbackcmd
                                    fallbackUri: forward:/incaseoffailureusethis
                é‡è¯•è·¯ç”±å™¨ï¼š
                    RetryGatewayFilteræ˜¯Spring Cloud Gatewayå¯¹è¯·æ±‚é‡è¯•æä¾›çš„ä¸€ä¸ªGatewayFilter Factory
                    æ–‡ä»¶é…ç½®ï¼š
                        spring:
                          cloud:
                            gateway:
                              routes:
                              - id: retry_test
                                uri: lb://spring-cloud-producer
                                predicates:
                                - Path=/retry
                                filters:
                                - name: Retry
                                  args:
                                    retries: 3
                                    statuses: BAD_GATEWAY

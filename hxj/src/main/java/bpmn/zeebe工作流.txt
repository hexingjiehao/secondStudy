1.å­¦ä¹ zeebeåˆ†å¸ƒå¼çš„å·¥ä½œæµ
    1.å®˜ç½‘åœ°å€ï¼šhttps://zeebe.io
    2.ä»£ç åœ°å€ï¼šhttps://github.com/zeebe-io/zeebe
    3.æ–‡æ¡£åœ°å€ï¼šhttps://docs.zeebe.io
    3.æœ€æ–°ç”Ÿäº§ç‰ˆæœ¬ï¼š0.20.0ï¼Œå¦å¤–æœ€æ–°çš„ç‰ˆæœ¬0.21.0-alpha2
    4.ç‰¹ç‚¹ï¼šæ”¯æŒå¾®æœåŠ¡æ‰€éœ€BPMNç¬¦å·ï¼Œå¯ä»¥åœ¨Kubernetesä¸Šéƒ¨ç½²ï¼Œç›®å‰çš„æ‰€è°“ä¼ä¸šç‰ˆæ˜¯æºä»£ç å…è´¹çš„ã€‚ç›®å‰æ²¡æœ‰æ­£å¼ä¼ä¸šç‰ˆ
    5.é‡è¦çš„åšå®¢ï¼šé‡Œé¢çš„å†…å®¹å€¼çš„ä¸€çœ‹https://zeebe.io/blog/  ã€ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ã€‘
    6.Zeebeå¸¸è§é—®é¢˜ï¼šhttps://zeebe.io/faq/  ã€ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ã€‘
    7.Zeebeæ˜¯ç”±Camundaåˆ›å»ºï¼Œæ˜¯å¯¹å·¥ä½œæµçš„è¿›ä¸€æ­¥ç®€åŒ–å°è£…

2.Zeebeçš„ç›¸å…³ä»‹ç»
    1.å®šä¹‰ï¼šZeebeæ˜¯ä¸€ä¸ªç”¨äºå¾®æœåŠ¡ç¼–æ’çš„å·¥ä½œæµå¼•æ“ã€‚Zeebeä½¿ç”¨å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å‹
    2.å·¥ä½œæµå¼•æ“çš„å®šä¹‰ï¼šæ˜¯ç®¡ç†ä¸šåŠ¡æµç¨‹çš„ç³»ç»Ÿã€‚å®ƒç›‘è§†å·¥ä½œæµä¸­çš„æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶æ ¹æ®å®šä¹‰çš„æµç¨‹ç¡®å®šè¦è½¬æ¢åˆ°å“ªä¸ªæ–°æ´»åŠ¨ã€‚
    3.è§£å†³å·¥ä½œæµé—®é¢˜çš„æ­¥éª¤ï¼š
        3.1 å·¥ä½œæµæ„ŸçŸ¥äº‹ä»¶ç›‘è§†ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼
        3.2 å¾®æœåŠ¡ç¼–æ’ï¼šå°†æ¶ˆæ¯æ—¶é—´ä½¿ç”¨ç‰¹å®šå¾®æœåŠ¡è¿›è¡Œä»£æ›¿æ‰§è¡Œ

3.Zeebeå®˜æ–¹æ–‡æ¡£å­¦ä¹ 
    1.ä»‹ç»
        1.1 Zeebeæ˜¯ä»€ä¹ˆï¼Ÿ
            ç­”ï¼šæ˜¯ä¸€ä¸ªç”¨äºå¾®æœåŠ¡ç¼–æ’çš„å·¥ä½œæµå¼•æ“
        1.2 ä¸‹è½½Zeebe ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            ä½¿ç”¨docker-composeï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                git clone https://github.com/zeebe-io/zeebe-docker-compose
                cd zeebe-docker-compose
                cd operation
                docker-compose up -d
                éƒ¨ç½²bpmnå›¾å½¢ï¼š
                    cd zeebe-docker-compose
                    bin/zbctl deploy ../path/to/your-file.bpmn
            ä½¿ç”¨Dockerï¼š
                docker run --name zeebe -p 26500:26500 camunda/zeebe:latest
                âš ï¸æ³¨æ„æš´éœ²çš„ç«¯å£ï¼š
                    26500: Gateway API
                    26501: Command API (gateway-to-broker)
                    26502: Internal API (broker-to-broker)
                é»˜è®¤çš„æ•°æ®å·ï¼š
                    /usr/local/zeebe/data
                é…ç½®æ–‡ä»¶ï¼š
                    /usr/local/zeebe/conf/zeebe.cfg.toml
                    /usr/local/zeebe/conf/log4j2.xml
                    ç¯å¢ƒå˜é‡ä¿®æ”¹é…ç½®ï¼š
                        ZEEBE_LOG_LEVEL: é»˜è®¤å€¼info
                        ZEEBE_HOST: è®¾ç½®ä¸»æœºåœ°å€è€Œä¸æ˜¯å®¹å™¨çš„IPåœ°å€
                        BOOTSTRAP: è®¾ç½®å†…éƒ¨ç³»ç»Ÿåˆ†åŒºçš„å‰¯æœ¬å…ƒç´ 
                        ZEEBE_CONTACT_POINTS: è®¾ç½®é›†ç¾¤ä¸­å…¶ä»–brokersçš„è¿æ¥ç‚¹
                        DEPLOY_ON_KUBERNETES: å–å€¼ä¸ºtrue/false
                æ³¨æ„ï¼šä½¿ç”¨è™šæ‹Ÿæœºè™šæ‹Ÿè¯¥dockerå®¹å™¨ï¼Œè‡³å°‘éœ€è¦åˆ†é…4GBçš„å†…å­˜ğŸ˜ºğŸ˜ºğŸ˜ºğŸ˜ºğŸ˜º
                    ä»¥ä¸‹æ˜¯docker-machineæ¥è¿è¡Œdockerå®¹å™¨ï¼šdocker-machineä¹Ÿæ˜¯éœ€è¦å®‰è£…çš„
                        docker-machine create --driver virtualbox --virtualbox-memory 4000 zeebe
                        docker-machine ls
                        é…ç½®ç»ˆç«¯ï¼ševal $(docker-machine env zeebe)
                        è¿è¡ŒZeebe:
                            docker run --rm -p 26500:26500 camunda/zeebe:latest
                        æŸ¥çœ‹IPåœ°å€ï¼š
                            docker-machine ip zeebe
                        æµ‹è¯•è¿æ¥Zeebeï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                            telnet å…·ä½“IP 26500
            ä¸‹è½½å‘è¡Œç‰ˆï¼šhttps://github.com/zeebe-io/zeebe/releases
                å†…éƒ¨ä¸»è¦åŒ…å«ï¼šbroker, clients/go ,clients/java, clients/zbctl
                linuxç”¨æˆ·å¯åŠ¨ï¼š
                    tar -xzf zeebe-distribution-X.Y.Z.tar.gz -C zeebe/
                    ./bin/broker
                windowsç”¨æˆ·ï¼šåŒå‡»/bin/broker.bat

        1.3 å¿«é€Ÿå¼€å§‹ï¼š(å‘½ä»¤è¡Œçš„æ–¹å¼å®Œæˆä¸€å¥—æµç¨‹)ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                ä¸‹è½½Zeebeå‘è¡Œç‰ˆ
                å¯åŠ¨Zeebe brokerï¼š ./bin/broker
                    æŸ¥çœ‹brokerçš„çŠ¶æ€ï¼š ./bin/zbctl status
                éƒ¨ç½²ä¸€ä¸ªå·¥ä½œæµ ( bpmnå›¾æ–‡ä»¶ ): åœ¨brokerä¸Šéƒ¨ç½²ä¸€ä¸ªbpmnæ–‡ä»¶
                    ./bin/zbctl deploy order-process.bpmn
                åˆ›å»ºä¸€ä¸ªå·¥ä½œæµå®ä¾‹:
                    ./bin/zbctl create instance order-process --variables '{"orderId": 1234}'
                å®Œæˆä¸€ä¸ªå·¥ä½œæµå®ä¾‹ï¼š
                    éœ€è¦ä¸ºæ¯ä¸ªjobåˆ›å»ºä¸€ä¸ªworker
                    ./bin/zbctl create worker payment-service --handler cat &
                    ./bin/zbctl create worker inventory-service --handler cat &
                    ./bin/zbctl create worker shipment-service --handler cat &
                    å…³é—­æ‰€æœ‰çš„workerï¼š
                        kill  %1 %2 %3
                    å¦å¤–å¯ä»¥å¯åŠ¨Zeebe simple monitorï¼Œå¯¹æµç¨‹çŠ¶æ€è¿›è¡Œç›‘è§†
    2.åŸºç¡€
        2.1 æ¶æ„ç»„æˆï¼š
                client (æˆ‘ä»¬éœ€è¦å†™ä»£ç çš„åœ°æ–¹) : å®¢æˆ·æœºæ˜¯åµŒå…¥åˆ°åº”ç”¨ç¨‹åº(ä¾‹å¦‚æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„å¾®æœåŠ¡)ä¸­çš„åº“ï¼Œç”¨äºè¿æ¥åˆ°Zeebeé›†ç¾¤
                gatewayï¼šå°†è¯·æ±‚ä»£ç†ç»™broker,å……å½“Zeebeé›†ç¾¤å•ä¸€å…¥å£ã€‚æ— çŠ¶æ€å’Œæ— ä¼šè¯ã€‚å®ç°è´Ÿè½½å¹³è¡¡å’Œé«˜å¯ç”¨æ€§
                brokerï¼šæ˜¯ä¿æŒæ´»åŠ¨å·¥ä½œæµå®ä¾‹çŠ¶æ€çš„åˆ†å¸ƒå¼å·¥ä½œæµå¼•æ“ã€‚åŠŸèƒ½æ˜¯ï¼šå­˜å‚¨å’Œç®¡ç†æ´»åŠ¨å·¥ä½œæµå®ä¾‹çš„çŠ¶æ€ï¼Œå‘å®¢æˆ·åˆ†å‘å·¥ä½œé¡¹
                exporterï¼šæä¾›Zeebeä¸­çŠ¶æ€æ›´æ”¹çš„äº‹ä»¶æµä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯æ“ä½œæ—¥å¿—
        2.2 å·¥ä½œæµï¼š
                å·¥ä½œæµæ˜¯ç±»ä¼¼æµç¨‹å›¾çš„è“å›¾ï¼Œå®šä¹‰ä»»åŠ¡çš„ç¼–æ’ã€‚æ¯ä¸ªä»»åŠ¡éƒ½è¡¨ç¤ºä¸€æ®µä¸šåŠ¡é€»è¾‘ï¼Œä»¥ä¾¿æœ‰åºæ‰§è¡Œäº§ç”Ÿæœ‰æ„ä¹‰çš„ç»“æœã€‚
                ä¸¤ä¸ªæ­¥éª¤:å°†å·¥ä½œæµæäº¤ç»™Zeebe
                        åˆ›å»ºå¯ä»¥ä»Zeebeè¯·æ±‚ä½œä¸šå¹¶å®Œæˆå®ƒä»¬çš„ä½œä¸šworkerã€‚
                é‡è¦å…ƒç´ ï¼š
                    ç®­å¤´é€»è¾‘åºåˆ—+æ•°æ®æµç®­å¤´+åŸºäºæ•°æ®çš„çŠ¶æ€+äº‹ä»¶+åˆ†å‰å’Œåˆå¹¶å¹¶å‘
        2.3 Job Workerï¼š
                å®ƒæ˜¯èƒ½å¤Ÿåœ¨å·¥ä½œæµä¸­æ‰§è¡Œç‰¹å®šæ­¥éª¤çš„ç»„ä»¶ã€‚
                jobæ˜¯å·¥ä½œæµä¸­çš„å·¥ä½œé¡¹ã€‚å±æ€§æœ‰Type,Variables,Custom Headers
                workerå‘Brokerç”³è¯·å¯¹åº”çš„jobã€‚brokerç¡®ä¿å°†æ¯ä¸ªjobå‘é€åˆ°å”¯ä¸€ä¸€ä¸ªworkerä¸Š
                jobé˜Ÿåˆ—ï¼Œå¯ä»¥å­˜å‚¨å¤§é‡çš„jobï¼Œç­‰å¾…wokerè¯·æ±‚è¿›è¡Œå¤„ç†
        2.4 åˆ†åŒºï¼š
                Zeebeä¸­çš„æ•°æ®è¢«ç»„ç»‡æˆåˆ†åŒºã€‚å¯ä»¥ç”¨äºè´Ÿè½½å‡è¡¡ã€‚å¯ä»¥è®¾ç½®åˆ†åŒºçš„æ•°é‡
        2.5 åè®®ï¼š
                Zeebeå®¢æˆ·ç«¯é€šè¿‡æ— çŠ¶æ€ç½‘å…³è¿æ¥åˆ°ä»£ç†ã€‚å®¢æˆ·ç«¯å’Œç½‘å…³ä¹‹é—´çš„é€šä¿¡é‡‡ç”¨gRPCã€‚é€šä¿¡åè®®æ˜¯ä½¿ç”¨åè®®ç¼“å†²åŒºv3 (proto3)
        2.6 å†…éƒ¨å¤„ç†ï¼š
                Zeebeå®ç°ä¸ºåœ¨è®°å½•æµ(åˆ†åŒº)ä¸Šå·¥ä½œçš„æµå¤„ç†å™¨çš„é›†åˆ
                çŠ¶æ€æœºï¼š created --> activated --> completed
                çŠ¶æ€æœºä¸­çš„æ¯ä¸ªçŠ¶æ€æ›´æ”¹éƒ½ç§°ä¸ºäº‹ä»¶ã€‚Zeebeå°†æ¯ä¸ªäº‹ä»¶ä½œä¸ºæµä¸Šçš„è®°å½•å‘å¸ƒã€‚
        2.7 å¯¼å‡ºå™¨ï¼š
                Zeebeä¸Šçš„æ‰€æœ‰æ“ä½œè¢«å•ä¸€å…¥å£ç‚¹è¿›è¡Œå¤„ç†ï¼Œç„¶åä¿å­˜åˆ°è‡ªå®šä¹‰çš„æ•°æ®å­˜å‚¨ä½ç½®
        2.8 é›†ç¾¤ï¼š
                èŠ‚ç‚¹æ˜¯Brokerï¼Œå½¢æˆä¸€ä¸ªå¯¹ç­‰ç½‘ç»œ
                ä½¿ç”¨Gossip Membershipåè®®ã€‚é…ç½®æ¥è§¦ç‚¹ï¼š
                    [network.gossip]
                    initialContactPoints = [ "node1.mycluster.loc:26502" ]
                ä¸ºäº†ç¡®ä¿å®¹é”™ï¼ŒZeebeä½¿ç”¨Raftåè®®åœ¨æœºå™¨ä¹‹é—´å¤åˆ¶æ•°æ®ã€‚æ•°æ®æœ‰é¢†å¯¼è€…å’Œè·Ÿéšè€…çš„åŒºåˆ«
                commitæ“ä½œï¼šæ–°çš„æ•°æ®è¿›å…¥åˆ†åŒºæ—¶ï¼Œå°†åœ¨å…¶ä»–åˆ†åŒºè¿›è¡Œå¤åˆ¶æ•°æ®
    3.å¼€å§‹æ•™ç¨‹ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        3.1 æ•°æ®å‡†å¤‡ï¼š
                æœ€ç®€å•æ–¹æ³•ï¼šdocker-compose up -d   éƒ¨ç½²zeebe-docker-composeçš„ä»“åº“
                Zeebe Modeler: åˆ›å»ºbpmnçš„å·¥å…·
                Zeebe Distribution: å·¥ä½œæµå¼•æ“
                Camunda Operate: å®æ—¶ç›‘è§†å·¥ä½œæµçŠ¶æ€çš„å·¥å…·
                Elasticsearch 6.8.0: ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼Œå¯ä»¥è¿æ¥åˆ°Zeebeæ¥å­˜å‚¨ç”¨äºå®¡è®¡ã€å¯è§†åŒ–ã€åˆ†æç­‰çš„å·¥ä½œæµæ•°æ®

                æ³¨æ„ï¼šelasticsearchè½¯ä»¶çš„ä¸‹è½½åœ°å€ï¼šhttps://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-ç‰ˆæœ¬å·.zip
        3.2 åœ¨Zeebe Modelerä¸­åˆ›å»ºå·¥ä½œæµå›¾
        3.3 éƒ¨ç½²å·¥ä½œæµåˆ°Zeebeå¼•æ“ä¸Š
                æ‰‹åŠ¨é…ç½®å’Œå¯åŠ¨Zeebeå’ŒOperateå·¥å…·ï¼š
                    1. æ‰“å¼€brokeå·¥å…·çš„confç›®å½•ä¸‹çš„zeebe.cfg.tomlæ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®å¯¼å‡º
                        [[exporters]]
                        id="elasticsearch"
                        className="io.zeebe.exporter.ElasticsearchExporter"
                    2.åœ¨å¦ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£æ‰§è¡Œelasticsearch
                        cd elasticsearch-6.7.0
                        bin/elasticsearch
                    3.å¯åŠ¨broker
                        cd zeebe-broker-0.17.0
                        ./bin/broker
                    4.å¯åŠ¨Operateï¼Œå¹¶è®¿é—® http://localhost:8080ï¼Œç”¨æˆ·åå¯†ç æ˜¯demo/demo
                        cd camunda-operate-distro-1.0.0-RC2
                        bin/operate
                æ£€æŸ¥brokerçŠ¶æ€ï¼š
                    ./bin/zbctl status
                    ./bin/zbctl.darwin status

                    ./bin/zbctl deploy order-process.bpmn  ã€å‘½ä»¤è¡Œéƒ¨ç½²bpmnã€‘
        3.4 åˆ›å»ºå’Œå®Œæˆå·¥ä½œæµå®ä¾‹
                ./bin/zbctl create instance order-process --variables '{"orderId": "1234", "orderValue":99}'
                ä»¥ç®€å•å‘½ä»¤è¡Œå¤„ç†åˆ›å»ºçš„job:
                    ./bin/zbctl.darwin create worker initiate-payment --handler cat
                zbctlæ”¯æŒæ¶ˆæ¯å‘å¸ƒï¼š
                    ./bin/zbctl publish message "payment-received" --correlationKey="1234"
                    ./bin/zbctl publish message "payment-received" --correlationKey="2345"
                å‰©ä½™çš„æ“ä½œworkerï¼š
                    ./bin/zbctl create worker ship-without-insurance --handler cat
                    ./bin/zbctl create worker ship-with-insurance --handler cat
    4.BPMNå·¥ä½œæµ
        4.1 BPMN Primer:
                æ ¸å¿ƒæ¦‚å¿µæ˜¯æµç¨‹å¼€å§‹æ—¶ç”Ÿæˆçš„tokençš„ç§»åŠ¨æ“ä½œã€‚è¿‡ç¨‹ä¸­tokenæœ‰å„ç§æ“ä½œï¼ŒåŒ…æ‹¬å¢åŠ ï¼Œå‡å°‘ç­‰
                åœ¨éƒ¨åˆ†æ ¸å¿ƒä»»åŠ¡çš„å¤–å›´æ·»åŠ æ¶ˆæ¯æ•è·äº‹ä»¶ï¼Œå¯ä»¥åšåˆ°è®¢å•å–æ¶ˆç­‰æ“ä½œ
        4.2 BPMN Coverage:
                ç›®å‰Zeebeå®ç°çš„å…ƒç´ æœ‰ï¼š
                    Participants
                    å­æµç¨‹
                    æœåŠ¡ä»»åŠ¡
                    æ¥æ”¶ä»»åŠ¡
                    å¹¶è¡Œç½‘å…³ï¼Œäº‹ä»¶ç½‘å…³ï¼Œå¼‚æˆ–ç½‘å…³
                    æ­£å¸¸æ¶ˆæ¯ï¼Œæ•è·æ¶ˆæ¯ï¼Œè¾¹ç•Œæ¶ˆæ¯ï¼Œè¾¹ç•Œéä¸­æ–­æ¶ˆæ¯  ã€éƒ½æ˜¯äº‹ä»¶ã€‘
                    æ­£å¸¸å®šæ—¶å™¨ï¼Œæ•è·å®šæ—¶å™¨ï¼Œè¾¹ç•Œå®šæ—¶å™¨ï¼Œè¾¹ç•Œéä¸­æ–­å®šæ—¶å™¨  ã€éƒ½æ˜¯äº‹ä»¶ã€‘
        4.3 Data Flow:
                æ•°æ®æ ¼å¼æ˜¯é”®å€¼å¯¹ã€‚å…¶ä¸­Job Workerå¯¹æ•°æ®è¿›è¡Œå„ç§æ“ä½œ
                å˜é‡æ˜¯å·¥ä½œæµçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯tokençš„ä¸€éƒ¨åˆ†
        4.4 Tasks:
            4.4.1 Service Tasks
                    ä»»åŠ¡å®šä¹‰ï¼š<zeebe:taskDefinition type="payment-service" retries="5" />
                    ä»»åŠ¡å¤´ï¼š
                        <zeebe:taskHeaders>
                          <zeebe:header key="method" value="VISA" />
                        </zeebe:taskHeaders>
                    å˜é‡æ˜ å°„ï¼š
                        <serviceTask id="collectMoney">
                          <extensionElements>
                            <zeebe:ioMapping>
                              <zeebe:input source="price" target="total"/>
                              <zeebe:output source="method" target="paymentMethod"/>
                             </zeebe:ioMapping>
                          </extensionElements>
                        </serviceTask>
            4.4.2 Receive Tasks
                    æ¶ˆæ¯å¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶ä»»åŠ¡å¼•ç”¨ã€‚å®ƒåŒ…å«ç”¨äºæ¶ˆæ¯å…³è”çš„ä¿¡æ¯
                    <bpmn:message id="Message_1iz5qtq" name="Money collected">
                       <bpmn:extensionElements>
                         <zeebe:subscription correlationKey="orderId" />
                       </bpmn:extensionElements>
                    </bpmn:message>

                    <bpmn:receiveTask id="money-collected" name="Money collected" messageRef="Message_1iz5qtq">
                    </bpmn:receiveTask>
                    å˜é‡æ˜ å°„ï¼š
                        <bpmn:receiveTask id="money-collected" name="Money collected" messageRef="Message_1iz5qtq">
                            <bpmn:extensionElements>
                            <zeebe:ioMapping>
                              <zeebe:output source="price" target="totalPrice"/>
                             </zeebe:ioMapping>
                          </bpmn:extensionElements>
                        </bpmn:receiveTask>
        4.5 Gateways:
            4.5.1 æ’ä»–ç½‘å…³:
                    <bpmn:exclusiveGateway id="exclusiveGateway" default="else" />

                    <bpmn:sequenceFlow id="priceGreaterThan100" name="totalPrice &#62; 100" sourceRef="exclusiveGateway" targetRef="shipParcelWithInsurance">
                      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">
                        <![CDATA[ totalPrice > 100 ]]>
                      </bpmn:conditionExpression>
                    </bpmn:sequenceFlow>

                    <bpmn:sequenceFlow id="else" name="else" sourceRef="exclusiveGateway" targetRef="shipParcel" />
            4.5.2 å¹³è¡Œç½‘å…³ï¼š
                    å¤šæ¡åˆ†æ”¯çš„äº‹ä»¶æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¹¶ä¸”ç­‰å¾…æ‰€æœ‰åˆ†æ”¯å®Œæˆæ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œ
            4.5.3 åŸºäºäº‹ä»¶çš„ç½‘å…³
                     æ¯ä¸ªä¼ å‡ºåºåˆ—æµéƒ½éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªä¸­é—´catchäº‹ä»¶
                     å½“å…¶ä¸­ä¸€ä¸ªäº‹ä»¶å‡ºå‘æ—¶ï¼Œè¯¥åˆ†æ”¯ç»§ç»­æ‰§è¡Œï¼Œå…¶ä»–åˆ†æ”¯åœæ­¢
                     è¾“å‡ºåºåˆ—åªèƒ½æ˜¯æ¶ˆæ¯å’Œå®šæ—¶å™¨ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿

                     <bpmn:eventBasedGateway id="gateway" />

                     <bpmn:sequenceFlow id="s1" sourceRef="gateway" targetRef="payment-details-updated" />

                     <bpmn:intermediateCatchEvent id="payment-details-updated" name="Payment Details Updated">
                       <bpmn:messageEventDefinition messageRef="message-payment-details-updated" />
                     </bpmn:intermediateCatchEvent>

                     <bpmn:sequenceFlow id="s2" sourceRef="gateway" targetRef="wait-one-hour" />

                     <bpmn:intermediateCatchEvent id="wait-one-hour" name="1 hour">
                       <bpmn:timerEventDefinition>
                         <bpmn:timeDuration>PT1H</bpmn:timeDuration>
                       </bpmn:timerEventDefinition>
                     </bpmn:intermediateCatchEvent>
        4.6 Events:
                è¾¹ç•Œäº‹ä»¶å¿…é¡»æ˜¯ä¸­é—´æ•è·äº‹ä»¶ï¼Œå¯ä»¥æ˜¯ä¸­æ–­äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯éä¸­æ–­äº‹ä»¶
                4.6.1 ç©ºäº‹ä»¶ï¼š
                        <bpmn:startEvent id="order-placed" name="Order Placed" />
                        <bpmn:endEvent id="order-delivered" name="Order Delivered" />
                4.6.2 æ¶ˆæ¯äº‹ä»¶
                        åªèƒ½ä½¿ç”¨Zeebeå®¢æˆ·æœºä¹‹ä¸€åœ¨å¤–éƒ¨å‘å¸ƒæ¶ˆæ¯
                        <bpmn:message id="Message_1iz5qtq" name="Money collected">
                           <bpmn:extensionElements>
                             <zeebe:subscription correlationKey="orderId" />
                           </bpmn:extensionElements>
                        </bpmn:message>

                        <bpmn:intermediateCatchEvent id="money-collected">
                          <bpmn:messageEventDefinition messageRef="Message_1iz5qtq" />
                        </bpmn:intermediateCatchEvent>

                        æ¶ˆæ¯å¼€å§‹äº‹ä»¶ï¼š
                            <bpmn:message id="newOrder" name="New order">
                            </bpmn:message>

                            <bpmn:startEvent id="messageStart">
                              <bpmn:messageEventDefinition messageRef="newOrder" />
                            </bpmn:startEvent>
                4.6.3 å®šæ—¶å™¨äº‹ä»¶
                        å¦‚æœå‘å»¶è¿Ÿæ‰§è¡ŒæŸä¸ªäº‹ä»¶ï¼Œå¯ä»¥åœ¨è¯¥äº‹ä»¶ä¹‹å‰æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨äº‹ä»¶
                        æ—¶é—´æ ¼å¼ä¸¾ä¾‹ï¼š
                            PT15Sï¼š 15ç§’é’Ÿ
                            PT1H30Mï¼š 1å°æ—¶30åˆ†é’Ÿ
                            P14Dï¼š 14å¤©
                            P1Y6Mï¼š 1å¹´6ä¸ªæœˆ
                            å–å€¼ä¸ºè´Ÿæ•°ï¼Œç«‹å³è§¦å‘

                        <bpmn:intermediateCatchEvent id="wait-for-coffee" name="4 minutes">
                          <bpmn:timerEventDefinition>
                            <bpmn:timeDuration>PT4M</bpmn:timeDuration>
                          </bpmn:timerEventDefinition>
                        </bpmn:intermediateCatchEvent>

                        å®šæ—¶å™¨è¾¹ç•Œäº‹ä»¶ï¼šå¯ä»¥ç”¨ä½œè¶…æ—¶å¤„ç†
                            R/PT5Sï¼š æ¯5ç§’æ‰§è¡Œ1æ¬¡
                            R5/PT1Sï¼š æ¯ç§’é’Ÿæœ€å¤š5æ¬¡

                            <bpmn:serviceTask id="brew-coffee">
                              <bpmn:incoming>incoming</bpmn:incoming>
                            </bpmn:serviceTask>
                            <bpmn:boundaryEvent id="send-reminder" cancelActivity="true" attachedToRef="brew-coffee">
                              <bpmn:timerEventDefinition>
                                <bpmn:timeDuration>PT4M</bpmn:timeDuration>
                              </bpmn:timerEventDefinition>
                            </bpmn:boundaryEvent>

                        å®šæ—¶å™¨å¼€å§‹äº‹ä»¶ï¼šç”¨äºåšå®šæ—¶ä»»åŠ¡
                             <bpmn:startEvent id="timer-start">
                              <bpmn:timerEventDefinition>
                                <bpmn:timeCycle>R3/PT10H</bpmn:timeCycle>
                              </bpmn:timerEventDefinition>
                            </bpmn:startEvent>

                            å­è¿›ç¨‹ä¸èƒ½æœ‰è®¡æ—¶å™¨å¯åŠ¨äº‹ä»¶ã€‚âš ï¸
        4.7 Sub Process:
                <bpmn:subProcess id="shipping" name="Shipping">
                  <bpmn:startEvent id="shipping-start" />
                  ... more contained elements ...
                </bpmn:subProcess>
    5.BPMNå»ºæ¨¡å™¨
        ä¸‹è½½é¡µï¼š https://github.com/zeebe-io/zeebe-modeler/releases
        æºç ä»“åº“ï¼š https://github.com/zeebe-io/zeebe-modeler
    6.YAMLå·¥ä½œæµ: ä½¿ç”¨yamlæ ¼å¼ç¼–å†™æµç¨‹å›¾æ–‡ä»¶
        6.1 Tasksï¼š
                æœ‰4ä¸ªå±æ€§ï¼šid,type,retries,headers
                name: order-process
                tasks:
                    - id: collect-money
                      type: payment-service
                    - id: fetch-items
                      type: inventory-service
                      retries: 5
                    - id: ship-parcel
                      type: shipment-service
                      headers:
                            method: "express"
                            withInsurance: false
        6.2 Control Flow:
                é»˜è®¤åœ¨æ–‡ä»¶ä¸­è‡ªä¸Šè€Œä¸‹æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨gotoå’Œendå’Œswitchè¿›è¡Œè®¾å®š
                name: order-process
                tasks:
                    - id: collect-money
                      type: payment-service
                    - id: fetch-items
                      type: inventory-service
                      switch:
                          - case: totalPrice > 100
                            goto: ship-parcel-with-insurance
                          - default: ship-parcel
                    - id: ship-parcel-with-insurance
                      type: shipment-service-premium
                      end: true
                    - id: ship-parcel
                      type: shipment-service
        6.3 Data Flowï¼š
                å°±æ˜¯æ•°æ®æ˜ å°„input/output==source/target
                name: order-process
                tasks:
                    - id: collect-money
                      type: payment-service
                      inputs:
                          - source: totalPrice
                            target: price
                      outputs:
                          - source: success
                            target: paymentSuccess
                    - id: fetch-items
                      type: inventory-service
                    - id: ship-parcel
                      type: shipment-service
    7.å‚è€ƒ
        7.1 å·¥ä½œæµç”Ÿå‘½å‘¨æœŸ
                ç›¸åŒç±»å‹çš„å…ƒç´ æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
                å­æµç¨‹/æ´»åŠ¨/ç½‘å…³ï¼š
                    activating --> activated --> completing --> completed
                                             --> terminating --> terminated
                äº‹ä»¶ï¼š
                    activating --> activated --> occurred --> completing --> completed
                                             --> terminating --> terminated
        7.2 å˜é‡
                å˜é‡å–å€¼è¢«å­˜å‚¨ä½œä¸ºJsonã€‚å¯ä»¥ç”¨ç‚¹ç¬¦å·è®¿é—®jsonä¸­çš„å±æ€§ã€‚å®ƒæœ‰ä»¥ä¸‹æ•°æ®ç±»å‹ï¼š
                    String
                    Number
                    Boolean
                    Array
                    Document/Object
                    Null

                <serviceTask id="collectMoney" name="Collect Money">
                    <extensionElements>
                      <zeebe:ioMapping>
                        <zeebe:input source="customer.name" target="sender"/>
                        <zeebe:input source="customer.iban" target="iban"/>
                        <zeebe:input source="totalPrice" target="price"/>
                        <zeebe:input source="reference" target="orderId"/>
                        <zeebe:output source="status" target="paymentStatus"/>
                       </zeebe:ioMapping>
                    </extensionElements>
                </serviceTask>
        7.3 æ¡ä»¶ï¼š
                æ–‡å­—/æ“ä½œç¬¦å·/é€»è¾‘æ“ä½œç¬¦å·
        7.4 æ¶ˆæ¯ç›¸å…³æ€§
                æŸä¸ªæœåŠ¡ç»“æŸåï¼Œä½¿ç”¨zeebeå®¢æˆ·ç«¯å‘æ¶ˆæ¯
                æ¶ˆæ¯å¯ä»¥è®¾ç½®ç”Ÿå­˜æ—¶é—´ttl,è¿›è¡Œä¸€å®šç¨‹åº¦çš„ç¼“å†²
                æ¶ˆæ¯å¯ä»¥æœ‰å”¯ä¸€æ€§IDï¼Œå‘æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦å­˜åœ¨ç›¸åŒæ¶ˆæ¯ï¼Œå­˜åœ¨åˆ™æ‹’ç»
        7.5 äº‹æ•…å¤±è´¥æ£€æŸ¥ï¼š
                å¯ä»¥äººä¸ºæ ‡è®°äº‹æ•…å·²ç»è§£å†³
                è§£å†³jobå…³è”çš„é—®é¢˜ï¼š
                    client.newSetVariablesCommand(incident.getElementInstanceKey())
                        .variables(NEW_PAYLOAD)
                        .send()
                        .join();

                    client.newUpdateRetriesCommand(incident.getJobKey())
                        .retries(3)
                        .send()
                        .join();

                    client.newResolveIncidentCommand(incident.getKey())
                        .send()
                        .join();
                è§£å†³å·¥ä½œæµå®ä¾‹å…³è”çš„é—®é¢˜ï¼šåŸå› æ˜¯å˜é‡æœ‰é—®é¢˜
                    é¦–å…ˆæ›´æ–°å˜é‡ï¼Œç„¶åæ ‡è®°ä¸ºå·²ç»è§£å†³
                    client.newSetVariablesCommand(incident.getElementInstanceKey())
                        .variables(NEW_VARIABLES)
                        .send()
                        .join();

                    //è¿™ä¸ªæ“ä½œè¡¨ç¤ºè¯¥jobé—®é¢˜è§£å†³ï¼Œè¯·ç»§ç»­å¾€ä¸‹æ‰§è¡ŒğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                    client.newResolveIncidentCommand(incident.getKey())
                        .send()
                        .join();
        7.5.5 gRPC API ç´¢å¼•ï¼š
            å¼‚å¸¸å¤„ç†ï¼š
                GRPC_STATUS_RESOURCE_EXHAUSTED: è¡¨ç¤ºè¯·æ±‚å¤ªå¤šæ— æ³•å¤„ç†ã€‚è§£å†³åŠæ³•ï¼šå‡å°‘è¯·æ±‚é€Ÿç‡
                GRPC_STATUS_UNAVAILABLEï¼šç½‘å…³å†…å­˜æº¢å‡º
                GRPC_STATUS_INTERNALï¼šç½‘å…³å’Œä»£ç†ä¹‹é—´å‘ç”Ÿçš„å†…éƒ¨é”™è¯¯
            ç½‘å…³æœåŠ¡ï¼šè¿œç«¯è¿‡ç¨‹è°ƒç”¨çš„æ–¹æ³•
                ActivateJobs RPCï¼šå¾ªç¯éå†æ‰€æœ‰å·²çŸ¥çš„åˆ†åŒºï¼Œå¹¶æ¿€æ´»åˆ°æ‰€è¯·æ±‚çš„æœ€å¤§å€¼ï¼Œå¹¶åœ¨æ¿€æ´»åˆ†åŒºæ—¶å°†å®ƒä»¬æµå›å®¢æˆ·æœºã€‚
                    å¼‚å¸¸ï¼šGRPC_STATUS_INVALID_ARGUMENT, åŸå› æ˜¯type/worker/timeout/amountä¸ºnullæˆ–è€…å°äº1

                CancelWorkflowInstance RPCï¼šå–æ¶ˆä¸€ä¸ªè¿è¡Œä¸­çš„å·¥ä½œæµå®ä¾‹
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUND, åŸå› å·¥ä½œæµå®ä¾‹ä¸å­˜åœ¨æˆ–è€…å·²å®Œæˆ

                CompleteJob RPCï¼šä½¿ç”¨ç»™å®šçš„æœ‰æ•ˆè´Ÿè½½å®Œæˆä½œä¸šï¼Œä»è€Œå…è®¸å®Œæˆç›¸å…³çš„æœåŠ¡ä»»åŠ¡ã€‚
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUND, åŸå› å·¥ä½œæµå®ä¾‹ä¸å­˜åœ¨æˆ–è€…å·²å®Œæˆ

                CreateWorkflowInstance RPCï¼šåˆ›å»ºå¹¶å¯åŠ¨æŒ‡å®šå·¥ä½œæµçš„å®ä¾‹
                CreateWorkflowInstanceWithResult RPCï¼šåˆ›å»ºå¹¶å¯åŠ¨æŒ‡å®šå·¥ä½œæµçš„å®ä¾‹ã€‚å“åº”åœ¨å·¥ä½œæµå®Œæˆæ—¶è¿”å›ã€‚ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUND, å·¥ä½œæµidæˆ–è€…ç‰ˆæœ¬ä¸å­˜åœ¨
                         GRPC_STATUS_FAILED_PRECONDITION: å·¥ä½œæµå®šä¹‰ä¸åŒ…å«ç©ºå¯åŠ¨äº‹ä»¶
                         GRPC_STATUS_INVALID_ARGUMENT: ç»™å®šçš„å‚æ•°ä¸æ˜¯åˆæ³•çš„jsonæ–‡æ¡£

                DeployWorkflow RPCï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå·¥ä½œæµéƒ¨ç½²åˆ°Zeebeã€‚æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸå­è°ƒç”¨ï¼Œå³è¦ä¹ˆéƒ¨ç½²æ‰€æœ‰å·¥ä½œæµï¼Œè¦ä¹ˆä¸€ä¸ªä¹Ÿä¸éƒ¨ç½²
                    å¼‚å¸¸ï¼šGRPC_STATUS_ARGUMENT: æ²¡æœ‰æµç¨‹æ–‡ä»¶

                FailJob RPCï¼šå°†å·¥ä½œæ ‡è®°ä¸ºå¤±è´¥;å¦‚æœé‡è¯•å‚æ•°ä¸ºæ­£ï¼Œåˆ™ä½œä¸šå°†ç«‹å³å†æ¬¡æ¿€æ´»ï¼Œå·¥ä½œäººå‘˜å¯ä»¥å†æ¬¡å°è¯•å¤„ç†å®ƒã€‚
                             ä½†æ˜¯ï¼Œå¦‚æœæ˜¯0æˆ–è´Ÿæ•°ï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„errorMessageè¿›è¡Œæ ‡è®°ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶è§£å†³ä¹‹å‰ä½œä¸šä¸ä¼šè¢«æ¿€æ´»ã€‚
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUNDï¼š æ²¡æœ‰jobå‘ç°
                         GRPC_STATUS_FAILED_PRECONDITIONï¼š jobæ²¡æœ‰æ¿€æ´»æˆ–è€…å·²ç»å¤±è´¥äº†

                PublishMessage RPCï¼šå‘å¸ƒä¸€æ¡æ¶ˆæ¯åˆ°ç‰¹å®šåˆ†åŒº
                    å¼‚å¸¸ï¼šGRPC_STATUS_ALREDAY_EXISTS: ç›¸åŒidçš„æ¶ˆæ¯å·²ç»å‘é€äº†

                ResolveIncident RPCï¼šè§£å†³ç»™å®šçš„äº‹ä»¶
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUND: ç»™å®šçš„æµç¨‹æ²¡æœ‰å¼‚å¸¸

                SetVariables RPCï¼šè®¾ç½®å˜é‡
                    å¼‚å¸¸ï¼šGRPC_SATUS_NOT_FOUND: æ²¡æœ‰ç»™å®šçš„å…ƒç´ 
                         GRPC_STATUS_INVALID_ARGUMENT: ç»™å®šçš„å˜é‡ä¸æ˜¯jsonæ–‡æ¡£

                Topology RPCï¼šè·å–ç½‘å…³æ‰€åœ¨é›†ç¾¤çš„å½“å‰æ‹“æ‰‘ç»“æ„ã€‚
                UpdateJobRetries RPCï¼šæ›´æ–°ä¸€ä¸ªä½œä¸šå‰©ä½™çš„é‡è¯•æ¬¡æ•°
                    å¼‚å¸¸ï¼šGRPC_STATUS_NOT_FOUND: ä¸å­˜åœ¨job
                         GRPC_STATUS_INVALID_ARGUMENT: é‡è¯•å‚æ•°ä¸å¤§äº0

        7.6 æ—¥å¿—æ“ä½œå¯¼å‡º
                é€šè¿‡Exporteræ¥å£ä¸brokeräº¤äº’
                å› ä¸ºå­˜åœ¨å¤šåˆ†åŒºçš„é‡å¤å¯¼å‡ºï¼Œæœ€åå¥½åœ¨å¯¼å‡ºæ—¶è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤æ“ä½œ
                å¯¼å‡ºç¨‹åºè¶Šç®€å•è¶Šå¥½
    8.javaå®¢æˆ·ç«¯
        8.1 è®¾ç½®éœ€è¦ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                Java 8
                <dependency>
                  <groupId>io.zeebe</groupId>
                  <artifactId>zeebe-client-java</artifactId>
                  <version>${zeebe.version}</version>
                </dependency>

                ZeebeClient client = ZeebeClient.newClientBuilder()
                  .brokerContactPoint("127.0.0.1:26500")
                  .build();
        8.2 ä½¿ç”¨Java clientå¯åŠ¨ï¼š
                å¯åŠ¨broker: é»˜è®¤ä¸»æœºæ˜¯localhost:26500
                è®¾ç½®é¡¹ç›®ä¾èµ–ï¼š<dependency>
                             <groupId>io.zeebe</groupId>
                             <artifactId>zeebe-client-java</artifactId>
                             <version>${zeebe.version}</version>
                           </dependency>
                åˆ›å»ºå¼•å¯¼ç±»ï¼š
                    package io.zeebe;
                    import io.zeebe.client.ZeebeClient;

                    public class App{
                        public static void main(String[] args){
                            final ZeebeClient client = ZeebeClient.newClientBuilder()
                                // change the contact point if needed
                                .brokerContactPoint("127.0.0.1:26500")
                                .build();
                            System.out.println("Connected.");
                            // ...
                            client.close();
                            System.out.println("Closed.");
                        }
                    }
                æ„å»ºå¯æ‰§è¡Œjarï¼š mvn package   -->  java -jar target/${JAR file}
                    <plugin>
                      <groupId>org.apache.maven.plugins</groupId>
                      <artifactId>maven-shade-plugin</artifactId>
                      <version>2.3</version>
                      <executions>
                        <execution>
                          <phase>package</phase>
                          <goals>
                            <goal>shade</goal>
                          </goals>
                          <configuration>
                            <transformers>
                              <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                <mainClass>io.zeebe.App</mainClass>
                              </transformer>
                            </transformers>
                          </configuration>
                        </execution>
                      </executions>
                    </plugin>
                éƒ¨ç½²1ä¸ªå·¥ä½œæµï¼š
                    package io.zeebe;
                    import io.zeebe.client.api.response.DeploymentEvent;

                    public class Application{
                        public static void main(String[] args){
                            // after the client is connected
                            final DeploymentEvent deployment = client.newDeployCommand()
                                .addResourceFromClasspath("order-process.bpmn")
                                .send()
                                .join();

                            final int version = deployment.getWorkflows().get(0).getVersion();
                            System.out.println("Workflow deployed. Version: " + version);
                        }
                    }
                åˆ›å»º1ä¸ªå·¥ä½œæµå®ä¾‹ï¼š
                    package io.zeebe;
                    import io.zeebe.client.api.response.WorkflowInstanceEvent;

                    public class Application{
                        public static void main(String[] args){
                            // after the workflow is deployed

                            final WorkflowInstanceEvent wfInstance = client.newCreateInstanceCommand()
                                .bpmnProcessId("order-process")
                                .latestVersion()
                                .send()
                                .join();

                            final long workflowInstanceKey = wfInstance.getWorkflowInstanceKey();
                            System.out.println("Workflow instance created. Key: " + workflowInstanceKey);
                        }
                    }
                    éªŒè¯æ–¹å¼ï¼›dockerå¯åŠ¨ï¼Œè®¿é—®http://localhost:8082
                             å…¶ä»–æ–¹å¼å¯åŠ¨:Java -jar zeebe-simple-monitor-app-*.jar
                                        è®¿é—®http://localhost:8080/
                æ‰§è¡Œä¸€ä¸ªjobï¼š
                    package io.zeebe;
                    import io.zeebe.client.api.worker.JobWorker;

                    public class App{
                        public static void main(String[] args){
                            // after the workflow instance is created

                            final JobWorker jobWorker = client.newWorker()
                                .jobType("payment-service")
                                .handler((jobClient, job) ->{
                                    System.out.println("Collect money");
                                    // ...
                                    jobClient.newCompleteCommand(job.getKey())
                                        .send()
                                        .join();
                                })
                                .open();

                            // waiting for the jobs
                            // Don't close, we need to keep polling to get work
                            // jobWorker.close();
                        }
                    }
                æ•°æ®çš„å¤„ç†ä¼ é€’ï¼š
                    package io.zeebe;
                    public class App{
                        public static void main(String[] args){
                            // after the workflow is deployed

                            final Map<String, Object> data = new HashMap<>();
                            data.put("orderId", 31243);
                            data.put("orderItems", Arrays.asList(435, 182, 376));

                            final WorkflowInstanceEvent wfInstance = client.newCreateInstanceCommand()
                                .bpmnProcessId("order-process")
                                .latestVersion()
                                .variables(data)
                                .send()
                                .join();
                            // ...

                            final JobWorker jobWorker = client.newWorker()
                                .jobType("payment-service")
                                .handler((jobClient, job) ->{
                                    final Map<String, Object> variables = job.getVariablesAsMap();
                                    System.out.println("Process order: " + variables.get("orderId"));
                                    double price = 46.50;
                                    System.out.println("Collect money: $" + price);

                                    // ...

                                    final Map<String, Object> result = new HashMap<>();
                                    result.put("totalPrice", price);

                                    jobClient.newCompleteCommand(job.getKey())
                                        .variables(result)
                                        .send()
                                        .join();
                                })
                                .fetchVariables("orderId")
                                .open();
                            // ...
                        }
                    }
        8.3 æ—¥å¿—ï¼š
                ä½¿ç”¨SLF4Jè¿›è¡Œæ—¥å¿—è®°å½•
                <dependency>
                  <groupId>org.apache.logging.log4j</groupId>
                  <artifactId>log4j-slf4j-impl</artifactId>
                  <version>2.8.1</version>
                </dependency>

                <dependency>
                  <groupId>org.apache.logging.log4j</groupId>
                  <artifactId>log4j-core</artifactId>
                  <version>2.8.1</version>
                </dependency>

                é…ç½®æ–‡ä»¶ï¼š
                    <?xml version="1.0" encoding="UTF-8"?>
                    <Configuration status="WARN" strict="true"
                        xmlns="http://logging.apache.org/log4j/2.0/config"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:schemaLocation="http://logging.apache.org/log4j/2.0/config https://raw.githubusercontent.com/apache/logging-log4j2/log4j-2.8.1/log4j-core/src/main/resources/Log4j-config.xsd">
                      <Appenders>
                        <Console name="Console" target="SYSTEM_OUT">
                          <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level Java Client: %logger{36} - %msg%n"/>
                        </Console>
                      </Appenders>
                      <Loggers>
                        <Root level="info">
                          <AppenderRef ref="Console"/>
                        </Root>
                      </Loggers>
                    </Configuration>
        8.4 æµ‹è¯•æ¡ˆä¾‹ï¼š
                ä½¿ç”¨zeebe-testæ¨¡å—ç¼–å†™Junitæµ‹è¯•ï¼Œå¹¶æä¾›ä¸€äº›åŸºç¡€æ–­è¨€
                <dependency>
                  <groupId>io.zeebe</groupId>
                  <artifactId>zeebe-test</artifactId>
                  <scope>test</scope>
                </dependency>

                import io.zeebe.client.ZeebeClient;
                import io.zeebe.client.api.response.WorkflowInstanceEvent;
                import org.junit.Before;
                import org.junit.Rule;
                import org.junit.Test;

                public class MyTest {=
                  @Rule public final ZeebeTestRule testRule = new ZeebeTestRule();
                  private ZeebeClient client;

                  @Test
                  public void test() {
                    client = testRule.getClient();
                    client
                        .newDeployCommand()
                        .addResourceFromClasspath("process.bpmn")
                        .send()
                        .join();

                    final WorkflowInstanceEvent workflowInstance =
                        client
                            .newCreateInstanceCommand()
                            .bpmnProcessId("process")
                            .latestVersion()
                            .send()
                            .join();

                    ZeebeTestRule.assertThat(workflowInstance)
                        .isEnded()
                        .hasPassed("start", "task", "end")
                        .hasVariable("result", 21.0);
                  }
                }
        8.5 æ¡ˆä¾‹
            8.5.3 åˆ›å»ºéé˜»å¡çš„å·¥ä½œæµå®ä¾‹
                     final ZeebeFuture<WorkflowInstanceEvent> future =
                            client.newCreateInstanceCommand()
                              .bpmnProcessId(bpmnProcessId)
                              .latestVersion()
                              .send();
            8.5.4 æ‰“å¼€ä¸€ä¸ªjob workerï¼š
                    final JobWorker workerRegistration =
                            client
                              .newWorker()
                              .jobType(jobType)
                              .handler(new ExampleJobHandler())
                              .timeout(Duration.ofSeconds(10))
                              .open();

                     private static class ExampleJobHandler implements JobHandler {
                        @Override
                        public void handle(final JobClient client, final ActivatedJob job) {
                              System.out.println(job);
                              client.newCompleteCommand(job.getKey()).send().join();
                        }
                      }
            8.5.5 å¤„ç†å¯¹è±¡å˜é‡ï¼š
                    public class HandleVariablesAsPojo {
                      public static void main(final String[] args) {
                        final String broker = "127.0.0.1:26500";
                        final ZeebeClientBuilder builder = ZeebeClient.newClientBuilder().brokerContactPoint(broker);

                        try (ZeebeClient client = builder.build()) {
                          final Order order = new Order();
                          order.setOrderId(31243);

                          client
                              .newCreateInstanceCommand()
                              .bpmnProcessId("demoProcess")
                              .latestVersion()
                              .variables(order)
                              .send()
                              .join();

                          client.newWorker().jobType("foo").handler(new DemoJobHandler()).open();
                        }
                      }

                      private static class DemoJobHandler implements JobHandler {
                        @Override
                        public void handle(final JobClient client, final ActivatedJob job) {
                          final Order order = job.getVariablesAsType(Order.class);
                          System.out.println("new job with orderId: " + order.getOrderId());
                          order.setTotalPrice(46.50);
                          client.newCompleteCommand(job.getKey()).variables(order).send();
                        }
                      }

                      public static class Order {
                        private long orderId;
                        private double totalPrice;

                        public long getOrderId() {
                          return orderId;
                        }

                        public void setOrderId(final long orderId) {
                          this.orderId = orderId;
                        }

                        public double getTotalPrice() {
                          return totalPrice;
                        }

                        public void setTotalPrice(final double totalPrice) {
                          this.totalPrice = totalPrice;
                        }
                      }
                    }
            8.5.6 è¯·æ±‚é›†ç¾¤æ‹“æ‰‘é€»è¾‘
                    package io.zeebe.example.cluster;
                    import io.zeebe.client.ZeebeClient;
                    import io.zeebe.client.ZeebeClientBuilder;
                    import io.zeebe.client.api.response.Topology;

                    public class TopologyViewer {
                      public static void main(final String[] args) {
                        final String broker = "127.0.0.1:26500";
                        final ZeebeClientBuilder builder = ZeebeClient.newClientBuilder().brokerContactPoint(broker);

                        try (ZeebeClient client = builder.build()) {
                          System.out.println("Requesting topology with initial contact point " + broker);
                          final Topology topology = client.newTopologyRequest().send().join();

                          System.out.println("Topology:");
                          topology
                              .getBrokers()
                              .forEach(
                                  b -> {
                                    System.out.println("    " + b.getAddress());
                                    b.getPartitions()
                                        .forEach(
                                            p ->
                                                System.out.println(
                                                    "      " + p.getPartitionId() + " - " + p.getRole()));
                                  });
                          System.out.println("Done.");
                        }
                      }
                    }
    10.Zeebe Operationå·¥å…·
        å¼€å‘ç”¨dockerï¼Œç”Ÿäº§ç”¨kuberneteså’Œå®¹å™¨é•œåƒ
        10.1 zeebe.cfg.tomlé…ç½®æ–‡ä»¶
        10.2 è®¾ç½®é›†ç¾¤ï¼šä¸åŒçš„èŠ‚ç‚¹ï¼Œæœ‰ä¸åŒçš„é…ç½®ï¼Œ
                [cluster]
                nodeId = 0
                partitionsCount = 5
                replicationFactor = 3
                clusterSize = 5
                initialContactPoints = [
                  ADDRESS_AND_PORT_OF_NODE_0,
                  ADDRESS_AND_PORT_OF_NODE_1,
                  ADDRESS_AND_PORT_OF_NODE_2,
                  ADDRESS_AND_PORT_OF_NODE_3,
                  ADDRESS_AND_PORT_OF_NODE_4
                ]
    11.Operationçš„ç”¨æˆ·æŒ‡å¯¼
        11.1 æ’å…¥å’Œå¯åŠ¨ï¼šä½¿ç”¨zeebe-docker-compose
                cd camunda-operate-distro-1.0.0-*
                bin/operate
                
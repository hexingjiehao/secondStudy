1.é…ç½®kubernetesæ­¥éª¤å¦‚ä¸‹ï¼š
    0.é‡è¦çš„Hazelcast Kubernetesæ’ä»¶é¡µé¢ï¼š
        https://github.com/hazelcast/hazelcast-kubernetes

    1.åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸¤ä¸ªä¾èµ–ï¼š
        <dependency>
         <groupId>io.vertx</groupId>
         <artifactId>vertx-hazelcast</artifactId>
         <version>${vertx.version}</version>
        </dependency>
        <dependency>
         <groupId>com.hazelcast</groupId>
         <artifactId>hazelcast-kubernetes</artifactId>
         <version>${hazelcast-kubernetes.version}</version>
        </dependency>
        âš ï¸ï¼šå½“æ‰“åŒ…imagesæ—¶ï¼Œéœ€è¦æŸ¥çœ‹vertx-stack.jsonæ˜¯å¦æ·»åŠ äº†è¿™ä¸¤ä¸ªjaråŒ…
            hazelcast.xml

    2.åœ¨Hazlcastä¸­é…ç½®å‘ç°æ’ä»¶ï¼šé…ç½®æ–‡ä»¶åä¸ºcluster.xml
        è¿™ç§æ’ä»¶æä¾›ä¸¤ç§å‘ç°æ¨¡å¼ï¼šKubernetes API å’Œ DNS Lookup
        <hazelcast>
         <properties>
           <property name="hazelcast.discovery.enabled">true</property>
         </properties>

         <network>
           <join>
             <multicast enabled="false"/>
             <tcp-ip enabled="false" />

             <discovery-strategies>
               <discovery-strategy enabled="true"
                   class="com.hazelcast.kubernetes.HazelcastKubernetesDiscoveryStrategy">
                 <properties>
                   <property name="service-dns">MY-SERVICE-DNS-NAME</property>
                 </properties>
               </discovery-strategy>
             </discovery-strategies>
           </join>
         </network>
        </hazelcast>

        âš ï¸ï¼šMY-SERVICE-DNS-NAMEçš„å€¼å¿…é¡»æ˜¯headlessçš„k8sçš„Serviceå¯¹è±¡
            apiVersion: v1
            kind: Service
            metadata:
             namespace: MY-NAMESPACE
             name: MY-SERVICE-NAME
            spec:
             selector:
               component: MY-SERVICE-NAME
             clusterIP: None
             ports:
             - name: hz-port-name
               port: 5701
               protocol: TCP

        âš ï¸ï¼šå°†æ ‡ç­¾åŒ¹é…å¯¹åº”çš„éƒ¨ç½²ï¼Œç”¨äºæœåŠ¡å‘ç°
            apiVersion: extensions/v1beta1
            kind: Deployment
            metadata:
             namespace: MY-NAMESPACE
            spec:
             template:
               metadata:
                 labels:
                   component: MY-SERVICE-NAME
        âš ï¸ï¼šcluster.xmlæ–‡ä»¶æœ€ç»ˆåº”è¯¥æŒ‚è½½åˆ°å®¹å™¨ä¸­


å­¦ä¹ vert.x-hazelcastè¯­æ³•ï¼š
    1.æ¦‚å¿µï¼šåŸºäºå†…å­˜çš„ï¼Œå¯æ‰©å±•çš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼Œæ•°æ®ç¼“å­˜ã€‚vert.xçš„é›†ç¾¤ç®¡ç†çš„é»˜è®¤é¡¹ç›®å°±æ˜¯hazelcastã€‚
    2.ç‰¹ç‚¹ï¼šåŸºäºjavaç¼–å†™ã€‚åŸºäºTCPè¿æ¥è¿›è¡Œé›†ç¾¤äº¤äº’ã€‚é»˜è®¤271ä¸ªåˆ†åŒº(å†…å­˜è¢«æ‹†åˆ†)ï¼Œç”¨äºå†—ä½™å¤‡ä»½ã€‚æœ‰å†…åµŒæ¨¡å¼å’Œc/sæ¨¡å¼ã€‚
           æä¾›å¼€ç®±å³ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ç»“æ„ã€‚é›†ç¾¤ä¸ŠèŠ‚ç‚¹çš„åˆ†åŒºæ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œéƒ½æœ‰éƒ¨ä¸»åˆ†åŒºå’Œå‰¯æœ¬åˆ†åŒºã€‚
           æœ‰ä¸€ç§è½»é‡åŒ–èŠ‚ç‚¹ï¼Œä¸“èŒè®¡ç®—å’Œç›‘å¬ï¼Œä¸æŒæœ‰åˆ†åŒºæ•°æ®ã€‚æ•°æ®é€šè¿‡å“ˆå¸Œç®—æ³•è¢«åˆ†å¸ƒåˆ°ç‰¹å®šåˆ†åŒºã€‚
           å¯åŠ¨é›†ç¾¤èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œå­˜å‚¨åˆ†åŒºidå’Œå…¶ä»–èŠ‚ç‚¹ä¿¡æ¯ã€‚æ¯”å¦‚èŠ‚ç‚¹Açš„ç¬¬3åˆ†åŒºä¸Š
    3.jaråŒ…ä¾èµ–ï¼š<dependency>
                  <groupId>io.vertx</groupId>
                  <artifactId>vertx-hazelcast</artifactId>
                  <version>3.7.0</version>
                </dependency>
    4.åŠŸèƒ½ï¼š
        vert.xé›†ç¾¤ä¸­èŠ‚ç‚¹çš„å‘ç°å’Œç»„æˆå‘˜å…³ç³»
        ç»´æŠ¤é›†ç¾¤ä¸»é¢˜è®¢é˜…åˆ—è¡¨ï¼Œå“ªä¸ªèŠ‚ç‚¹å¯¹å“ªä¸ªäº‹ä»¶æ„Ÿå…´è¶£
        åˆ†å¸ƒå¼æ˜ å°„æ”¯æŒ
        åˆ†å¸ƒå¼é”
        åˆ†å¸ƒå¼è®¡æ•°å™¨
    5.ä½¿ç”¨é›†ç¾¤ç®¡ç†å™¨ï¼š
        ClusterManager mgr = new HazelcastClusterManager();
        VertxOptions options = new VertxOptions().setClusterManager(mgr);
        Vertx.clusteredVertx(options, res -> {
          if (res.succeeded()) {
            Vertx vertx = res.result();
          } else {
            // failed!
          }
        });
    6.é›†ç¾¤ç®¡ç†å™¨çš„é»˜è®¤é…ç½®ï¼šdefault-cluster.xmlã€‚å¯ä»¥é€šè¿‡é‡å†™æ–‡ä»¶cluster.xmlæ¥é‡æ–°é…ç½®ã€‚
        é›†ç¾¤å¯åŠ¨æ–¹æ³•ï¼šjava -jar ... -cp . -cluster ã€cluster.xmlæ–‡ä»¶åœ¨å½“å‰ç›®å½•ã€‘
                    java -jar ... -cp conf -cluster ã€cluster.xmlæ–‡ä»¶åœ¨confç›®å½•ã€‘
                    java -Dvertx.hazelcast.config=./config/my-cluster-config.xml -jar ... -cluster ã€ç³»ç»Ÿå±æ€§ã€‘
                    java -Dvertx.hazelcast.config=classpath:my/package/config/my-cluster-config.xml -jar ... -cluster
                    å¯ä»¥é€šè¿‡-Dhazelcast.max.no.heartbeat.seconds=5è®¾ç½®èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´ï¼Œç„¶åä»é›†ç¾¤ä¸­åˆ é™¤

    7.ä»£ç ä¸­é…ç½®é›†ç¾¤ç®¡ç†å™¨ï¼š
        ä½¿ç”¨é»˜è®¤cluster.xmlæ–‡ä»¶
            Config hazelcastConfig = new Config();
            ClusterManager mgr = new HazelcastClusterManager(hazelcastConfig);
            VertxOptions options = new VertxOptions().setClusterManager(mgr);
            Vertx.clusteredVertx(options, res -> {
              if (res.succeeded()) {
                Vertx vertx = res.result();
              } else {
                // failed!
              }
            });
        ä½¿ç”¨å…¶ä»–xmlæ–‡ä»¶ï¼š
            Config hazelcastConfig = ConfigUtil.loadConfig();
            hazelcastConfig.getGroupConfig()
              .setName("my-cluster-name")
              .setPassword("passwd");
            ClusterManager mgr = new HazelcastClusterManager(hazelcastConfig);
            VertxOptions options = new VertxOptions().setClusterManager(mgr);
            Vertx.clusteredVertx(options, res -> {
              if (res.succeeded()) {
                Vertx vertx = res.result();
              } else {
                // failed!
              }
            });
    8.ä½¿ç”¨å­˜åœ¨çš„hazelcasté›†ç¾¤å¯¹è±¡ï¼š
        ClusterManager mgr = new HazelcastClusterManager(hazelcastInstance);
        VertxOptions options = new VertxOptions().setClusterManager(mgr);
        Vertx.clusteredVertx(options, res -> {
          if (res.succeeded()) {
            Vertx vertx = res.result();
          } else {
            // failed!
          }
        });
    9.è‡ªå®šä¹‰hazelcastçš„xmlæ–‡ä»¶å†…å®¹ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            <properties>
             <property name="hazelcast.shutdownhook.enabled">false</property>
            </properties>

            <multimap name="__vertx.subs">
             <backup-count>1</backup-count>
            </multimap>

            <map name="__vertx.haInfo">
             <time-to-live-seconds>0</time-to-live-seconds>
             <max-idle-seconds>0</max-idle-seconds>
             <eviction-policy>NONE</eviction-policy>
             <max-size policy="PER_NODE">0</max-size>
             <eviction-percentage>25</eviction-percentage>
             <merge-policy>com.hazelcast.map.merge.LatestUpdateMapMergePolicy</merge-policy>
            </map>

            <semaphore name="__vertx.*">
             <initial-permits>1</initial-permits>
            </semaphore>
    10.å¸¸è§é›†ç¾¤é—®é¢˜ï¼š
        1.macç³»ç»Ÿçš„é»˜è®¤å¤šæ’­ç¦ç”¨
        2.ä½¿ç”¨é”™è¯¯çš„ç½‘ç»œæ¥å£ã€‚å½“å¯ç”¨VPNå¯å¯¼è‡´è¯¥ç»“æœã€‚è§£å†³æ–¹æ³•ï¼š<interfaces enabled="true">
                                                          <interface>192.168.1.20</interface>
                                                        </interfaces>

1.å­¦ä¹ vertxè‡ªå¸¦çš„Reactive PostgreSQL Client: ä¹Ÿå°±æ˜¯vertx-pg-client
    1.å®˜ç½‘åœ°å€ï¼šhttps://vertx.io/docs/vertx-pg-client/java/#_using_transactions
    2.å®šä¹‰ï¼šå®ƒæ˜¯PostgreSQLçš„å®¢æˆ·ç«¯ã€‚å“åº”å¼å’Œéé˜»å¡çš„ã€‚å¯ä»¥å•çº¿ç¨‹å¤„ç†å¤šä¸ªæ•°æ®åº“è¿æ¥ã€‚
    3.jaråŒ…ä¾èµ–ï¼š
        <dependency>
         <groupId>io.vertx</groupId>
         <artifactId>vertx-pg-client</artifactId>
         <version>3.8.4</version>
        </dependency>

        å¯èƒ½éœ€è¦çš„ä¾èµ–ï¼šnetty-transport-native
    4.å¼€å§‹ä»£ç ï¼š
        //å‡†å¤‡é…ç½®é¡¹
        PgConnectOptions connectOptions = new PgConnectOptions()
          .setPort(5432)
          .setHost("the-host")
          .setDatabase("the-db")
          .setUser("user")
          .setPassword("secret");
        PoolOptions poolOptions = new PoolOptions()
          .setMaxSize(5);

        //è¿æ¥æ± å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥å’Œvertxç»„åˆä½¿ç”¨
        PgPool client = PgPool.pool(connectOptions, poolOptions);
        PgPool client = PgPool.pool(vertx, connectOptions, poolOptions);

        client.query("SELECT * FROM users WHERE id='julien'", ar -> {
          if (ar.succeeded()) {
            RowSet<Row> result = ar.result();
            System.out.println("Got " + result.size() + " rows ");
          } else {
            System.out.println("Failure: " + ar.cause().getMessage());
          }
          client.close();
        });
    5.ç›¸åŒè¿æ¥æ‰§è¡Œå¤šä¸ªæ“ä½œï¼šconnectğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        client.getConnection(ar1 -> {
          if (ar1.succeeded()) {
            System.out.println("Connected");
            SqlConnection conn = ar1.result();

            // All operations execute on the same connection
            conn.query("SELECT * FROM users WHERE id='julien'", ar2 -> {
              if (ar2.succeeded()) {
                conn.query("SELECT * FROM users WHERE id='emad'", ar3 -> {
                  conn.close();
                });
              } else {
                conn.close();
              }
            });
          } else {
            System.out.println("Could not connect: " + ar1.cause().getMessage());
          }
        });
    6.ä½¿ç”¨äº‹åŠ¡ï¼šğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸
        ä½¿ç”¨è¿æ¥çš„äº‹åŠ¡ï¼š
            pool.getConnection(res -> {
              if (res.succeeded()) {
                SqlConnection conn = res.result();
                Transaction tx = conn.begin();

                conn.query("INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')", ar1 -> {
                  if (ar1.succeeded()) {
                    conn.query("INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')", ar2 -> {
                      if (ar2.succeeded()) {

                        //æäº¤äº‹åŠ¡
                        tx.commit(ar3 -> {
                          if (ar3.succeeded()) {
                            System.out.println("Transaction succeeded");
                          } else {
                            System.out.println("Transaction failed " + ar3.cause().getMessage());
                          }
                          conn.close();
                        });
                      } else {
                        conn.close();
                      }
                    });
                  } else {
                    conn.close();
                  }
                });
              }
            });
        ç›´æ¥ä½¿ç”¨äº‹åŠ¡ï¼šstart,commit,rollback
            pool.begin(res -> {
              if (res.succeeded()) {
                Transaction tx = res.result();

                //ç”¨äº‹åŠ¡çš„æ–¹å¼æŸ¥è¯¢
                tx.query("INSERT INTO Users (first_name,last_name) VALUES ('Julien','Viet')", ar1 -> {
                  if (ar1.succeeded()) {
                    tx.query("INSERT INTO Users (first_name,last_name) VALUES ('Emad','Alblueshi')", ar2 -> {
                      if (ar2.succeeded()) {

                        //æäº¤äº‹åŠ¡
                        tx.commit(ar3 -> {
                          if (ar3.succeeded()) {
                            System.out.println("Transaction succeeded");
                          } else {
                            System.out.println("Transaction failed " + ar3.cause().getMessage());
                          }
                        });
                      }
                    });
                  } else {
                    // ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ğŸŒ¿ï¼Œäº‹åŠ¡ç»ˆæ­¢æ—¶è‡ªåŠ¨å…³é—­
                  }
                });
              }
            });
        ç›´æ¥ä½¿ç”¨æœ€ä¸Šå±‚çˆ¶ç±»å¼•ç”¨ï¼šSqlClient
             ((PgPool) sqlClient).begin(begin -> {
                  if (begin.succeeded()) {
                    Transaction tx = begin.result();

                    txProcessor.apply(new PgWrapper(tx, sqlMapper, logger)).setHandler(ar ->

                      tx.commit(v -> {
                        if (v.succeeded()) {
                          logger.info("[{}][{}] transaction succeeded", name, txid);
                        } else {
                          logger.info("[{}][{}] transaction failed", name, txid);
                        }
                        resultHandler.handle(ar);
                      }));
                  } else {
                    resultHandler.handle(ServiceException.fail(INTERNAL_ERROR, begin.cause().getMessage()));
                  }
                });



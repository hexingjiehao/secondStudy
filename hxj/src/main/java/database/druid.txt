1.å­¦ä¹ druidçš„çŸ¥è¯†ç‚¹
    è¿™é‡Œæœ‰ä¸¤ä¸ªdruid,ä¸€ä¸ªæ˜¯apacheçš„ï¼Œä¸€ä¸ªæ˜¯alibabaçš„ã€‚åˆ†åˆ«è¿›è¡Œå­¦ä¹ ã€‚

2.apache druidçŸ¥è¯†ç‚¹çš„å­¦ä¹ 
    1.å®˜æ–¹ç½‘ç«™ï¼šhttps://druid.apache.org
    2.å®šä¹‰ï¼šApache Druidæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å®æ—¶åˆ†ææ•°æ®åº“ã€‚
           æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“ã€‚
    3.æœ€æ–°ç‰ˆæœ¬ï¼š0.16.0-Incubting
    4.æºä»£ç ä»“åº“ï¼šhttps://github.com/apache/incubator-druid/
    5.å­¦ä¹ å®˜æ–¹æ–‡æ¡£ï¼šhttps://druid.apache.org/docs/latest/design/
        1.å¼€å§‹
            Apache Druidæ˜¯ä¸€ä¸ªè®¾è®¡ç”¨äºå¿«é€Ÿåˆ‡ç‰‡åˆ†æ(â€œOLAPâ€æŸ¥è¯¢)çš„å¤§æ•°æ®é›†å®æ—¶åˆ†ææ•°æ®åº“ã€‚
            Druidçš„æ ¸å¿ƒæ¶æ„ç»“åˆäº†æ•°æ®ä»“åº“ã€timeseriesæ•°æ®åº“å’Œæ—¥å¿—æœç´¢ç³»ç»Ÿçš„æ€æƒ³ã€‚
            ç‰¹ç‚¹å¦‚ä¸‹ï¼š
                æŒ‰ç…§åˆ—è¿›è¡Œå­˜å‚¨ï¼šæé«˜æŸ¥è¯¢é€Ÿåº¦
                å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†
                å®æ—¶å’Œæ‰¹é‡è·å–å¤§æ•°æ®
                è¿›è¡Œå¿«é€ŸæŸ¥è¯¢çš„ç´¢å¼•
                åŸºäºæ—¶é—´çš„åˆ†åŒº
                è¿‘ä¼¼æ’åºç®—æ³•
            ä½¿ç”¨åœºæ™¯ï¼š
                å¤§é‡æ’å…¥,å°‘é‡æ›´æ–°
                å¤§æ•°æ®çš„æŸ¥è¯¢
                ä»kafkaï¼ŒHFDFSç­‰å¯¹è±¡ä¸­åŠ è½½æ•°æ®
            druidæš‚ä¸æ”¯æŒåœ¨windowsä¸Šè¿›è¡Œè½¯ä»¶å®‰è£…
            å•æœºéƒ¨ç½²ï¼š4CPU/16GB RAMï¼Œmicro-quickstarté…ç½®æ–‡ä»¶
            ç¯å¢ƒå‡†å¤‡ï¼š
                java8+
                macç³»ç»Ÿ
                apache-druid-0.16.0-incubating-bin.tar.gz
                zookeeper-3.4.14.tar.gz     //åˆ†å¸ƒå¼éƒ¨ç½²druidæ—¶ï¼Œéœ€è¦çš„ä¾èµ–ã€æ¨èçš„åŒ…ã€‘
                    âš ï¸âš ï¸ï¼šzookeeperè½¯ä»¶åŒ…éœ€è¦é‡å‘½åæˆzkï¼Œç„¶åå°†å®ƒæ”¾åœ¨druidçš„æ ¹ç›®å½•ä¸‹
                    å¦‚æœä¸‹è½½3.5.5ä»¥åçš„ç‰ˆæœ¬çš„Zookeeperå®‰è£…åŒ…ï¼Œæˆ‘ä»¬ä¹–ä¹–çš„ä¸‹è½½å¸¦æœ‰binæ ‡è¯†çš„åŒ…å°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚
            å¯åŠ¨DruidæœåŠ¡ï¼šé»˜è®¤ä½¿ç”¨äº†ç«¯å£8081,8082,8888
                ./bin/start-micro-quickstart
                è®¿é—®åœ°å€ï¼šhttp://localhost:8888
            å¹²å‡€çš„åŠ è½½æ•°æ®ï¼š
                åˆ é™¤druidè½¯ä»¶åŒ…ä¸‹varç›®å½•
                rm -rf /tmp/kafka-logs
            å„ç§è§„æ¨¡çš„å¯åŠ¨è„šæœ¬ï¼š
                nano-quickstart: 1CPU,4GB RAM
                    bin/start-nano-quickstart
                    conf/druid/single-server/nano-quickstart
                micro-quickstartï¼š4CPU,16GB RAM
                    bin/start-micro-quickstart
                    conf/druid/single-server/micro-quickstart
                small: 8CPU,64GB RAM
                    bin/start-small
                    conf/druid/single-server/small
                medium: 16CPU,128GB RAM
                    bin/start-medium
                    conf/druid/single-server/medium
                large: 32CPU,256GB RAM
                    bin/start-large
                    conf/druid/single-server/large
                x-large: 64CPU,512GB
                    bin/start-xlarge
                    conf/druid/single-server/xlarge
            é›†ç¾¤éƒ¨ç½²ï¼šğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸
                masteræœåŠ¡å™¨ï¼šconf/druid/cluster/master
                    bin/start-cluster-master-no-zk-server
                    bin/start-cluster-master-with-zk-server
                dataæœåŠ¡å™¨ï¼šconf/druid/cluster/data
                    bin/start-cluster-data-server
                queryæœåŠ¡å™¨ï¼šconf/druid/cluster/query
                    bin/start-cluster-query-server
            æ•°æ®è¿ç§»ï¼š
                å¤‡ä»½é…ç½®conf/druid/clusterç›®å½•
            ä»£ç ä¸­å…·ä½“çš„å­˜å‚¨é…ç½®ï¼š
                druid.extensions.loadList=["druid-s3-extensions"]

                #druid.storage.type=local
                #druid.storage.storageDirectory=var/druid/segments

                druid.storage.type=s3
                druid.storage.bucket=your-bucket
                druid.storage.baseKey=druid/segments
                druid.s3.accessKey=...
                druid.s3.secretKey=...

                #druid.indexer.logs.type=file
                #druid.indexer.logs.directory=var/druid/indexing-logs

                druid.indexer.logs.type=s3
                druid.indexer.logs.s3Bucket=your-bucket
                druid.indexer.logs.s3Prefix=druid/indexing-logs
        2.æ•™ç¨‹ï¼š
            åŠ è½½æ–‡ä»¶æ•°æ®ï¼šæœ¬è´¨æ˜¯å°†æ•°æ®æ–‡ä»¶è½¬åŒ–ä¸ºè§„åˆ™çš„æ•°æ®åº“æ•°æ®ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                å¡«å†™ç›®å½•(åœ¨druidçš„æ ¹ç›®å½•ä¸‹å¼€å¤´)ï¼š/Users/admin/Downloads/software/apache-druid-0.16.0-incubating/quickstart/tutorial
                å¡«å†™è¿‡æ»¤è§„åˆ™(å…·ä½“æ–‡ä»¶)ï¼šwikiticker-2015-09-12-sampled.json.gz


æœ¬è´¨æ›´åƒæ˜¯è½¯ä»¶çš„æ“ä½œæ‰‹å†Œã€‚å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸´æ—¶æ•°æ®åº“ï¼Œä½¿ç”¨æµè§ˆå™¨ä½œä¸ºç®¡ç†å™¨
æœªå®Œå¾…ç»­......


3.alibaba druidçŸ¥è¯†ç‚¹çš„å­¦ä¹ 
    1.æºä»£ç ä»“åº“ï¼šhttps://github.com/alibaba/druid/
    2.å®šä¹‰ï¼šDruidæ˜¯Javaè¯­è¨€ä¸­æœ€å¥½çš„æ•°æ®åº“è¿æ¥æ± ã€‚Druidèƒ½å¤Ÿæä¾›å¼ºå¤§çš„ç›‘æ§å’Œæ‰©å±•åŠŸèƒ½ã€‚
    3.ä¸‹è½½åœ°å€ï¼šmavenä¸­å¤®ä»“åº“: http://central.maven.org/maven2/com/alibaba/druid/
    4.jaråŒ…ä¾èµ–ï¼š
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>${druid-version}</version>
        </dependency>
    5.æ‰“å¼€ç›‘æ§åŠŸèƒ½ï¼š
        Druidå†…ç½®æä¾›ä¸€ä¸ªStatFilterï¼Œç”¨äºç»Ÿè®¡ç›‘æ§ä¿¡æ¯
        å¸¸è§çš„4ç§è¿‡æ»¤å™¨é…ç½®ï¼š
            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
                ... ...
                <property name="filters" value="stat" />
                <property name="filters" value="stat,log4j" />
            </bean>

            <bean id="stat-filter" class="com.alibaba.druid.filter.stat.StatFilter">
            	<property name="slowSqlMillis" value="10000" />
            	<property name="logSlowSql" value="true" />
            </bean>
            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
            	<property name="proxyFilters">
            		<list>
            			<ref bean="stat-filter" />
            		</list>
            	</property>
            </bean>

            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
              	... ...
              	<property name="filters" value="stat" />
              	<property name="connectionProperties" value="druid.stat.mergeSql=true" />
            </bean>
        æŸ¥çœ‹æ…¢sqlè¯­å¥ï¼š
            <bean id="stat-filter" class="com.alibaba.druid.filter.stat.StatFilter">
            	<property name="slowSqlMillis" value="10000" />
            	<property name="logSlowSql" value="true" />
            </bean>
    6.Druidæ€ä¹ˆé˜²å¾¡SQLæ³¨å…¥æ”»å‡»ï¼šWallFilter
        <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
              ...
              <property name="filters" value="wall"/>
        </bean>
        ç¬¬äºŒç§æ–¹æ³•ï¼šæŒ‡å®šdbType ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            <bean id="wall-filter" class="com.alibaba.druid.wall.WallFilter">
                  <property name="dbType" value="mysql" />
            </bean>

            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
              ...
              <property name="proxyFilters">
                  <list>
                      <ref bean="wall-filter"/>
                  </list>
              </property>
            </bean>
    7.Druidçš„å‚è€ƒåº”ç”¨é…ç½®ï¼šğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸
        1.é€šç”¨é…ç½®ï¼šå‚è€ƒçš„DBCP
            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
                 <property name="url" value="${jdbc_url}" />
                 <property name="username" value="${jdbc_user}" />
                 <property name="password" value="${jdbc_password}" />

                 <property name="filters" value="stat" />

                 <property name="maxActive" value="20" />
                 <property name="initialSize" value="1" />
                 <property name="maxWait" value="60000" />
                 <property name="minIdle" value="1" />

                 <property name="timeBetweenEvictionRunsMillis" value="60000" />
                 <property name="minEvictableIdleTimeMillis" value="300000" />

                 <property name="testWhileIdle" value="true" />
                 <property name="testOnBorrow" value="false" />
                 <property name="testOnReturn" value="false" />

                 <property name="poolPreparedStatements" value="true" />
                 <property name="maxOpenPreparedStatements" value="20" />

                 <property name="asyncInit" value="true" />
             </bean>
    8.å°†æ‰§è¡Œçš„sqlè¯­å¥è¾“å‡ºåˆ°æ—¥å¿—ï¼š
        1.åˆ«åæ˜ å°„ï¼šMETA-INF/druid-filter.propertiesæ–‡ä»¶
            druid.filters.log4j=com.alibaba.druid.filter.logging.Log4jFilter
            druid.filters.log4j2=com.alibaba.druid.filter.logging.Log4j2Filter
            druid.filters.slf4j=com.alibaba.druid.filter.logging.Slf4jLogFilter
            druid.filters.commonlogging=com.alibaba.druid.filter.logging.CommonsLogFilter
            druid.filters.commonLogging=com.alibaba.druid.filter.logging.CommonsLogFilter
        2.loggerNameé…ç½®:
            public abstract class LogFilter {
                  protected String dataSourceLoggerName = "druid.sql.DataSource";
                  protected String connectionLoggerName = "druid.sql.Connection";
                  protected String statementLoggerName = "druid.sql.Statement";
                  protected String resultSetLoggerName = "druid.sql.ResultSet";
            }
        3.é…ç½®è¾“å‡ºæ—¥å¿—:
            <bean id="log-filter" class="com.alibaba.druid.filter.logging.Log4jFilter">
                <property name="resultSetLogEnabled" value="false" />
            </bean>

            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
                ...
                <property name="proxyFilters">
                    <list>
                        <ref bean="log-filter"/>
                    </list>
                </property>
            </bean>
        4.log4j.propertiesé…ç½®:
            log4j.logger.druid.sql=warn,stdout
            log4j.logger.druid.sql.DataSource=warn,stdout
            log4j.logger.druid.sql.Connection=warn,stdout
            log4j.logger.druid.sql.Statement=warn,stdout
            log4j.logger.druid.sql.ResultSet=warn,stdout
        5.è¾“å‡ºå¯æ‰§è¡Œçš„SQL:
            -Ddruid.log.stmt.executableSql=true
            <bean id="log-filter" class="com.alibaba.druid.filter.logging.Log4jFilter">
                <property name="statementExecutableSqlLogEnable" value="true" />
            </bean>
    9.åŠ å¯†æ•°æ®åº“å¯†ç ï¼šConfigFilter
        å‘½ä»¤è¡Œç”Ÿæˆå¯†ç ï¼š
            java -cp druid-1.0.16.jar com.alibaba.druid.filter.config.ConfigTools you_password
        é…ç½®æ•°æ®æºï¼Œå¯¹å¯†ç è§£å¯†ï¼š
            <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">
                 <property name="url" value="jdbc:derby:memory:spring-test;create=true" />
                 <property name="username" value="sa" />
                 <property name="password" value="${password}" />
                 <property name="filters" value="config" />
                 <property name="connectionProperties" value="config.decrypt=true;config.decrypt.key=${publickey}" />
            </bean>
        é…ç½®å‚æ•°ï¼Œä½¿ç”¨ConfgFilterè§£å¯†å¯†ç ï¼š
            my.propertiesä¸­æŒ‡å®šconfig.decrypt=true
            DruidDataSourceçš„ConnectionPropertiesä¸­æŒ‡å®šconfig.decrypt=true
            jvmå¯åŠ¨å‚æ•°ä¸­æŒ‡å®š-Ddruid.config.decrypt=true
    10.å¦‚ä½•åœ¨Spring Bootä¸­é›†æˆDruidè¿æ¥æ± å’Œç›‘æ§ï¼ŸğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸ğŸ€„ï¸
        1.jaråŒ…ä¾èµ–ï¼š<dependency>
                      <groupId>com.alibaba</groupId>
                      <artifactId>druid-spring-boot-starter</artifactId>
                      <version>1.1.17</version>
                    </dependency>
        2.é…ç½®å±æ€§ï¼š
            JDBCé…ç½®ï¼šå¤šæ•°æ®æº
                spring.datasource.druid.url=
                spring.datasource.druid.username=
                spring.datasource.druid.password=
                spring.datasource.druid.driver-class-name=

                # Druid æ•°æ®æº 1 é…ç½®ï¼Œç»§æ‰¿spring.datasource.druid.* é…ç½®ï¼Œç›¸åŒåˆ™è¦†ç›–
                spring.datasource.druid.one.max-active=10
                spring.datasource.druid.one.max-wait=10000

                # Druid æ•°æ®æº 2 é…ç½®ï¼Œç»§æ‰¿spring.datasource.druid.* é…ç½®ï¼Œç›¸åŒåˆ™è¦†ç›–
                spring.datasource.druid.two.max-active=20
                spring.datasource.druid.two.max-wait=20000

                @Primary
                @Bean
                @ConfigurationProperties("spring.datasource.druid.one")
                public DataSource dataSourceOne(){
                    return DruidDataSourceBuilder.create().build();
                }
                @Bean
                @ConfigurationProperties("spring.datasource.druid.two")
                public DataSource dataSourceTwo(){
                    return DruidDataSourceBuilder.create().build();
                }

            è¿æ¥æ± é…ç½®ï¼š
                spring.datasource.druid.initial-size=
                spring.datasource.druid.max-active=
                spring.datasource.druid.min-idle=
                spring.datasource.druid.max-wait=
                spring.datasource.druid.pool-prepared-statements=
                spring.datasource.druid.max-pool-prepared-statement-per-connection-size=
                spring.datasource.druid.max-open-prepared-statements= #å’Œä¸Šé¢çš„ç­‰ä»·
                spring.datasource.druid.validation-query=
                spring.datasource.druid.validation-query-timeout=
                spring.datasource.druid.test-on-borrow=
                spring.datasource.druid.test-on-return=
                spring.datasource.druid.test-while-idle=
                spring.datasource.druid.time-between-eviction-runs-millis=
                spring.datasource.druid.min-evictable-idle-time-millis=
                spring.datasource.druid.max-evictable-idle-time-millis=
                spring.datasource.druid.filters= #é…ç½®å¤šä¸ªè‹±æ–‡é€—å·åˆ†éš”
            ç›‘æ§é…ç½®ï¼šFilter
                # WebStatFilteré…ç½®ï¼Œè¯´æ˜è¯·å‚è€ƒDruid Wikiï¼Œé…ç½®_é…ç½®WebStatFilter
                spring.datasource.druid.web-stat-filter.enabled= #æ˜¯å¦å¯ç”¨StatFilteré»˜è®¤å€¼false
                spring.datasource.druid.web-stat-filter.url-pattern=
                spring.datasource.druid.web-stat-filter.exclusions=
                spring.datasource.druid.web-stat-filter.session-stat-enable=
                spring.datasource.druid.web-stat-filter.session-stat-max-count=
                spring.datasource.druid.web-stat-filter.principal-session-name=
                spring.datasource.druid.web-stat-filter.principal-cookie-name=
                spring.datasource.druid.web-stat-filter.profile-enable=

                # StatViewServleté…ç½®ï¼Œè¯´æ˜è¯·å‚è€ƒDruid Wikiï¼Œé…ç½®_StatViewServleté…ç½®
                spring.datasource.druid.stat-view-servlet.enabled= #æ˜¯å¦å¯ç”¨StatViewServletï¼ˆç›‘æ§é¡µé¢ï¼‰é»˜è®¤å€¼ä¸ºfalseï¼ˆè€ƒè™‘åˆ°å®‰å…¨é—®é¢˜é»˜è®¤å¹¶æœªå¯åŠ¨ï¼Œå¦‚éœ€å¯ç”¨å»ºè®®è®¾ç½®å¯†ç æˆ–ç™½åå•ä»¥ä¿éšœå®‰å…¨ï¼‰
                spring.datasource.druid.stat-view-servlet.url-pattern=
                spring.datasource.druid.stat-view-servlet.reset-enable=
                spring.datasource.druid.stat-view-servlet.login-username=
                spring.datasource.druid.stat-view-servlet.login-password=
                spring.datasource.druid.stat-view-servlet.allow=
                spring.datasource.druid.stat-view-servlet.deny=

                # Springç›‘æ§é…ç½®ï¼Œè¯´æ˜è¯·å‚è€ƒDruid Github Wikiï¼Œé…ç½®_Druidå’ŒSpringå…³è”ç›‘æ§é…ç½®
                spring.datasource.druid.aop-patterns= # Springç›‘æ§AOPåˆ‡å…¥ç‚¹ï¼Œå¦‚x.y.z.service.*,é…ç½®å¤šä¸ªè‹±æ–‡é€—å·åˆ†éš”
        3.æ•°æ®åº“å¯†ç åŠ å¯†ï¼š
            spring.datasource.url=jdbc:mysql://localhost:3306/test
            spring.datasource.username=root
            # ç”Ÿæˆçš„åŠ å¯†åçš„å¯†ç ï¼ˆåŸå¯†ç  123456ï¼‰
            spring.datasource.password=WVMjPhfXQrIsWRo0/RCqAVvYtTU9WNVToKJohb8AlUmHwnV6vwFL+FM2CNFDMJwGHW1iCmyaUlF+sgvFdogqEA==

            # ç”Ÿæˆçš„å…¬é’¥
            public-key=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIiwHpFrDijV+GzwRTzWJk8D3j3jFfhsMFJ/7k1NTvBuLgL+TdIHgaMNOIEjHpXzuvX38J3FtOK8hLrySncVGOMCAwEAAQ==

            # é…ç½® connection-propertiesï¼Œå¯ç”¨åŠ å¯†ï¼Œé…ç½®å…¬é’¥ã€‚
            spring.datasource.druid.connection-properties=config.decrypt=true;config.decrypt.key=${public-key}

            # å¯ç”¨ConfigFilter
            spring.datasource.druid.filter.config.enabled=true
        4.è®¾ç½®è‡ªåŠ¨æµ‹è¯•è¿æ¥çŠ¶æ€ï¼š
            <!-- ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¸¸ç”¨select 'x'ã€‚å¦‚æœvalidationQueryä¸ºnullï¼ŒtestOnBorrowã€testOnReturnã€testWhileIdleéƒ½ä¸ä¼šèµ·ä½œç”¨ã€‚ -->
            <property name="validationQuery" value="SELECT 1" />
            <property name="testOnBorrow" value="false" />
            <property name="testOnReturn" value="false" />
            <property name="testWhileIdle" value="true" />




















1.å­¦ä¹ zookeeperçš„çŸ¥è¯†ç‚¹ï¼š
    1.å®˜ç½‘åœ°å€ï¼šhttps://zookeeper.apache.org
    2.æœ¬è´¨ï¼šzookeeper=æ–‡ä»¶ç³»ç»Ÿ+ç›‘å¬é€šçŸ¥æœºåˆ¶ã€‚ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿

           ZooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯Googleçš„Chubbyä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶ã€‚
           å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚
    3.å®šä¹‰ï¼šã€å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè½¯ä»¶ã€‘ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        ZooKeeperæ˜¯ä¸€ä¸ªé›†ä¸­çš„æœåŠ¡ï¼Œç”¨äºç»´æŠ¤é…ç½®ä¿¡æ¯ã€å‘½åã€æä¾›åˆ†å¸ƒå¼åŒæ­¥å’Œæä¾›ç»„æœåŠ¡
    4.ç‰ˆæœ¬ï¼š3.5.6 è€Œä¸”jaråŒ…éå¸¸å°å·§
    5.æ–‡æ¡£çŸ¥è¯†ç‚¹å­¦ä¹ ï¼š
        1.ç»¼è¿°ï¼šzookeeperæ˜¯ç®€å•
               zookeeperæ˜¯å¤æœ¬çš„
               zookeeperæ˜¯æœ‰åºçš„
               zookeeperæ˜¯å¿«é€Ÿçš„
        2.æ•™ç¨‹ï¼š
            é…ç½®æ–‡ä»¶ï¼šconf/zoo.cfg
                tickTime=2000
                dataDir=/var/lib/zookeeper
                clientPort=2181
            å¯åŠ¨zookeeper: bin/zkServer.sh start ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            ä½¿ç”¨å‘½ä»¤è¡Œè¿æ¥zookeeper:
                 bin/zkCli.sh -server 127.0.0.1:2181
        3.Zookeeperçš„ç¨‹åºå‘˜æŒ‡å¯¼ï¼šæ–‡ä»¶æ ‘ç»“æ„ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²
            Zookeeper æ•°æ®æ¨¡å‹ï¼šåˆ†å±‚çš„åç§°ç©ºé—´ï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚
                ZNodesï¼šZooKeeperæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¢«ç§°ä¸ºznodeã€‚
                Watches:åœ¨èŠ‚ç‚¹ä¸Šè®¾ç½®ç›‘å¬å™¨ã€‚èŠ‚ç‚¹æ”¹å˜ä¼šè§¦å‘ç›‘å¬å™¨
                Data Access: èŠ‚ç‚¹ä¸Šçš„å‘½åç©ºé—´çš„æ•°æ®æ˜¯è‡ªåŠ¨è¯»å†™çš„
            Zookeeper Sessions:
                å¼€å§‹-->è¿æ¥ing-->è¿æ¥å®Œæˆ-->sessionè¿‡æœŸ-->è¿æ¥ä¸¢å¤±-->å…³é—­
            Zookeeper Watchesï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                zookeeperä¸­çš„è¯»å–æ•°æ®æ–¹æ³•ã€getData(),getChildren(),exists()ã€‘å¯ä»¥è®¾ç½®watch
                One-time trigger: ä¸€ä¸ªwatchäº‹ä»¶å°†ä¼šå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå½“æ•°æ®æ”¹å˜æ—¶
                sent to the client: æ„å‘³ç€ä¸€ä¸ªäº‹ä»¶æ­£åœ¨å‘é€åˆ°å®¢æˆ·ç«¯
                the data for which the watch was set: ä¸€ä¸ªèŠ‚ç‚¹æ”¹å˜çš„ä¸åŒæ–¹å¼
                èƒ½å¤Ÿè§¦å‘watchçš„è¯­æ³•:
                    created event:
                    delete event:
                    changed event:
                    child event:
                åˆ é™¤watches:
                    child remove event:
                    data remove event:
        4.zookeeperçš„javaä»£ç ä¸¾ä¾‹ï¼š
            public static void main(String[] args) {
                if (args.length < 4) {
                    System.err
                            .println("USAGE: Executor hostPort znode filename program [args ...]");
                    System.exit(2);
                }
                String hostPort = args[0];
                String znode = args[1];
                String filename = args[2];
                String exec[] = new String[args.length - 3];
                System.arraycopy(args, 3, exec, 0, exec.length);
                try {
                    new Executor(hostPort, znode, filename, exec).run();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }

            public Executor(String hostPort, String znode, String filename,String exec[]) throws KeeperException, IOException {
                this.filename = filename;
                this.exec = exec;
                zk = new ZooKeeper(hostPort, 3000, this);
                dm = new DataMonitor(zk, znode, null, this);
            }

            public void run() {
                try {
                    synchronized (this) {
                        while (!dm.dead) {
                            wait();
                        }
                    }
                } catch (InterruptedException e) {
                }
            }

            æ‰§è¡Œå™¨ï¼špublic class Executor implements Watcher, Runnable, DataMonitor.DataMonitorListener
        5.ä½¿ç”¨zookeeperå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä»£ç æ•™ç¨‹ï¼š
            zookeeper server è¿è¡Œä¸­ï¼šä¿¡å·é‡
            static ZooKeeper zk = null;
            static Integer mutex;
            String root;

            SyncPrimitive(String address) {
                if(zk == null){
                    try {
                        System.out.println("Starting ZK:");
                        zk = new ZooKeeper(address, 3000, this);
                        mutex = new Integer(-1);
                        System.out.println("Finished starting ZK: " + zk);
                    } catch (IOException e) {
                        System.out.println(e.toString());
                        zk = null;
                    }
                }
            }

            synchronized public void process(WatchedEvent event) {
                synchronized (mutex) {
                    mutex.notify();
                }
            }

æœªå®Œå¾…ç»­......







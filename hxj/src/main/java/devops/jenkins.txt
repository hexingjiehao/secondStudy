1.å­¦ä¹ Jenkinsçš„çŸ¥è¯†ç‚¹ï¼š
    1.å®˜ç½‘åœ°å€ï¼šhttps://jenkins.io/zh/node
    2.æ¦‚è¿°ï¼šJenkinsæ˜¯ä¸€ä¸ªjavaç¼–å†™çš„æœåŠ¡å™¨è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚
           æŒç»­é›†æˆ(CI) / æŒç»­äº¤ä»˜ (CD)
    3.å®˜æ–¹æ–‡æ¡£ï¼šhttp://jenkins.io/zh/doc/
    4.å®‰è£…åŒ…ä¸‹è½½ï¼š
        æœ€æ–°ç‰ˆæœ¬ä¸º2.206
        é»˜è®¤ç”¨æˆ·åå¯†ç ï¼šadmin
            å¯†ç åœ¨æ–‡ä»¶ï¼š/Users/admin/.jenkins/secrets/initialAdminPasswordæ–‡ä»¶ä¸­
    4.Jenkinså…¥é—¨æ•™ç¨‹ï¼šã€ä¸»è¦æ˜¯ç”¨äºå‰ç«¯é¡µé¢çš„éƒ¨ç½²ã€‘
        1.ä¸‹è½½å¹¶è¿è¡Œï¼š[åŠ è½½æ—¶é—´è¾ƒé•¿]
            brew install jenkins    //å®‰è£…
            brew uninstall jenkins  //å¸è½½
            java -jar jenkins.war --httpPort=8080
            âš ï¸ï¼šåˆæ¬¡å¯åŠ¨æ—¶è¦æ£€æŸ¥url,è§£å†³åŠæ³•ï¼šç¿»å¢™æˆ–è€…ä¿®æ”¹æ–‡ä»¶å†…å®¹
                éœ€è¦ä½ è¿›å…¥jenkinsçš„å·¥ä½œç›®å½•ï¼Œæ‰“å¼€
                    hudson.model.UpdateCenter.xml
                æŠŠ
                    http://updates.jenkins-ci.org/update-center.json
                æ”¹æˆ
                    http://mirror.xmission.com/jenkins/updates/update-center.json
            âš ï¸ï¼šåˆå§‹åŒ–æ—¶ï¼Œè¦å®‰è£…ä¸€ç³»åˆ—çš„æ’ä»¶ï¼Œéå¸¸è€—æ—¶ï¼Œæ¨èå®‰è£…ä¸€æ¬¡å°±ä¸è¦å…³é—­äº†
        2.åˆ›å»ºæµæ°´çº¿Pipelineï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼š
            2.1 åˆ›å»ºæ–‡ä»¶Jenkinsfile:å†…å®¹å¦‚ä¸‹ï¼š
                pipeline {
                    agent { docker 'maven:3.3.3' }
                    stages {
                        stage('build') {
                            steps {
                                sh 'mvn --version'
                            }
                        }
                    }
                }
            2.2 å°†æ–‡ä»¶Jenkinså­˜æ”¾åˆ°æˆ‘çš„githubä¸Šçš„ä¸€ä¸ªmvnä»“åº“ä¸­
            2.3 åœ¨Jenkinsçš„æµè§ˆå™¨ä¸­åˆ›å»ºéƒ¨ç½²é¡¹ï¼Œé€‰æ‹©githubä¸Šçš„æ–‡ä»¶
        3.æ‰§è¡Œå¤šä¸ªæ­¥éª¤(step): ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            æŒ‰é¡ºåºé€æ­¥æ‰§è¡Œï¼Œå…¨éƒ¨stepæ‰§è¡ŒæˆåŠŸï¼Œpipelineæ‰æ‰§è¡ŒæˆåŠŸã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š
            pipeline {
                agent any
                stages {
                    stage('Build') {
                        steps {
                            sh 'echo "Hello World"'
                            sh '''
                                echo "Multiline shell steps works too"
                                ls -lah
                            '''
                        }
                    }
                }
            }
            è®¾ç½®è¶…æ—¶ã€é‡è¯•ç­‰æ“ä½œï¼š
                pipeline {
                    agent any
                    stages {
                        stage('Deploy') {
                            steps {
                                retry(3) {
                                    sh './flakey-deploy.sh'
                                }

                                timeout(time: 3, unit: 'MINUTES') {
                                    sh './health-check.sh'
                                }
                            }
                        }
                    }
                }
            å®Œæˆæ—¶åŠ¨ä½œï¼šç­‰ä»·äºåˆå§‹åŒ–åçš„æ“ä½œ
                pipeline {
                    agent any
                    stages {
                        stage('Test') {
                            steps {
                                sh 'echo "Fail!"; exit 1'
                            }
                        }
                    }
                    post {
                        always {
                            echo 'This will always run'
                        }
                        success {
                            echo 'This will run only if successful'
                        }
                        failure {
                            echo 'This will run only if failed'
                        }
                        unstable {
                            echo 'This will run only if the run was marked as unstable'
                        }
                        changed {
                            echo 'This will run only if the state of the Pipeline has changed'
                            echo 'For example, if the Pipeline was previously failing but is now successful'
                        }
                    }
                }
        4.å®šä¹‰æ‰§è¡Œç¯å¢ƒï¼š
            agentæŒ‡ä»¤å‘Šè¯‰Jenkinsåœ¨å“ªé‡Œä»¥åŠå¦‚ä½•æ‰§è¡ŒPipelineæˆ–è€…Pipelineå­é›†
                pipeline {
                    agent {
                        docker { image 'node:7-alpine' }
                    }
                    stages {
                        stage('Test') {
                            steps {
                                sh 'node --version'
                            }
                        }
                    }
                }
        5.ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼šå…¨å±€çš„å’Œé˜¶æ®µçš„
            pipeline {
                agent any
                environment {
                    DISABLE_AUTH = 'true'
                    DB_ENGINE    = 'sqlite'
                }
                stages {
                    stage('Build') {
                        steps {
                            sh 'printenv'
                        }
                    }
                }
            }
        6.è®°å½•æµ‹è¯•å’Œæ„å»ºç»“æœ: æ”¶é›†æ—¥å¿—ä¿¡æ¯åˆ°xmlæ–‡ä»¶ä¸­
            pipeline {
                agent any
                stages {
                    stage('Test') {
                        steps {
                            sh './gradlew check'
                        }
                    }
                }
                post {
                    always {
                        junit 'build/reports/**/*.xml'
                    }
                }
            }

            æˆ–è€…å¦‚ä¸‹ï¼š
                post {
                        always {
                            archiveArtifacts artifacts: 'build/libs/**/*.jar', fingerprint: true
                            junit 'build/reports/**/*.xml'
                        }
                    }
        7.æ¸…ç†å’Œé€šçŸ¥ï¼špostéƒ¨åˆ†åœ¨Pipelineç»“æŸåè¿è¡Œ
            pipeline {
                agent any
                stages {
                    stage('No-op') {
                        steps {
                            sh 'ls'
                        }
                    }
                }
                post {
                    always {
                        echo 'One way or another, I have finished'
                        deleteDir() /* æ¸…ç†æ“ä½œ */
                    }
                    success {
                        echo 'I succeeeded!'
                    }
                    unstable {
                        echo 'I am unstable :/'
                    }
                    failure {
                         mail to: 'team@example.com',
                                     subject: "Failed Pipeline: ${currentBuild.fullDisplayName}",
                                     body: "Something is wrong with ${env.BUILD_URL}"
                            }    /* å‘é€é€šçŸ¥é‚®ä»¶ */

                         //æˆ–è€…å¦‚ä¸‹
                         hipchatSend message: "Attention @here ${env.JOB_NAME} #${env.BUILD_NUMBER} has failed.",
                                             color: 'RED'
                         //æˆ–è€…å¦‚ä¸‹
                         slackSend channel: '#ops-room',
                                           color: 'good',
                                           message: "The pipeline ${currentBuild.fullDisplayName} completed successfully."
                    }
                    changed {
                        echo 'Things were different before...'
                    }
                }
            }
        8.éƒ¨ç½²æ“ä½œï¼š
            Pipelineè‡³å°‘3ä¸ªé˜¶æ®µï¼šæ„å»ºï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²
            pipeline {
                agent any
                stages {
                    stage('Build') {
                        steps {
                            echo 'Building'
                        }
                    }
                    stage('Test') {
                        steps {
                            echo 'Testing'
                        }
                    }
                    stage('Deploy') {
                        steps {
                            echo 'Deploying'
                        }
                    }
                }
            }
            æ‰©å±•çš„é˜¶æ®µï¼š
                stage('Deploy - Staging') {
                    steps {
                        sh './deploy staging'
                        sh './run-smoke-tests'
                    }
                }
                stage('Deploy - Production') {
                    steps {
                        sh './deploy production'
                    }
                }
            äººå·¥ç¡®è®¤ï¼šæ‰§è¡Œåˆ°ä¸€å®šé˜¶æ®µåï¼Œç­‰å¾…äººå·¥ç¡®è®¤ã€‚ç±»ä¼¼ä¸äººå·¥ä»»åŠ¡æµç¨‹
                pipeline {
                    agent any
                    stages {
                        stage('Deploy - Staging') {
                            steps {
                                sh './deploy staging'
                                sh './run-smoke-tests'
                            }
                        }
                        stage('Sanity check') {
                            steps {
                                input "Does the staging environment look ok?"
                            }
                        }
                        stage('Deploy - Production') {
                            steps {
                                sh './deploy production'
                            }
                        }
                    }
                }
    5.ä½¿ç”¨Mavenæ„å»ºjavaåº”ç”¨ï¼š
        1.åœ¨dockerä¸Šè¿è¡Œjenkinsï¼š
            docker run jenkinsci/blueocean
        2.è¿›å…¥è¿è¡Œçš„jenkinså®¹å™¨ï¼š
            docker exec -it jenkins-tutorials bash
        3.è§£é”å¯†ç ï¼šä»å‘½ä»¤è¡Œä¸­å¤åˆ¶è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç ï¼Œåœ¨æµè§ˆå™¨ä¸Šè§£é”
        4.åœ¨githubä¸­å‡†å¤‡ä¸€ä¸ªé¡¹ç›®ï¼Œæœ‰æ–‡ä»¶jenkinsfile
        5.å°†é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶ååˆ›å»ºæµæ°´çº¿é¡¹ç›®ï¼Œé€‰æ‹©è¯¥æœ¬åœ°é¡¹ç›®
        6.ä¸ºæµæ°´çº¿æ·»åŠ å¤šä¸ªé˜¶æ®µï¼štest,deliver
            pipeline {
                agent {
                    docker {
                        image 'maven:3-alpine'
                        args '-v /root/.m2:/root/.m2'
                    }
                }
                stages {
                    stage('Build') {
                        steps {
                            sh 'mvn -B -DskipTests clean package'
                        }
                    }
                    stage('Test') {
                        steps {
                            sh 'mvn test'
                        }
                        post {
                            always {
                                junit 'target/surefire-reports/*.xml'
                            }
                        }
                    }
                    stage('Deliver') {
                        steps {
                            sh './jenkins/scripts/deliver.sh'
                        }
                    }
                }
            }
        7.githubä¸­çš„é¡¹ç›®ä¸­æœ‰å‡ ä¸ªåˆ†æ”¯ï¼Œåœ¨jenkinsä¸Šå°±æœ‰å‡ ä¸ªæµæ°´çº¿ã€‚è‡ªåŠ¨æ£€æµ‹é¡¹ç›®çš„åˆ†æ”¯ï¼Œä¸ç”¨å†™å…¥æ–‡ä»¶jenkinsfileã€‚
    6.æµæ°´çº¿çš„æ¦‚å¿µå’Œè¯­æ³•ï¼š
        æ¦‚å¿µï¼š
            èŠ‚ç‚¹ï¼šæ˜¯ä¸€ä¸ªæœºå™¨
            é˜¶æ®µï¼šæ˜¯æµç¨‹çš„ä¸€ä¸ªå—
            æ­¥éª¤ï¼šæ˜¯ä¸€ä¸ªä»»åŠ¡
        å£°æ˜å¼æµæ°´çº¿ï¼š
            pipeline {
                agent any
                stages {
                    stage('Build') {
                        steps { ... }
                    }
                    stage('Test') {
                        steps { ... }
                    }
                    stage('Deploy') {
                        steps { ... }
                    }
                }
            }
        è„šæœ¬å¼æµæ°´çº¿ï¼š
            node {
                stage('Build') { ... }
                stage('Test') { ... }
                stage('Deploy') { ... }
            }
        å®šä¹‰æµæ°´çº¿çš„3ä¸­æ–¹å¼ï¼š
            é€šè¿‡Blue Oceanç•Œé¢ï¼š
            é€šè¿‡ç»å…¸UI
            æºä»£ç ä¸­ç¼–å†™Jenkinsfileæ–‡ä»¶
æœªå®Œå¾…ç»­......























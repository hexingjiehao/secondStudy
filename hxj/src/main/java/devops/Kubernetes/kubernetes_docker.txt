1.å¼€å§‹å°è¯•å¯¹dockerå’Œkuberneteè¿›è¡Œå®é™…æ“ä½œï¼š

æ­£å¸¸å®‰è£…kuberneteçš„æ–¹æ³•ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
    åœ¨å®‰è£…çš„ubuntuè™šæ‹Ÿæœºä¸­å®‰è£…minikube--minikubeéœ€è¦è™šæ‹Ÿæœºæ‰èƒ½å¯åŠ¨ã€è™šæ‹Ÿæœºä¸­å®‰è£…è™šæ‹Ÿæœºã€‘ã€å°±å·®ä¸€æ­¥æˆåŠŸğŸ˜¢ğŸ˜¢ğŸ˜¢ã€‘
        //å®‰è£…virtualbox
        sudo apt-get install virtualbox
        //ä¸‹è½½kubectlæ–‡ä»¶
        curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.13.1/bin/linux/amd64/kubectl && chmod +x kubectl  && sudo mv kubectl /usr/local/bin/
        //ä¸‹è½½minikubeæ–‡ä»¶
        curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.1.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/
            å¯åŠ¨æŠ¥é”™ï¼ˆminikube startï¼‰ï¼šThis computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory
            å°è¯•è§£å†³ï¼šminikube start --no-vtx-check
                ç»§ç»­æŠ¥é”™ï¼šæ— æ³•å¯åŠ¨è™šæ‹Ÿæœºã€‚
                    Unable to start the VM: /usr/bin/VBoxManage startvm minikube --type headless failed:
                     VBoxManage: error: VT-x is not available (VERR_VMX_NO_VMX)
                     VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component ConsoleWrap, interface IConsole
                å¯èƒ½åŸå› ï¼šå®‰è£…çš„æœ€å¤–å±‚è™šæ‹Ÿæœºæ²¡æœ‰å¯åŠ¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚
        ç›®å‰ä¸»è¦çš„è™šæ‹Ÿæœºæœ‰virtualBox,VMware,Hyper-vè™šæ‹Ÿæœºã€‚å…¶ä¸­VMwareæ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–ã€‚ç›®å‰å…¬å¸ä½¿ç”¨Hyper-våˆ›å»ºçš„192.168.1.14çš„è™šæ‹Ÿæœº
        æŸ¥çœ‹macç”µè„‘æ˜¯å¦æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–ï¼šsysctl -a | grep machdep.cpu.features
            å¦‚æœç»“æœä¸­åŒ…å«VMXï¼Œåˆ™è¡¨ç¤ºæ”¯æŒVT/NXç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½


    å‚è€ƒæ–‡ä»¶ï¼šhttps://shimo.im/docs/P9PZKhRMLwkBBaWl/read
    1.ä¸‹è½½è™šæ‹Ÿæœº
    2.å®‰è£…kubectlçš„ä¸¤ç§æ–¹æ³•ï¼š
        curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.15.0/bin/darwin/amd64/kubectl  &&  chmod +x ./kubectl  && sudo mv ./kubectl /usr/local/bin/kubectl
        brew install kubernetes-cli
    3.å®‰è£…minikube
        curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.2.0/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/
    4.å°†minikubeçš„é•œåƒè®¾ç½®ä¸ºé˜¿é‡Œäº‘
        minikube start --registry-mirror=https://registry.docker-cn.com

Dockeræ–¹é¢çš„æ“ä½œï¼š
    1.æ„å»ºä¸€ä¸ªnode.jsçš„åº”ç”¨ï¼šapp.js
        const http = require('http');
        const os = require('os');
        console.log("Kubia server starting...");
        var handler = function(request, response) {
          console.log("Received request from " + request.connection.remoteAddress);
          response.writeHead(200);
          response.end("You've hit " + os.hostname() + "\n");
        };
        var www = http.createServer(handler);
        www.listen(8080);
    2.ç¼–å†™Dockerfileæ–‡ä»¶
        FROM node:7
        ADD app.js /app.js
        ENTRYPOINT ["node", "app.js"]
    3.å°†jsåº”ç”¨æ„å»ºæˆå®¹å™¨é•œåƒ
        docker build -t kubia .
    4.æ˜¾ç¤ºé•œåƒä¿¡æ¯å¹¶è¿è¡Œå®¹å™¨
        docker images
        docker run --name kubia-container -p 8080:8080 -d kubia
    5.æŸ¥çœ‹å®¹å™¨ä¸­çš„jsç¨‹åºå…·ä½“çš„è¿è¡Œæƒ…å†µ
        curl localhost:8080
        docker ps
        docker inspect kubia-container
    6.è¿›å…¥å…·ä½“å®¹å™¨çš„è™šæ‹Ÿæœºç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œshellå‘½ä»¤ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        docker exec -it kubia-container bash

        6.1 æŸ¥çœ‹å®¹å™¨ä¸­ç¨‹åºçš„è¿è¡Œæƒ…å†µ
            ps aux
            ps aux | grep app.js

        6.2 é€€å‡ºå®¹å™¨
            exit;
    7.åœæ­¢å’Œç§»é™¤å®¹å™¨
        docker stop kubia-container
        docker rm kubia-container

        docker ps -a //åˆ—å‡ºæ‰€æœ‰å®¹å™¨
    8.å°†å®¹å™¨é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆhttp://hub.docker.comï¼‰
        8.1 é‡æ–°æ ‡è®°é•œåƒï¼ˆä»¥ç”¨æˆ·åå¼€å¤´ï¼‰
            docker tag kubia hexingjiehao/kubia
        8.2 ç™»å½•åˆ°docker hubä»“åº“
            docker login   //éœ€è¦è¾“å…¥ç”¨æˆ·åå¯†ç 
        8.3 æ¨é€é•œåƒåˆ°docker hub
            docker push hexingjiehao/kubia
        8.4 åœ¨å…¶ä»–ä»»ä½•æœºå™¨ä¸Šè¿è¡Œé•œåƒï¼ˆdockerç™»å½•çŠ¶æ€ä¸‹ï¼‰
            docker run -p 8080:8080 -d hexingjiehao/kubia


Kubernetesæ–¹é¢çš„æ“ä½œï¼š
    1.ä½¿ç”¨minikubeè¿è¡Œæœ¬åœ°å•èŠ‚ç‚¹Kubernetesé›†ç¾¤
        1.1 æ’å…¥minikube
            OSXç³»ç»Ÿï¼š
                curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.23.0/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube  /usr/local/bin/
            Linuxç³»ç»Ÿï¼š
                curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.23.0/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube  /usr/local/bin/
            æ³¨æ„âš ï¸âš ï¸âš ï¸ï¼šå¯åŠ¨é›†ç¾¤éœ€è¦è™šæ‹Ÿæœºï¼Œå› æ­¤é¦–å…ˆå®‰è£…virtualBoxã€‚
            å¦‚æœæ˜¾ç¤ºç¼ºå°‘ä¾èµ–ï¼šå¯ä»¥å»è¿™ä¸ªæ‰¾å¯¹åº”çš„åŒ…http://mirrors.edge.kernel.org/ubuntu/pool/universe/q/qtx11extras-opensource-src/
        1.2 å¯åŠ¨kubernetesé›†ç¾¤å¹¶æŸ¥çœ‹çŠ¶æ€
                minikube start
                minikube status
                minikube stop: åªæ˜¯åœæ­¢ï¼Œé‡Œé¢çš„å„ç§podèµ„æºæ²¡æœ‰åˆ é™¤
                minikube deleteï¼š å…¨éƒ¨èµ„æºåˆ é™¤
        1.3 æ’å…¥kubernetesçš„å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·ï¼ˆkubectlï¼‰
                OSXç³»ç»Ÿï¼š
                    curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
                    curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.1.1/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/
                Linuxç³»ç»Ÿï¼š
                    curl -LO https://storage.googleapis.com/kubernetes-release/release
                     /$(curl -s https://storage.googleapis.com/kubernetes-release/release
                     /stable.txt)/bin/linux/amd64/kubectl
                     && chmod +x kubectl
                     && sudo mv kubectl /usr/local/bin/
            13.1 æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯
                kubectl cluster-info
    2.ä½¿ç”¨goole kubernetes å¼•æ“å¯åŠ¨é›†ç¾¤ã€âš ï¸âš ï¸âš ï¸æš‚ä¸æ¨èï¼Œå› ä¸ºè¦ç¿»å¢™ã€‘
        2.1 æ³¨å†Œç™»å½•è°·æ­Œè´¦æˆ·
        2.2 åœ¨è°·æ­Œäº‘å¹³å°æ§åˆ¶å°åˆ›å»ºä¸€ä¸ªé¡¹ç›®
        2.3 å¯åŠ¨è´¦å•æˆ–è€…ä½¿ç”¨å…è´¹ç‰ˆæœ¬
        2.4 å¯åŠ¨Kubernetes Engine API
        2.5 ä¸‹è½½å¹¶ä¸”æ’å…¥è°·æ­Œäº‘SDKï¼ŒåŒ…æ‹¬gcloudå‘½ä»¤è¡Œå·¥å…·
        2.6 æ’å…¥kubectlå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šgcloud components install kubectl

        2.7 åˆ›å»ºä¸€ä¸ªæœ‰3ä¸ªèŠ‚ç‚¹çš„kubernetesé›†ç¾¤
            gcloud container clusters create kubia --num-nodes 3 --machine-type f1-micro
            kubectl get nodes  //æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€
            kubectl describe node minikube  //æŸ¥çœ‹æŸä¸ªå…·ä½“çš„èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯

    3.åœ¨kubernetesé›†ç¾¤ä¸Šè¿è¡Œç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åº
        3.1 åœ¨kubernetesé›†ç¾¤ä¸Šåˆ›å»ºä¸€ä¸ªå®¹å™¨çš„å‰¯æœ¬æ§åˆ¶å™¨(åå­—å¿…é¡»æ˜¯å°å†™çš„)ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            kubectl run kubia --image=hexingjiehao/kubia --port=8080 --generator=run/v1
        3.2 æŸ¥çœ‹åˆ›å»ºçš„podä¸­çš„å®¹å™¨
            kubectl get pods
            kubectl describe pod åå­—
            æœŸæœ›çš„ç»“æœï¼šè¯¥å®¹å™¨çš„å‰¯æœ¬æ§åˆ¶å™¨çŠ¶æ€ä¸ºrunningã€‚
            é—®é¢˜1ï¼šèŠ‚ç‚¹çŠ¶æ€é•¿æœŸå¤„äºå®¹å™¨åˆ›å»ºä¸­?
                æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯kubectl describe pod kubia
                è¿›å…¥minikubeæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼šminikube ssh  --> journalctl -xe
                åŸå› æ˜¯minikubeä½¿ç”¨åœ°å€ gcr.io/google_containers/pause-amd64:3.0ã€‚åœ°å€è¢«å¢™äº†
                è§£å†³åŠæ³•ï¼šåœ¨minikubeçš„è™šæ‹Ÿæœºä¸­æ‰§è¡Œå‘½ä»¤
                    docker pull googlecontainer/pause-amd64:3.0
                    docker tag googlecontainer/pause-amd64:3.0 gcr.io/google_containers/pause-amd64:3.0
                        ç„¶ååœ¨å¤–éƒ¨æœºå™¨ä¸Šï¼šå°†åŸæ¥çš„podåˆ é™¤ï¼škubectl delete pod kubia-xxx

        3.3 å°†é›†ç¾¤å†…éƒ¨çš„podsä¸­ç¨‹åºè¿è¡Œçš„æœåŠ¡æš´éœ²åˆ°å¤–éƒ¨ï¼Œæ–¹ä¾¿å¤–éƒ¨è®¿é—®
            3.3.1 åˆ›å»ºä¸€ä¸ªServiceå¯¹è±¡ï¼Œå°†å‰¯æœ¬æ§åˆ¶å™¨è¿›è¡Œæš´éœ²ï¼Œä¹Ÿå°±æ˜¯pod
                kubectl expose rc kubia --type=LoadBalancer --name kubia-http
            3.3.2 åˆ—å‡ºæš´éœ²çš„æœåŠ¡å¯¹è±¡ã€‚é»˜è®¤æœ‰ä¸€ä¸ªkubernetesæœåŠ¡ï¼Œä¸ç”¨ç®¡å®ƒ
                kubectl get services
                æ–°åˆ›å»ºçš„æœåŠ¡æš‚æ—¶æ²¡æœ‰å¤–éƒ¨IPï¼Œéœ€è¦ç­‰å¾…é›†ç¾¤è¿›è¡Œè´Ÿè½½å‡è¡¡æ“ä½œï¼Œè¿‡æ®µæ—¶é—´å°±ä¼šåˆ†é…å¥½åœ°å€
                âš ï¸âš ï¸âš ï¸å¦‚æœæ˜¯minikubeå¯åŠ¨çš„kubernetesé›†ç¾¤æœåŠ¡ï¼Œåˆ™ä¸ä¼šåˆ†é…å¤–éƒ¨åœ°å€ã€‚å› ä¸ºå®ƒæ²¡æœ‰è¯¥åŠŸèƒ½
                       ä¸è¿‡æœ‰ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ³•ï¼šä½¿ç”¨minikube service kubia-httpå‘½ä»¤ï¼Œåœ¨æµè§ˆå™¨è·å–è¯¥IPåœ°å€å’Œç«¯å£

            3.3.3 ä½¿ç”¨macç³»ç»Ÿçš„Docker desktopå¯åŠ¨kubernetsé›†ç¾¤ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                    å…¶ä¸­çš„æ­¥éª¤å’Œè§£å†³åŠæ³•åœ¨ï¼šhttps://www.cnblogs.com/lakeslove/p/10881405.html
                    åˆ é™¤æ‰€æœ‰é•œåƒçš„æ“ä½œï¼šdocker rmi `docker images -q`
                    åˆ é™¤æ‰€æœ‰å®¹å™¨çš„æ“çºµï¼šdocker rm $(docker ps -aq)
                    å…¶ä¸­ç”Ÿæˆçš„å¤–éƒ¨æœåŠ¡åœ°å€æ˜¯localhost

        3.4 é€šè¿‡æš´éœ²çš„å¤–éƒ¨IPè®¿é—®é›†ç¾¤å†…çš„service
            curl localhost:8080

        3.5 æ°´å¹³ä¼¸ç¼©åº”ç”¨ç¨‹åº
            3.5.1 æŸ¥çœ‹å‰¯æœ¬æ§åˆ¶å™¨çš„æ•°é‡
                kubectl get replicationcontrollers
            3.5.2 å¢åŠ podå‰¯æœ¬çš„æ•°é‡
                kubectl scale rc kubia --replicas=3
            3.5.3 æŸ¥çœ‹ä¼¸ç¼©åçš„å‰¯æœ¬æ§åˆ¶å™¨æ•°é‡å’Œpodçš„æ•°é‡
                kubectl get rc
                kubectl get podskubectl
            3.5.4 è‡ªåŠ¨è´Ÿè½½å‡è¡¡å¤šä¸ªpodå¯¹åº”çš„1ä¸ªæœåŠ¡
                minikube service kubia-http  //è·å–åˆ°å¤–éƒ¨IPå’Œport
                curl curl http://192.168.99.103:31355  //å¤šæ¬¡æ‰§è¡Œï¼Œèƒ½å¤Ÿçœ‹åˆ°è´Ÿè½½å‡è¡¡æ•ˆæœ

        3.6 å±•ç¤ºåº”ç”¨ç¨‹åºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ
                kubectl get pods -o wide
                kubectl describe pod kubia-hfl8c  //3.6.1 æŸ¥çœ‹podçš„å…·ä½“ä¿¡æ¯

        3.7 ä½¿ç”¨kubernetes dashboardä½œä¸ºwebå›¾å½¢åŒ–ç•Œé¢ã€å‰ææ˜¯ä½¿ç”¨GKEå¯åŠ¨çš„kuberenetesæœåŠ¡å™¨ã€‘
            3.7.1 è·å–ä»ªè¡¨ç›˜çš„IPå’Œport
                kubectl cluster-info | grep dashboard
            3.7.2 è·å–ä½¿ç”¨ä»ªè¡¨ç›˜çš„ç”¨æˆ·åå¯†ç 
                gcloud container clusters describe kubia | grep -E "(username|password):"
            3.7.3 ä½¿ç”¨minikubeè®¿é—®ä»ªè¡¨ç›˜ï¼ˆå‰ææ˜¯æœ‰è¿™ä¸ªæ’ä»¶ï¼‰
                minikube dashboard
                âš ï¸âš ï¸ï¸âš ï¸è¿™é‡Œæœ‰ä¸€ä¸ªå¢™çš„åŸå› ï¼Œå¯èƒ½æ— æ³•æ‰“å¼€ä»ªè¡¨ç›˜ï¼Œéœ€è¦æ›¿æ¢dashboardçš„imagesæ¥è§£å†³


ä½¿ç”¨jsonæŒ¥ç€yamlæ–‡ä»¶è¿›è¡Œkubernetesé›†ç¾¤çš„å„ç§é…ç½®ï¼š
    1.æŸ¥çœ‹podçš„yamlæ ¼å¼ä¿¡æ¯
        kubectl get pod kubia-4lp47 -o yaml

    2.ä½¿ç”¨kubectl explianå‘½ä»¤å‘ç°æ¯ä¸ªç»„ä»¶çš„æ¦‚å¿µ
        kubectl explain pod
        kubectl explain pod.spec
        kubectl explain node
        kubectl explain service
        ......
    3.ä½¿ç”¨yamlæ–‡ä»¶åˆ›å»ºpod
        å…ƒç´ ä¸»è¦åŒ…æ‹¬metadata,Spec,Status,
        æ–‡ä»¶å†…å®¹ï¼š
            apiVersion: v1
            kind: Pod
            metadata:
              name: kubia-manual
            spec:
              containers:
              - image: hexingjiehao/kubia
                name: kubia
                ports:
                - containerPort: 8080
                  protocol: TCP
        æ‰§è¡Œå‘½ä»¤ï¼š
            kubectl create -f kubia-manual.yaml
        æŸ¥çœ‹podå®šä¹‰ï¼š
            kubectl get pod kubia-manual -o yaml
            kubectl get pod kubia-manual -o json

    4.æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—
        4.1 è¿›å…¥åˆ°podèŠ‚ç‚¹æŸ¥çœ‹
            minikube ssh
            docker logs å®¹å™¨ID
        4.2 ç›´æ¥åœ¨å¤–éƒ¨æ§åˆ¶å°æŸ¥çœ‹
            docker logs å®¹å™¨ID
            kubectl logs kubia-manual
        4.3 æŒ‡å®šå¤šå®¹å™¨çš„podä¸­å…·ä½“çš„å®¹å™¨åå­—çš„æ—¥å¿—
            kubectl logs kubia-manual -c å®¹å™¨åå­—
        4.4 å‘é€è¯·æ±‚åˆ°pod(ä¸é€šè¿‡æš´éœ²æœåŠ¡)
            kubectl port-forward kubia-manual 8888:8080

            4.4.1 æ£€æŸ¥è¯·æ±‚çš„æ•ˆæœã€‚ä¸»è¦æ˜¯æ—¥å¿—
                curl localhostï¼š8888

    5.ä½¿ç”¨æ ‡ç­¾æ¥ç®¡ç†pod(æ³¨æ„yamlçš„å†…å®¹æ ¼å¼)
        5.1 ä¹¦å†™yamlæ–‡ä»¶ï¼škubia-manual-with-labels.yaml
            apiVersion: v1
            kind: Pod
            metadata:
                name: kubia-manual-v2
                labels:
                    creation_method: manual
                    env: prod
            spec:
              containers:
              - image: hexingjiehao/kubia
                name: kubia
                ports:
                - containerPort: 8080
                  protocol: TCP
        5.2 æ‰§è¡Œyamlæ–‡ä»¶åˆ›å»ºpod
            kubectl create -f kubia-manual-with-labels.yaml

            5.2.1 æŸ¥çœ‹æ‰€æœ‰podçš„æ ‡ç­¾
                kubectl get pod --show-labels
            5.2.2 æŸ¥çœ‹podçš„å…·ä½“çš„æ ‡ç­¾çš„å€¼
                kubectl get pod -L creation_method,env
            5.2.3 æ·»åŠ æŒ‡å®špodçš„æ ‡ç­¾
                kubectl label pod kubia-manual creation_method=manual
            5.2.4 ä¿®æ”¹å­˜åœ¨çš„podçš„æ ‡ç­¾
                kubectl label pod kubia-manual-v2 env=debug --overwrite
            5.2.5 é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨åˆ—å‡ºpod
                kubectl get pods -l creation_method=manual
                kubectl get pods -l creation_method
                kubectl get pods -l '!env'   //åˆ—å‡ºæ²¡æœ‰envæ ‡ç­¾çš„pod
                kubectl get pods -l creation_method,env   //åˆ—å‡ºæœ‰å¤šä¸ªæ ‡ç­¾çš„pod

        5.3 ç»™èŠ‚ç‚¹è®¾ç½®æ ‡ç­¾
            kubectl label node minikube gpu=true

            5.3.1 æŸ¥çœ‹èŠ‚ç‚¹çš„æ ‡ç­¾
                kubectl get nodes -l gpu=true
                kubectl get nodes -L gpu  //åŒºåˆ†å¤§å°å†™ï¼Œå¤§å†™è¡¨ç¤ºå¢åŠ é¢å¤–çš„åˆ—

    6. å°†podè°ƒåº¦åˆ°æŒ‡å®šnode
        6.1 åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-gpu.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: kubia-gpu
            spec:
              nodeSelector:
                gpu: "true"
              containers:
              - image: hexingjiehao/kubia
                name: kubia
        6.2 æ‰§è¡Œkubia-gpu.yamlæ–‡ä»¶åˆ›å»ºpod
            kubectl create -f kubia-gpu.yaml

    7. ç»™podæ·»åŠ æ³¨è§£
        kubectl annotate pod kubia-manual mycompany.com/someannotation="foo bar"

        7.1 æŸ¥çœ‹æŸä¸ªpodçš„æ³¨è§£ä¿¡æ¯
            kubectl describe pod kubia-manual

    8. å¯¹èµ„æºä½¿ç”¨å‘½åç©ºé—´
        8.1 æŸ¥çœ‹æ‰€æœ‰çš„å‘½åç©ºé—´
            kubectl get ns
        8.2 æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´ä¸‹çš„pod
            kubectl get pod --namespace kube-system
        8.3 åˆ›å»ºå‘½åç©ºé—´
            8.3.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šcustom-namespace.yaml
                apiVersion: v1
                kind: Namespace
                metadata:
                  name: custom-namespace
            8.3.2 æ‰§è¡Œæ–‡ä»¶custom-namespace.yaml
                kubectl create -f custom-namespace.yaml
            8.3.3 ç›´æ¥ä½¿ç”¨å‘½ä»¤åˆ›å»ºå‘½åç©ºé—´
                kubectl create namespace custome-namespace-v2
            8.3.4 åœ¨èµ„æºåˆ›å»ºæ—¶æŒ‡å®šå‘½åç©ºé—´
                kubectl create -f kubia-manual.yaml -n custom-namespace   //é»˜è®¤æ—¶defaultå‘½åç©ºé—´

    9.åœæ­¢å’Œåˆ é™¤pods ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        å¦‚æœåˆ é™¤çš„æ˜¯å‰¯æœ¬é›†ä¸­çš„podï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„pod
        9.1 åˆ é™¤å•ä¸ªpod (æ³¨æ„ä¸æ˜¯ç«‹å³åˆ é™¤ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œé»˜è®¤30ç§’)
            kubectl delete pod kubia-gpu
        9.2 åˆ é™¤å¤šä¸ªpod
            kubectl delete pod pod1 pod2
        9.3 ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨åˆ é™¤pod
            kubectl delete pod -l creation_method=manual
        9.4 é€šè¿‡åˆ é™¤æ•´ä¸ªå‘½åç©ºé—´åˆ é™¤pods (ä¹Ÿéœ€è¦ç­‰å¾…æ—¶é—´)
            kubectl delete ns custom-namespace
        9.5 åˆ é™¤å…¨éƒ¨pod
            kubectl delete pod --all
        9.6 ä½¿ç”¨ReplicationControlleråˆ›å»ºçš„podï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨kubectl runå‘½ä»¤ï¼Œ
            ç›´æ¥åˆ é™¤podä¼šä¸åœé‡å»ºpodï¼Œè§£å†³åŠæ³•æ˜¯ï¼šåˆ é™¤ReplicationController
                kubectl delete rc kubiareplicationcontroller
        9.7 åˆ é™¤æ‰€æœ‰èµ„æºğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            kubectl delete all --all

    10.åˆ›å»ºServiceå¯¹è±¡
        10.1 åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-service.yaml
            apiVersion: v1
            kind: Service
            metadata:
                name: kubia-service
            spec:
                type: NodePort
                selector:
                    app: kubia-k8s-demo
                ports:
                - protocol: TCP
                  port: 80
                  targetPort: 8080
                  nodePort: 30008
        10.2 æ‰§è¡Œkubia-service.yamlæ–‡ä»¶
            kubectl create -f kubia-service.yaml --record

    11.åˆ›å»ºDeployment
        11.1 åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-deployment.yaml
            apiVersion: extensions/v1beta1   //å–å€¼æ˜¯å›ºå®šçš„å‡ ä¸ªå€¼
            kind: Deployment
            metadata:
                name: kubia-deployment
                labels:
                    app: kubia-k8s-demo
            spec:
                replicas: 2
                template:
                    metadata:
                        labels:
                            app:kubia-k8s-demo
                    spec:
                        containers:
                        - name: kubia-deployment
                          image: hexingjiehao/kubia
                          imagePullPolicy: Always
                          ports:
                          - containerPort: 8080
        11.2 æ‰§è¡Œkubia-deployment.yamlæ–‡ä»¶
            kubectl create -f kubia-deployment.yaml
        11.3 æŸ¥çœ‹éƒ¨ç½²çš„æƒ…å†µ
            kubectl get deployments

    12.è‡ªåŠ¨è´Ÿè½½å‡è¡¡
        12.1 é€šè¿‡æŸ¥çœ‹æ—¥å¿—çš„æ–¹å¼æ£€æŸ¥æ•ˆæœ
            kubectl logs -f kubia-deployment-7b86845f65-645vc
            kubectl logs -f kubia-deployment-7b86845f65-zd255

    13.æœåŠ¡ä¼¸ç¼©pod
        13.1 ä¿®æ”¹kubia-deployment.yamlä¸­spec.replicasçš„å€¼å³å¯
             ç„¶ååº”ç”¨è¯¥ä¿®æ”¹ï¼škubectl apply -f kubia-deployment.yaml


å‰¯æœ¬å’Œæ§åˆ¶é›†å™¨çš„ç»†èŠ‚ï¼š
    1.ä½¿ç”¨æ´»æ€§æ¢é’ˆä¿æŒpodå¥åº·
        1.1 åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-liveness-probe.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: kubia-liveness
            spec:
              containers:
              - image: hexingjiehao/kubia-unhealthy
                name: kubia-unhealthy
                ports:
                - containerPort: 8080
                  protocol: TCP
                livenessProbe:
                  httpGet:
                    path: /
                    port: 8080

            âš ï¸âš ï¸âš ï¸åœ¨kubernetesä¸­è¿è¡Œçš„é•œåƒçš„åå­—ï¼Œä¸èƒ½æœ‰ä¸‹åˆ’çº¿_
        1.2 æ‰§è¡Œkubia-liveness-probe.yaml
            kubectl create -f kubia-liveness-probe.yaml
        1.3 åœ¨yamlæ–‡ä»¶ä¸­é…ç½®é¢å¤–çš„å±æ€§initialDelaySecondsï¼Œé˜²æ­¢é™·å…¥æ­»å¾ªç¯
                initialDelaySeconds: 15
        1.4 æŸ¥çœ‹è¯¥æ¢é’ˆæ˜¯å¦èµ·ä½œç”¨ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                kubectl describe pod kubia-unhealthy
                å¦‚æœå…¶ä¸­æœ‰é”™è¯¯çŠ¶æ€ï¼Œè¯´æ˜ç¨‹åºæœ‰é—®é¢˜ï¼Œä¸èƒ½éƒ¨ç½²ï¼Œè¿˜éœ€è¦ä¿®æ”¹ç¨‹åº

    2.ä½¿ç”¨å‰¯æœ¬æ§åˆ¶å™¨ï¼ˆæœ€ç»ˆä¼šåºŸå¼ƒï¼‰
        2.1 åˆ›å»ºå‰¯æœ¬æ§åˆ¶å™¨çš„yamlæ–‡ä»¶ï¼škubia-rc.yaml
            apiVersion: v1
            kind: ReplicationController
            metadata:
              name: kubia
            spec:
              replicas: 3
              selector:
                app: kubia
              template:
                metadata:
                  labels:
                    app: kubia
                spec:
                  containers:
                  - name: kubia
                    image: hexingjiehao/kubia
                    ports:
                    - containerPort: 8080
        2.2 æ‰§è¡Œkubia-rc.yamlæ–‡ä»¶
            kubectl create -f kubia-rc.yaml
        2.3 é€šè¿‡æ›´æ”¹podçš„æ ‡ç­¾ï¼Œè®©podè„±ç¦»replicationControllerçš„ç»‘å®šï¼Œæˆ–è€…ä¿®æ”¹æ§åˆ¶å™¨çš„æ ‡ç­¾é€‰æ‹©å™¨è¿›è¡Œè§£ç»‘
        2.4 æ°´å¹³æ‰©å®¹pod--é€šè¿‡ä¿®æ”¹å‰¯æœ¬æ§åˆ¶å™¨
            kubectl scale rc kubia --replicas=10
        2.5 åˆ é™¤å‰¯æœ¬æ§åˆ¶å™¨
            2.5.1 åŒæ—¶åˆ é™¤æ§åˆ¶å™¨å’Œpod
                kubectl delete rc kubia
            2.5.2 åˆ é™¤å‰¯æœ¬æ§åˆ¶å™¨æ—¶ä¸çº§è”åˆ é™¤pod
                kubectl delete rc kubia --cascade=false

    3.ä½¿ç”¨å‰¯æœ¬é›†åˆReplicaSetsï¼ˆæ¨èä½¿ç”¨ï¼‰
        ReplicaSetæœ‰æ›´å¯Œè¡¨ç°åŠ›çš„podé€‰æ‹©å™¨ã€‚
        ReplicationControllerçš„æ ‡ç­¾é€‰æ‹©å™¨åªå…è®¸åŒ¹é…åŒ…å«ç‰¹å®šæ ‡ç­¾çš„pod: åªæœ‰inæ“ä½œ
        ReplicaSetçš„é€‰æ‹©å™¨ä¹Ÿå…è®¸åŒ¹é…ç¼ºå°‘ç‰¹å®šæ ‡ç­¾çš„podsæˆ–åŒ…å«ç‰¹å®šæ ‡ç­¾é”®çš„podsï¼šæœ‰inæ“ä½œå’Œnot inæ“ä½œ
        3.1 åˆ›å»ºyamlæ–‡ä»¶ï¼š kubia-replicaset.yaml
            apiVersion: apps/v1beta2
            kind: ReplicaSet
            metadata:
              name: kubia
            spec:
              replicas: 3
              selector:
                matchLabels:
                  app: kubia
              template:
                metadata:
                  labels:
                    app: kubia
                spec:
                  containers:
                  - name: kubia
                    image: hexingjiehao/kubia
        3.2 æŸ¥çœ‹å‰¯æœ¬é›†çš„æƒ…å†µ
            kubectl get rs
        3.3 æŸ¥çœ‹å‰¯æœ¬é›†çš„è¯¦ç»†æƒ…å†µ
            kubectl describe rs (å¯é€‰)å‰¯æœ¬é›†åå­—
        3.4 è®¾ç½®å‰¯æœ¬é›†å„ç§é€‰æ‹©å™¨:
            selector:
                matchLabels:
                  app: kubia

            //è¿™ç§æ ¼å¼æœ‰3ä¸ªå±æ€§ï¼škey,operator,values
            selector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - kubia

            å…·ä½“çš„å–å€¼æœ‰ï¼š
                Inï¼šæ ‡ç­¾å€¼å¿…é¡»åŒ¹é…å…¶ä¸­ä¸€ä¸ªæŒ‡å®šå€¼
                Not Inï¼šæ ‡ç­¾å€¼ä¸èƒ½åŒ¹é…å…¶ä¸­ä»»æ„æŒ‡å®šå€¼
                Existsï¼špodå¿…é¡»åŒ…å«ä¸€ä¸ªæ‹¥æœ‰æŒ‡å®škeyçš„æ ‡ç­¾
                DoesNotExistï¼š podå¿…é¡»ä¸åŒ…å«ä¸€ä¸ªæ‹¥æœ‰æŒ‡å®škeyçš„æ ‡ç­¾ï¼Œvaluesä¸€å®šä¸èƒ½æŒ‡å®š
        3.5 åˆ é™¤å‰¯æœ¬é›†
            å•ç‹¬åˆ é™¤ä¸€ä¸ªpodï¼Œéƒ½ä¼šè‡ªåŠ¨é‡å»ºpod
            kubectl delete rs kubia

    4.ä½¿ç”¨å®ˆæŠ¤é›†åˆDaemonSet
        é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªpodï¼Œç”¨äºç›‘è§†èµ„æºä½¿ç”¨æƒ…å†µå’Œä½¿ç”¨æ—¥å¿—ï¼Œå…¶ä¸­kube-proxyå°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚
        å®ƒä¹Ÿèƒ½å‘å‰¯æœ¬é›†åˆä¸€æ ·ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨ï¼Œåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šåˆ›å»ºpod
        4.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šssd-monitor-daemonset.yaml
            apiVersion: apps/v1beta2
            kind: DaemonSet
            metadata:
              name: ssd-monitor
            spec:
              selector:
                matchLabels:
                  app: ssd-monitor
              template:
                metadata:
                  labels:
                    app: ssd-monitor
                spec:
                  nodeSelector:
                    disk: ssd
                  containers:
                  - name: main
                    image: hexingjiehao/kubia
        4.2 åˆ›å»ºDaemonSet,æŸ¥çœ‹podï¼Œå¢åŠ æ ‡ç­¾
            kubectl create -f ssd-monitor-daemonset.yaml
            kubectl get ds
            kubectl get pod
            kubectl get node
            kubectl label node monikube disk=ssd
        4.3 åˆ é™¤èŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾ï¼ŒåŒæ—¶æŒ‡å®šçš„podè‡ªåŠ¨åˆ é™¤
            kubectl label node minikube disk=hdd --overwrite

    5.ä½¿ç”¨Job resource
        ä»»åŠ¡åªè¿è¡Œä¸€éï¼Œç¨‹åºç»“æŸåï¼Œä¸å†é‡æ–°å¯åŠ¨pod.è®¾ç½®restartPolicy: OnFailure
        è¿™é‡Œéœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„mainç¨‹åºå°±è¡Œ,ä¸æ˜¯webç¨‹åº
        5.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šexporter.yaml
            apiVersion: batch/v1
            kind: Job
            metadata:
              name: batch-job
            spec:
              template:
                metadata:
                  labels:
                    app: batch-job
                spec:
                  restartPolicy: OnFailure
                  containers:
                  - name: main
                    image: hexingjiehao/batch-job
        5.2 æ‰§è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹è¯¦æƒ…
            kubectl create -f exporter.yaml
            kubectl get jobs    //jobå’Œå‰¯æœ¬æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªçº§åˆ«çš„
            kubectl get pod
        5.3 æŸ¥çœ‹jobçš„æ—¥å¿—
            kubectl logs batch-job-42th5
        5.4 åœ¨ä¸€ä¸ªjobä¸­è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œå¯ä»¥å¹¶è¡Œæˆ–è€…é¡ºåºæ‰§è¡Œ
            5.4.1 é¡ºåºæ‰§è¡Œjob podsï¼ˆé»˜è®¤æƒ…å†µï¼‰
                å¢åŠ é…ç½®completions: 5
            5.4.2 å¹¶è¡ŒæŒ‡å®šjob pods
                å¢åŠ é…ç½®completions: 5
                       parallelism: 2
        5.5 ä¼¸ç¼©Job (å‰ææ˜¯jobå½“å‰è¿˜åœ¨è¿è¡Œ,ä¼¸ç¼©çš„æ˜¯æ‰§è¡Œçš„jobçš„çº¿ç¨‹æ•°ï¼‰
            kubectl scale job batch-job --replicas 3
        5.6 é…ç½®jobçš„è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°
            activeDeadlineSecondsï¼šè¶…æ—¶æ—¶é—´
            spec.backoffLimitï¼šé‡è¯•æ¬¡æ•°

    6. å®šæ—¶å®Œæˆjob
        6.1 åˆ›å»ºCronJob: cronjob.yaml

            apiVersion: batch/v1beta1
            kind: CronJob
            metadata:
                name: batch-job-every-fifteen-minutes
            spec:
              schedule: "0/10 * * * *"
              jobTemplate:
                spec:
                  template:
                    metadata:
                      labels:
                        app: periodic-batch-job
                    spec:
                      restartPolicy: OnFailure
                      containers:
                      - name: main
                        image: hexingjiehao/batch-job
        6.2 é…ç½®å®šæ—¶å™¨
            minute-Hour-day of mouth-month-day of week
            0/1 * * * *   :ä»0åˆ†é’Ÿå¼€å§‹ï¼Œæ¯éš”1åˆ†é’Ÿæ‰§è¡Œ1æ¬¡job
            å¯ä»¥è®¾ç½®æ¯éš”jobå¿…é¡»åœ¨æŒ‡å®šæ—¶é—´å†…å¯åŠ¨ï¼š startingDeadlineSeconds: 15


å¼€å§‹ç”¨Serviceè¿›è¡Œå†…éƒ¨åº”ç”¨çš„æš´éœ²æ¥å£ï¼šä¸€å®šè¦è‘—åæœåŠ¡çš„ç±»å‹typeï¼šNodePortè¿˜æ˜¯ClusterIP,ExternalNameç­‰ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
    1. åˆ›å»ºæœåŠ¡ï¼škubia-svc.yaml
        apiVersion: v1
        kind: Service
        metadata:
          name: kubia
        spec:
          ports:
          - port: 80
            targetPort: 8080
          selector:      //æ ¸å¿ƒï¼Œè‡ªåŠ¨æŸ¥æ‰¾å¯¹åº”podå¹¶è¿›è¡Œç»‘å®š
            app: kubia
    2.æ‰§è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹æƒ…å†µ
        kubectl create -f kubia-svc.yaml
        kubectl get svc
    3. åœ¨é›†ç¾¤å†…éƒ¨æµ‹è¯•æœåŠ¡
        3.1 åˆ›å»ºä¸€ä¸ªpodå¹¶å‘é€è¯·æ±‚åˆ°é›†ç¾¤ipå¹¶ä¸”æŸ¥çœ‹å“åº”æ—¥å¿—ã€æš‚æœªæµ‹è¯•ã€‘
            sshåˆ°k8sèŠ‚ç‚¹å¹¶ä½¿ç”¨curlå‘½ä»¤ ã€æš‚æœªæµ‹è¯•ã€‘
            ä½¿ç”¨kubectl execå‘½ä»¤è¿›å…¥podå†…éƒ¨ï¼Œç„¶åä½¿ç”¨curlå‘½ä»¤ ã€æš‚æœªæµ‹è¯•ã€‘
                kubectl exec kubia-manual -- curl -s http://10.110.51.228
                kubectl exec -it kubia-manual bash
        3.2 åœ¨æœåŠ¡ä¸Šé…ç½®ä¼šè¯å…³è”ã€‚æ¯æ¬¡éƒ½èƒ½å¤Ÿè®¿é—®åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯é›†ç¾¤ä¸­çš„éšæœºèŠ‚ç‚¹
            spec:
              sessionAffinity: ClientIP
        3.3 åœ¨åŒä¸€ä¸ªæœåŠ¡ä¸­å…¬å¼€å¤šä¸ªç«¯å£:åˆ›å»ºmutil-ports.yamlæ–‡ä»¶
            å¯ä»¥åœ¨podåˆ›å»ºçš„yamlä¸­ï¼Œç»™ç«¯å£å–åå­—ï¼Œç„¶ååœ¨serviceçš„targetPortå–å€¼ä¸­ä½¿ç”¨å‘½åç«¯å£

            apiVersion: v1
            kind: Service
            metadata:
                name: kubia
            spec:
                ports:
                - name: http
                    port: 80
                    targetPort: 8080
                - name: https
                    port: 443
                    targetPort: 8443
                selector:               //æ ¸å¿ƒï¼Œç”¨äºç»‘å®šåå°åº”ç”¨ç¨‹åºçš„podï¼Œå‰¯æœ¬æ§åˆ¶å™¨ï¼Œå‰¯æœ¬é›†ç­‰
                    app: kubia
        3.4 å®¢æˆ·ç«¯podå‘ç°service ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            3.4.1 é€šè¿‡ç¯å¢ƒå˜é‡
                åˆ—å‡ºæŸä¸ªpodå®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ kubectl exec kubia-manual env
            3.4.2 é€šè¿‡DNS
                åœ¨å‘½åç©ºé—´kube-systemä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªkube-dnsçš„podï¼Œå®ƒè¿è¡ŒDNSæœåŠ¡å™¨
            3.4.3 é€šè¿‡FQDN
                è¿›å…¥podçš„å®¹å™¨ä¸­ï¼Œç„¶åæ‰§è¡Œï¼šcurl http://kubia.default.svc.cluster.local
                æœåŠ¡å.å‘½åç©ºé—´.å¯é…ç½®çš„é›†ç¾¤åŸŸåå‰ç¼€
                backend-database.default.svc.cluster.local
                è¿˜æ˜¯éœ€è¦åœ¨å®¢æˆ·ç«¯podä¸­è®¾ç½®ç«¯å£
                å¦‚æœå‰æ®µpodå’Œåç«¯podåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ï¼šå¯ä»¥ä½¿ç”¨backend-database
            3.4.4 åœ¨podå®¹å™¨ä¸­è¿è¡Œshell
                 kubectl exec -it kubia-manual bash
    4.è¿æ¥åˆ°é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡Service
        4.1 ä»‹ç»æœåŠ¡çš„ç«¯ç‚¹èµ„æº
            kubectl get endpoints kubia
        4.2 æ‰‹åŠ¨é…ç½®æœåŠ¡ç«¯ç‚¹èµ„æº
            é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå®ƒæ²¡æœ‰æŒ‡å®špodé€‰æ‹©å™¨,ç„¶ååˆ›å»ºä¸€ä¸ªç«¯ç‚¹èµ„æºã€‚ç»‘å®šæ–¹æ³•æ˜¯åŒæ ·çš„åå­—
            4.2.1 æ— é€‰æ‹©å™¨æœåŠ¡ï¼šexternal-service.yaml
                apiVersion: v1
                kind: Service
                metadata:
                  name: external-service
                spec:
                    ports:
                    - port: 80
            4.2.2 ç«¯ç‚¹èµ„æºï¼šexternal-service-endpoints.yaml
                apiVersion: v1
                kind: Endpoints
                metadata:
                  name: external-service
                subsets:
                  - addresses:
                    - ip: 11.11.11.11
                    - ip: 22.22.22.22
                    ports:
                    - port: 80
        4.3 ç»™å¤–éƒ¨æœåŠ¡ç±»å‹åˆ›å»ºä¸€ä¸ªåˆ«åï¼šexternal-service-externalname.yaml
            apiVersion: v1
            kind: Service
            metadata:
              name: external-service
            spec:
              type: ExternalName
              externalName: someapi.somecompany.com
              ports:
              - port: 80
    5.æš´éœ²æœåŠ¡åˆ°å¤–éƒ¨å®¢æˆ·ç«¯ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
        5.1 ä½¿ç”¨NodePortï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-svc-nodeport.yaml
                apiVersion: v1
                kind: Service
                metadata:
                   name: kubia-nodeport
                spec:
                  type: NodePort
                  ports:
                  - port: 80
                    targetPort: 8080
                    nodePort: 30123
                  selector:
                    app: kubia
        5.2 åˆ›å»ºä¸€ä¸ªæŒ‡å®šæ ‡ç­¾çš„podï¼Œç„¶åé€šè¿‡ä¸‹é¢æ–¹æ³•è®¿é—®
            åœ¨é›†ç¾¤å†…éƒ¨ï¼šå†…éƒ¨ip:å†…éƒ¨port
            åœ¨é›†ç¾¤å¤–éƒ¨ï¼šé›†ç¾¤node1çš„å¤–éƒ¨ip:å¤–éƒ¨port
                      é›†ç¾¤node2çš„å¤–éƒ¨ip:å¤–éƒ¨port
                      ......
            5.2.1 é€šè¿‡GKEå¯åŠ¨çš„k8sé›†ç¾¤ï¼Œéœ€è¦ä¿®æ”¹é˜²ç«å¢™è§„åˆ™ï¼Œè®©å¤–éƒ¨å®¢æˆ·ç«¯è®¿é—®nodePortæœåŠ¡
                gcloud compute firewall-rules create kubia-svc-rule --allow=tcp:30123
        5.3 é€šè¿‡å¤–éƒ¨è´Ÿè½½å¹³è¡¡å™¨å…¬å¼€æœåŠ¡
            ä¸€èˆ¬è¿è¡Œåœ¨äº‘æä¾›å•†çš„k8sè‡ªåŠ¨æä¾›è´Ÿè½½å¹³è¡¡å™¨ï¼ŒæœåŠ¡ç±»å‹è®¾ç½®ä¸ºLoadBalancerå³å¯ã€‚æœ€æ–°ç‰ˆçš„minikubeæœ‰è¯¥åŠŸèƒ½ï¼ï¼ï¼
            åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-svc-loadbalancer.yaml
                apiVersion: v1
                kind: Service
                metadata:
                  name: kubia-loadbalancer
                spec:
                  type: LoadBalancer
                  ports:
                  - port: 80
                    targetPort: 8080
                  selector:
                    app: kubia
        5.4 é€šè¿‡å…¥å£èµ„æºå¯¹å¤–å…¬å¼€æœåŠ¡
            5.4.1 æŸ¥çœ‹minikubeå¯ç”¨ç»„ä»¶
                minikube addons list
            5.4.2 å¯åŠ¨å…¥å£ç»„ä»¶
                minikube addons enable ingress   //æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯åˆ—å‡ºæ¥çš„ä»»æ„ä¸€ä¸ªç»„ä»¶
            5.4.3 åˆ›å»ºyamlæ–‡ä»¶ï¼škubia-ingress.yaml
                apiVersion: extensions/v1beta1
                kind: Ingress
                metadata:
                  name: kubia
                spec:
                  rules:
                  - host: kubia.example.com
                    http:
                      paths:
                      - path: /
                        backend:
                          serviceName: kubia-nodeport
                          servicePort: 80
            5.4.4 æŸ¥çœ‹å…¥å£ä¿¡æ¯ï¼šæ³¨æ„å°†åŸŸåå’Œipåœ¨dnsä¸­è¿›è¡Œé…ç½®æˆå¯¹cat /etc/hosts
                kubectl get ingress
                curl http://kubia.example.com
            5.4.5 é€šè¿‡ç›¸åŒçš„å…¥å£æš´éœ²å¤šä¸ªæœåŠ¡
                åœ¨pahtså­—æ®µä¸‹æœ‰å¤šä¸ª-pathå­—æ®µã€‚è¿™æ ·åšèƒ½å¤Ÿè¯·æ±‚ä¸€ä¸ªåœ°å€ï¼Œè®¿é—®åˆ°å¥¥ä¸åŒçš„åå°æœåŠ¡ï¼Œä¸€èˆ¬æ˜¯ç”¨ä½œç›¸åŒæœåŠ¡çš„è´Ÿè½½å‡è¡¡
                    - host: kubia.example.com
                    http:
                        paths:
                          - path: /kubia
                            backend:
                              serviceName: kubia
                              servicePort: 80
                          - path: /foo
                            backend:
                              serviceName: bar
                              servicePort: 80
                å°†ä¸åŒçš„æœåŠ¡æ˜ å°„åˆ°ä¸åŒä¸»æœº
                    spec: rules:
                      - host: foo.example.com
                        http:
                          paths:
                          - path: /
                            backend:
                              serviceName: foo
                              servicePort: 80
                      - host: bar.example.com
                        http:
                          paths:
                          - path: /
                            backend:
                              serviceName: bar
                              servicePort: 80
            5.4.6 é…ç½®Ingressæ¥å¤„ç†TLSæµé‡ï¼Œä¹Ÿå°±æ˜¯https
                å½“å®¢æˆ·ç«¯æ‰“å¼€åˆ°å…¥å£æ§åˆ¶å™¨çš„TLSè¿æ¥æ—¶ï¼Œæ§åˆ¶å™¨å°†ç»ˆæ­¢TLSè¿æ¥ã€‚å®¢æˆ·æœºå’Œæ§åˆ¶å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ï¼Œè€Œæ§åˆ¶å™¨å’Œåç«¯podä¹‹é—´çš„é€šä¿¡åˆ™ä¸æ˜¯åŠ å¯†çš„ã€‚
                åœ¨podä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸éœ€è¦æ”¯æŒTLS
                åˆ›å»ºå…¥å£è¯ä¹¦å’Œç§é’¥ï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                    openssl genrsa -out tls.key 2048
                    openssl req -new -x509 -key tls.key -out tls.cert -days 360 -subj /CN=kubia.example.com
                ä½¿ç”¨è¯ä¹¦å’Œç§˜é’¥åˆ›å»ºSecret:
                    kubectl create secret tls tls-secret --cert=tls.cert --key=tls.key
                ä½¿ç”¨CertificateSigningRequestèµ„æºè·å¾—ç­¾åè¯ä¹¦ï¼Œè€Œä¸æ˜¯è‡ªå·±ç­¾åè¯ä¹¦
                    kubectl certificate approve <name of the CSR>
                æ›´æ–°åçš„yamlæ–‡ä»¶ï¼škubia-ingress-tls.yaml
                    apiVersion: extensions/v1beta1
                    kind: Ingress
                    metadata:
                      name: kubia
                    spec:
                        tls:
                        - hosts:
                            - kubia.example.com
                            secretName: tls-secret
                        rules:
                        - host: kubia.example.com
                          http:
                            paths:
                            - path: /
                              backend:
                                serviceName: kubia-nodeport
                                servicePort: 80
                è®¿é—®httpsï¼šcurl -k -v https://kubia.example.com/kubia
    6.ä½¿ç”¨headlessæœåŠ¡å‘ç°å•ä¸ªpods
        6.1 åˆ›å»ºheadlessæœåŠ¡ï¼škubia-svc-headless.yaml
            apiVersion: v1
            kind: Service
            metadata:
              name: kubia-headless
            spec:
              clusterIP: None
              ports:
              - port: 80
                targetPort: 8080
              selector:
                app: kubia
        6.2 é€šè¿‡å‘½ä»¤è¡Œç›´æ¥åˆ›å»ºpodï¼Œè€Œä¸”ä¸ä¼šåˆ›å»ºå‰¯æœ¬æ§åˆ¶å™¨
                kubectl run dnsutils --image=hexingjiehao/kubia --generator=run-pod/v1 --command -- sleep infinity


ä½¿ç”¨Volumesæ¥å°†ç¡¬ç›˜å­˜å‚¨é™„åŠ åˆ°å®¹å™¨ä¸Š
   1.åˆ›å»º1ä¸ªfortuneçš„é•œåƒ
        1.1 åˆ›å»ºfortuneloop.shè„šæœ¬
             #!/bin/bash
             trap "exit" SIGINT
             mkdir /var/htdocs
             while :
             do
               echo $(date) Writing fortune to /var/htdocs/index.html
               /usr/games/fortune > /var/htdocs/index.html
               sleep 10
             done
        1.2 åˆ›å»ºDockerfile
            FROM ubuntu:latest
            RUN apt-get update ; apt-get -y install fortune
            ADD fortuneloop.sh /bin/fortuneloop.sh
            RUN chmod +x /bin/fortuneloop.sh    //ä¸€å®šè¦ç»™shellæ‰§è¡Œæˆæƒ
            ENTRYPOINT /bin/fortuneloop.sh
        1.3 æ„å»ºé•œåƒå¹¶ä¸Šä¼ åˆ°dockerhubä»“åº“
            docker build -t fortune .
            docker tag fortune hexingjiehao/fortune
            docker push hexingjiehao/fortune
   2.åˆ›å»ºpod
        2.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šfortune-pod.yamlã€ä¸€å®šè¦æ³¨æ„æ ¼å¼ã€‘
            apiVersion: v1
            kind: Pod
            metadata:
              name: fortune
            spec:
              containers:
              - image: hexingjiehao/fortune
                name: html-generator
                volumeMounts:
                - name: html
                  mountPath: /var/htdocs
              - image: nginx:alpine
                name: web-server
                volumeMounts:
                - name: html
                  mountPath: /usr/share/nginx/html
                  readOnly: true
                ports:
                - containerPort:80
                  protocol: TCP
              volumes:                  //å·æ˜¯åœ¨podä¸‹é¢
              - name: html
                emptyDir: {}
        2.2 emptyDiré»˜è®¤çš„æ–‡ä»¶æ˜¯æŒ‚è½½åœ¨podçš„ç¡¬ç›˜ä¸Šï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå†…å­˜ä¸Š
            volumes:
              - name: html
                emptyDir:
                  medium: Memory
   3.ä½¿ç”¨Gitå­˜å‚¨åº“ä½œä¸ºå·çš„ä»‹è´¨
        gitRepoå·åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªemptyDirå·ï¼Œå®ƒé€šè¿‡å…‹éš†Gitå­˜å‚¨åº“å¹¶åœ¨podå¯åŠ¨æ—¶(ä½†åœ¨åˆ›å»ºå®¹å™¨ä¹‹å‰)æ¥å¡«å……è¯¥å·
        å½“å°†æ›´æ”¹æ¨é€åˆ°gitRepoå¹¶å¸Œæœ›å¼€å§‹æä¾›ç½‘ç«™çš„æ–°ç‰ˆæœ¬æ—¶ï¼Œéƒ½éœ€è¦åˆ é™¤podã€‚
        æŒ‚è½½çš„å·çš„å†…å®¹åœ¨å±æ€§mountPathä¸‹ï¼Œå®ƒå’Œgitrepoä¸­çš„å†…å®¹ä¸€è‡´
        ä¸ºäº†ä¿è¯gitrepoä¸­çš„èµ„æºå’Œå®¹å™¨ä¸­æŒ‚è½½çš„èµ„æºä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨sidcarå®¹å™¨ï¼Œåç»­åœ¨18ç« è®²è¿°
        å¦‚æœæ‚¨æƒ³å…‹éš†ä¸€ä¸ªç§æœ‰çš„Git repoåˆ°æ‚¨çš„å®¹å™¨ä¸­ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨Git - sync sidecaræˆ–ç±»ä¼¼çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯gitRepoå·ã€‚

        3.1 åˆ›å»ºyamlæ–‡ä»¶ï¼š gitrepo-volume-pod.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: gitrepo-volume-pod
            spec:
              containers:
              - image: nginx:alpine
                name: web-server
                volumeMounts:
                - name: html
                  mountPath: /usr/share/nginx/html
                  readOnly: true
                ports:
                - containerPort: 80
                  protocol: TCP
              volumes:
              - name: html
                gitRepo:
                  repository: https://github.com/hexingjiehao/kubia-website-example.git
                  revision: master
                  directory: .
        3.2 è¿›å…¥podå®¹å™¨ä¸­çš„æ–¹æ³•
            kubectl exec -it podåå­— bash
            kubectl exec -it podåå­— sh
   4. ä½¿ç”¨hostpathå·
        å°†ä¸€ä¸ªnodeçº§åˆ«çš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚å®ƒæ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨çš„å·ç±»å‹,å’Œè¢«è°ƒåº¦çš„nodeç»‘å®šã€‚å¦‚æœè¢«ç§»åŠ¨åˆ°å¦å¤–çš„nodeï¼Œåˆ™æ•°æ®ä¸¢å¤±
        æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨kube-systemå‘½åç©ºé—´ä¸‹ï¼Œæœ‰ä½¿ç”¨hostpathå·çš„pod
        ä¸æ¨èç”¨äºæŒä¹…åŒ–ç¨‹åºæ•°æ®
        4.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šhostpath.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: hostpath-volume
            spec:
              containers:
              - image: nginx:alpine
                name: web-server
                volumeMounts:
                - name: html
                  mountPath: /usr/share/nginx/html
                  readOnly: true
                ports:
                - containerPort: 80
                  protocol: TCP
              volumes:
              - name: html
                hostPath:
                  path: /Users/admin/Downloads/images/App-volumes
   5.ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ï¼šã€æš‚æ—¶æ²¡æµ‹è¯•ã€‘
        ä½¿ç”¨GCEåŸºç¡€è®¾æ–½ï¼š
            spec:
              volumes:
              - name: mongodb-data
                gcePersistentDisk:
                  pdName: mongodb
                  fsType: ext4
        ä½¿ç”¨AWSåŸºç¡€è®¾æ–½ï¼š
            spec:
              volumes:
              - name: mongodb-data
                awsElasticBlockStore:
                    volumeId: my-volume
                    fsType: ext4
        ä½¿ç”¨NFSåŸºç¡€è®¾æ–½ï¼š
             volumes:
              - name: mongodb-data
                nfs:
                  server: 1.2.3.4
                  path: /some/path
   6.ä½¿ç”¨PersistentVolumes å’Œ PersistentVolumeClaims
        PVæ˜¯é›†ç¾¤çº§åˆ«çš„èµ„æºï¼ŒPVCå±äºå‘½åç©ºé—´çš„èŒƒå›´
        å½“pvå’Œpvcéƒ½åˆ›å»ºå®Œæ¯•æ—¶ï¼Œå¦‚æœä»–ä»¬çš„å®¹é‡å’Œè®¿é—®æ¨¡å¼åŒ¹é…ï¼Œåˆ™è‡ªåŠ¨å°†è¿™ä¸¤ä¸ªè¿›è¡Œç»‘å®š
        6.1 åˆ›å»ºpvï¼šmongodb-pv-gce.yamlã€‚å®ƒæ˜¯é›†ç¾¤çº§åˆ«çš„èµ„æº
            apiVersion: v1
            kind: PersistentVolume
            metadata:
              name: mongodb-pv
            spec:
              capacity:
                storage: 1Gi
              accessModes:
              - ReadWriteOnce
              - ReadOnlyMany
              persistentVolumeReclaimPolicy: Retain
              gcePersistentDisk:
                pdName: mongodb
                fsType: ext4

        6.2 åˆ›å»ºpvcï¼šmongodb-pvc.yaml
            apiVersion: v1
            kind: PersistentVolumeClaim
            metadata:
              name: mongodb-pvc
            spec:
              resources:
                requests:
                  storage: 1Gi
              accessModes:
              - ReadWriteOnce
              storageClassName: ""

        6.3 åœ¨podä¸­ä½¿ç”¨pvcï¼šåˆ›å»ºyamlæ–‡ä»¶mongodb-pod-pvc.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: mongodb
            spec:
              containers:
              - image: mongo
                name: mongodb
                volumeMounts:
                - name: mongodb-data
                  mountPath: /data/db
                ports:
                - containerPort: 27017
                  protocol: TCP
              volumes:
              - name: mongodb-data
                persistentVolumeClaim:
                  claimName: mongodb-pvc

        6.4 åˆ é™¤pvå’Œpvc
                åˆ é™¤pvc,ç„¶åé‡æ–°åˆ›å»ºpvcï¼Œpvcçš„çŠ¶æ€ä¸ºPendingï¼Œpvçš„çŠ¶æ€ä¸ºReleasedã€‚äºŒè€…å¹¶ä¸ä¼šåˆé‡æ–°ç»‘å®š
        6.5 æŒä¹…æ€§å·çš„åŠ¨æ€ä¾›åº”
            å®ƒèƒ½å¤ŸåŠ¨æ€çš„è®¾å®šå·çš„å¤§å°ï¼Œè€Œä¸éœ€è¦äº‹å…ˆåˆ›å»ºæŒä¹…æ€§å·ï¼Œä½¿ç”¨pvcæ—¶è‡ªåŠ¨åˆ›å»ºpv
            6.5.1 ä½¿ç”¨StorageClass: storageclass-fast-gcepd.yaml
                apiVersion: storage.k8s.io/v1
                kind: StorageClass
                metadata:
                  name: fast
                provisioner: kubernetes.io/gce-pd
                parameters:
                    type: pd-ssd
                    zone: europe-west1-b
            6.5.2 åœ¨pvcä¸­ä½¿ç”¨storageclass: åˆ›å»ºæ–‡ä»¶mongodb-pvc-dp.yaml
                apiVersion: v1
                kind: PersistentVolumeClaim
                metadata:
                  name: mongodb-pvc
                spec:
                  storageClassName: fast
                  resources:
                    requests:
                      storage: 100Mi
                  accessModes:
                    - ReadWriteOnce
            6.5.3 ä½¿ç”¨å‘½ä»¤kubectl delete all --allå¹¶ä¸èƒ½åˆ é™¤æ‰pvå’Œpvcå’Œstorageclass
                  åˆ›å»ºpvcæ—¶å¦‚æœæ²¡æœ‰æŒ‡å®šå­˜å‚¨ç±»ï¼Œåˆ™ä½¿ç”¨k8sé›†ç¾¤ä¸­çš„å·²ç»å­˜åœ¨çš„é»˜è®¤å­˜å‚¨ç±»è¿›è¡Œç»‘å®š
                  å¦‚æœæƒ³ä½¿ç”¨å®šä¹‰å¥½çš„å­˜å‚¨ç±»ï¼Œå¯ä»¥è®¾ç½®storageClassName: ""


å¼€å§‹ä½¿ç”¨ConfigMapå’ŒSecretsï¼šğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
    1. ä¼ é€’å‘½ä»¤è¡Œå‚æ•°åˆ°dockerå®¹å™¨ä¸­
       1.1 åœ¨Dockerfileä¸­è®¾ç½®å˜é‡ï¼Œè¿™ç§æ–¹å°†å€¼ç»™å†™æ­»äº†
            ENTRYPOINTï¼š å®šä¹‰äº†å®¹å™¨åœ¨å¯åŠ¨æ—¶,è°ƒç”¨çš„å¯æ‰§è¡Œå‘½ä»¤æˆ–è€…è„šæœ¬
            CMDï¼šæŒ‡å®šä¼ é€’åˆ°ENTRYPOINTçš„å‚æ•°ï¼Œ ä¸€èˆ¬ä½œä¸ºå®¹å™¨å¯åŠ¨çš„é»˜è®¤å‚æ•°
                CMD ["10"]
            1.1.1 æ‰§è¡Œé•œåƒçš„ä¸¤ç§æ–¹æ³•
                docker run <image>
                docekr run <image> <arguments>
                    docker run -it hexingjiehao/fortune:args 15
            1.1.2 ä¸¤ç§ä¸åŒçš„æ ¼å¼shell,exec
                shellï¼šENTRYPOINT node app.js
                exec:  ENTRYPOINT ["node","app.js"]
                å½“ä½¿ç”¨å‘½ä»¤è¿›å…¥podçš„å®¹å™¨æ—¶ï¼Œå¦‚æœè¯¥å®¹å™¨ä½¿ç”¨shellæ ¼å¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š kubectl exec -it podåå­— bash
                å½“ä½¿ç”¨å‘½ä»¤è¿›å…¥podçš„å®¹å™¨æ—¶ï¼Œå¦‚æœè¯¥å®¹å™¨ä½¿ç”¨execæ ¼å¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼škubectl exec -it podåå­— bash
            1.1.3 æ„å»ºé•œåƒæ—¶ï¼šé»˜è®¤tagæ—¶latest,ä¹Ÿå¯ä»¥è®¾ç½®tag
                docker build -t fortune:args .
                docker tag fortune:args hexingjiehao/fortune:args
                docker run -it hexingjiehao/fortune:args 15
    2.åœ¨kubernetesä¸­é‡å†™å‘½ä»¤å’Œå‚æ•°
        2.1 åœ¨podçš„yamlæ–‡ä»¶ä¸­é‡å†™commandå’Œargs
            kind: Pod
            spec:
              containers:
              - image: some/image
                command: ["/bin/command"]
                args: ["arg1", "arg2", "arg3"]
            æ³¨æ„âš ï¸ï¼šå½“podåˆ›å»ºå¥½åï¼Œè¿™ä¸¤ä¸ªå‚æ•°ä¸èƒ½è¢«æ›´æ–°
                command=ENTRYPOINT
                args=CMD
        2.2 åœ¨yamlæ–‡ä»¶ä¸­è®¾ç½®å‚æ•°å˜é‡: fortune-pod-args.yaml
            apiVersion: v1
            kind: Pod
            metadata:
              name: fortune2s
            spec:
              containers:
              - image: hexingjiehao/fortune:args
                args: ["2"]
                name: html-generator
                volumeMounts:
                - name: html
                  mountPath: /var/htdocs
              volumes:
              - name: html
                emptyDir: {}
            æ³¨æ„âš ï¸ï¼šä¸€èˆ¬æ˜¯Dockerfileä¸­è°ƒç”¨shell,ç„¶åshellä¸­è®¾ç½®å˜é‡
        2.3 åœ¨podçš„å¤šä¸ªå®¹å™¨ä¸­ï¼Œæ¯ä¸ªå®¹å™¨å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡
            2.3.1 åœ¨shellè„šæœ¬ä¸­ï¼Œç›´æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸è¿›è¡Œè®¾å€¼,ç„¶åä½¿ç”¨Dockerfileé‡æ–°åˆ›å»ºimages
            2.3.2 åœ¨podçš„yamlæ–‡ä»¶ä¸­è®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼šfortune-pod-env.yaml
                kind: Pod
                spec:
                 containers:
                   - image: hexingjiehao/fortune:env
                     env:
                     - name: INTERVAL
                       value: "30"
                     name: html-generator
                       volumeMounts:
                       - name: html
                         mountPath: /var/htdocs
                   volumes:
                   - name: html
                     emptyDir: {}
            2.3.3 è®¾ç½®ç¬¬äºŒä¸ªç¯å¢ƒå˜é‡å¼•ç”¨ç¬¬ä¸€ä¸ªç¯å¢ƒå˜é‡
                env:
                - name: FIRST_VAR
                  value: "foo"
                - name: SECOND_VAR
                  value: "$(FIRST_VAR)bar"
    3.ä½¿ç”¨ConfigMapé”®å€¼å¯¹
        3.1 åˆ›å»ºConfigMapå¯¹è±¡
            kubectl create configmap fortune-config --from-literal=sleep-interval=25
            kubectl create configmap myconfigmap --from-literal=foo=bar --from-literal=bar=baz --from-literal=one=two
        3.2 æŸ¥çœ‹è¯¦æƒ…
            kubectl get cm
            kubectl get cm myconfigmap -o yaml
            kubectl describe cm forune-config
        3.3 å°†æ–‡ä»¶å’Œç›®å½•ä½œä¸ºå®ä½“è¿›è¡Œå­˜å‚¨ï¼Œé»˜è®¤keyå€¼æ˜¯æ–‡ä»¶å
            kubectl create configmap my-config --from-file=config-file.conf
            kubectl create configmap my-config --from-file=customkey=config-file.conf
            kubectl create cm fileconfig --from-file=/Users/admin/Downloads/images/App-volumes
                å°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå­˜å‚¨ï¼Œè¿™é‡Œä¸èƒ½ç›´æ¥è®¾ç½®key
            kubectl create configmap my-config --from-file=foo.json --from-file=bar=foobar.conf --from-file=config-opts/ --from-literal=some=thing
        3.4 å°†ConfigMapæ¡ç›®ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨
                æœ¬è´¨æ˜¯å°†åŸæ¥çš„ç›´æ¥è®¾å€¼ä¿®æ”¹ä¸ºä»ConfigMapä¸­è·å–
            3.4.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šfortune-pod-env-configmap.yaml
                apiVersion: v1
                    kind: Pod
                metadata:
                  name: fortune-env-from-configmap
                spec:
                  containers:
                  - image: hexingjiehao/fortune:env
                    env:
                    - name: INTERVAL
                      valueFrom:        //æ ¸å¿ƒ
                        configMapKeyRef:
                          name: fortune-config
                          key: sleep-interval
                    name: html-generator
                    volumeMounts:
                    - name: html
                      mountPath: /var/htdocs
                  volumes:
                  - name: html
                    emptyDir: {}
            3.4.2 æ‰§è¡Œfortune-pod-env-configmap.yamlæ–‡ä»¶
                å¦‚æœå¯åŠ¨æŠ¥é”™ï¼Œå¯èƒ½æ²¡æœ‰è®¾ç½®configmapï¼Œé‡æ–°è®¾ç½®å¥½å³å¯ã€‚
                ä¹Ÿå¯ä»¥åœ¨yamlé—®ä»·ä¸­è®¾ç½®configMapKeyRef.optional: trueã€‚å³ä½¿æ²¡æœ‰è®¾ç½®configmapä¹Ÿèƒ½å¯åŠ¨configmap
            3.4.3 å°†ConfigMapä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’1æ¬¡
                å½“confgimapæœ‰å¤§é‡çš„é”®å€¼å¯¹æ—¶ï¼Œé€ä¸ªä¼ é€’æ¯”è¾ƒéº»çƒ¦ï¼Œç›´æ¥ä½¿ç”¨envFromè¿›è¡Œæ•´ä½“ä¼ é€’
                å¯ä»¥ç»™æ¯ä¸ªç¯å¢ƒå˜é‡åœ¨ä¸åŒçš„å®¹å™¨ä¸­è®¾ç½®ä¸åŒçš„å‰ç¼€ - prefix: CONFIG_ ,è¿™ä¸ªå‰ç¼€æ˜¯å¯é€‰çš„
                spec:
                  containers:
                  - image: some-image
                    envFrom:
                    - prefix: CONFIG_
                      configMapRef:
                        name: my-config-map
                æ³¨æ„âš ï¸ï¼šå½“ç¯å¢ƒå˜é‡çš„åå­—åŒ…å«-ç¬¦å·æ—¶ï¼Œä¸ä¼šåˆ›å»ºè¿™ä¸ªæ¡ç›®
        3.5 å°†ConfigMapæ¡ç›®ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’
            æœ¬è´¨å°†configMapè®¾ç½®ä¸ºå®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œç„¶ååœ¨yamlä¸­ä½¿ç”¨è¯¥å˜é‡ä½œä¸ºshellæ–‡ä»¶æ‰§è¡Œçš„å‚æ•°
            3.5.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šfortune-pod-args-configmap.yaml
                apiVersion: v1
                kind: Pod
                metadata:
                  name: fortune-args-from-configmap
                spec:
                  containers:
                  - image: hexingjiehao/fortune:args
                    env:
                    - name: INTERVAL
                      valueFrom:
                        configMapKeyRef:
                          name: fortune-config
                          key: sleep-interval
                    args: ["$(INTERVAL)"]
                    name: html-generator
                    volumeMounts:
                    - name: html
                      mountPath: /var/htdocs
                  volumes:
                  - name: html
                    emptyDir: {}
        3.6 ä½¿ç”¨configMap volumeå°†configMapæ¡ç›®å…¬å¼€ä¸ºæ–‡ä»¶
            ç›®çš„æ˜¯ä¸ºäº†è§£å†³é…ç½®çš„å†…å®¹ç‰¹åˆ«é•¿çš„æƒ…å†µ
            3.6.1 åˆ›å»ºnginxçš„é…ç½®æ–‡ä»¶ï¼šmy-nginx-config.conf
                server {
                  listen     80;
                  server_name  www.kubia-example.com;

                  gzip on;
                  gzip_types text/plain application/xml;

                  location / {
                    root   /usr/share/nginx/html;
                    index  index.html index.htm;
                  }
                }
            3.6.2 åˆ›å»ºconfigmap
                mkdir configmap-files   //åˆ›å»ºç›®å½•
                vim my-nginx-config.conf   //jsoné…ç½®
                vim sleep-interval   //25

                //åˆ›å»ºconfigmap
                kubectl create configmap fortune-config --from-file=configmap-files
                //æŸ¥çœ‹ä¿¡æ¯
                kubectl get configmap fortune-config -o yaml
            3.6.3 åœ¨å·ä¸­ä½¿ç”¨configmap
                æœ¬è´¨æ˜¯ä½¿ç”¨hostpathç±»å‹çš„å·ï¼Œå°†æœ¬åœ°ç›®å½•å†…å®¹æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚ä¸­é—´ä½¿ç”¨ConfigMapè¿›è¡Œä»£æ›¿
                3.6.3.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šfortune-pod-configmap-volume.yaml
                    apiVersion: v1
                    kind: Pod
                    metadata:
                      name: fortune-configmap-volume
                    spec:
                      containers:
                      - image: nginx:alpine
                        name: web-server
                        volumeMounts:
                        - name: config
                          mountPath: /etc/nginx/conf.d
                          readOnly: true
                      volumes:
                      - name: config
                        configMap:
                          name: fortune-config
                3.6.3.2 éªŒè¯ConfigMapä½œä¸ºå·æŒ‚è½½çš„å†…å®¹æœ‰æ²¡æœ‰ç”¨åˆ°é…ç½®é‡Œé¢
                    kubectl port-forward fortune-configmap-volume 8080:80 &
                    curl -H "Accept-Encoding: gzip" -I localhost:8080
                    kubectl exec fortune-configmap-volume -c web-server ls /etc/nginx/conf.d
                3.6.3.3 å°†configmapä¸­ç‰¹å®šæ¡ç›®æš´éœ²åˆ°å·ä¸­ï¼šfortune-pod-configmap-volume-with-items.yaml
                    apiVersion: v1
                    kind: Pod
                    metadata:
                      name: fortune-configmap-volume
                    spec:
                      containers:
                      - image: nginx:alpine
                        name: web-server
                        volumeMounts:
                        - name: config
                          mountPath: /etc/nginx/conf.d     //é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç›®å½•
                          readOnly: true
                      volumes:
                      - name: config
                        configMap:
                          name: fortune-config
                          items:
                          - key: my-nginx-config.conf
                            path: gzip.conf
                    æ³¨æ„âš ï¸ï¼šåœ¨configMapä¸­å­˜å‚¨çš„æ–‡ä»¶å€¼ï¼Œåœ¨å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„æ—¶å€™ï¼Œå¯ä»¥ä¿®æ”¹åå­—ï¼Œä½†æ˜¯å†…å®¹ä¸å˜
                            è€Œä¸”ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•å€¼ï¼Œä¼šéšè—åŸæœ¬å®¹å™¨ç›®å½•ä¸­çš„æ–‡ä»¶
                3.6.3.4 å°†configmapä¸­çš„æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­è€Œä¸éšè—å®¹å™¨åŸæœ¬çš„æ–‡ä»¶ï¼šfortune-cm-single-file.yaml
                    apiVersion: v1
                    kind: Pod
                    metadata:
                      name: fortune-cm
                    spec:
                      containers:
                      - image: nginx:alpine
                        name: web-server
                        volumeMounts:
                        - name: config
                          mountPath: /etc/someconfig.conf     //æŒ‚è½½æˆä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶
                          subPath: my-nginx-config.conf    //ConfigMapä¸­çš„å€¼
                      volumes:
                      - name: config
                        configMap:
                          name: fortune-config
                          defaultMode: 0660   //è®¾ç½®æ–‡ä»¶çš„æ‰§è¡Œæƒé™
        3.7 æ›´æ–°åº”ç”¨é…ç½®ï¼Œåœ¨ä¸é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹
            3.7.1 ç¼–è¾‘ConfigMap
                kubectl edit configmap fortune-config   //æ‰“å¼€å¯¹è±¡å¹¶åœ¨å…¶ä¸­è¿›è¡Œç¼–è¾‘
            3.7.2 æŸ¥çœ‹ä¿®æ”¹æƒ…å†µï¼šè¦èŠ±ä¸€æ®µæ—¶é—´è¿›è¡Œå®¹å™¨å†…çš„æ›´æ–°é…ç½®
                kubectl exec fortune-configmap-volume -c web-server cat /etc/nginx/conf.d/my-nginx-config.conf
            3.7.3 é‡æ–°åŠ è½½nginxçš„é…ç½®
                kubectl exec fortune-configmap-volume -c web-server -- nginx -s reload
                æ³¨æ„âš ï¸ï¼šå¦‚æœåœ¨å®¹å™¨ä¸­æŒ‚è½½å•ä¸ªæ–‡ä»¶ï¼Œä¸ä¼šè‡ªåŠ¨æ›´æ–°
    4.ä½¿ç”¨Secrectå¯¹è±¡ã€ä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‘
        4.1 ä½¿ç”¨é»˜è®¤çš„token Secretå¯¹è±¡
            æ¯ä¸€ä¸ªpodéƒ½æœ‰ä¸€ä¸ªsecretå·è‡ªåŠ¨é™„åŠ 
            æŸ¥çœ‹ä¿¡æ¯ï¼škubectl get secrets
                     kubectl describe secrets
        4.2 åˆ›å»ºç§é’¥å’Œæ‹¥æœ‰å…¬é’¥è¯ä¹¦
            openssl genrsa -out https.key 2048      //åˆ›å»ºç§é’¥
            openssl req -new -x509 -key https.key -out https.cert -days 3650 -subj /CN=www.kubia-example.com  //åˆ›å»ºè¯ä¹¦
        4.3 åˆ›å»ºä¸€ä¸ªå¾…åŠ å¯†æ–‡ä»¶
            echo bar > foo
        4.4 åˆ›å»º ä¸€èˆ¬çš„Secret å¯¹è±¡ï¼š
            ä¸€èˆ¬ç”±3ä¸ªæ–‡ä»¶åˆ›å»ºï¼Œä¹Ÿå¯ä»¥æ•´ä¸ªç›®å½•è¿›è¡Œå¤„ç†ï¼Œå¿…é¡»åŒ…å«è¿™3ä¸ªæ–‡ä»¶
            kubectl create secret generic fortune-https --from-file=https.key --from-file=https.cert --from-file=foo
            kubectl create secret generic fortune-https --from-file=../fortune-https
        4.5 åˆ›å»ºtls Secrets å¯¹è±¡
            åªéœ€è¦è¯ä¹¦å’Œç§é’¥ä¸¤ä¸ªæ–‡ä»¶
            kubectl create secret tls tls-secret --cert=tls.cert --key=tls.key
        4.6 æŸ¥çœ‹è¯¦ç»†æƒ…å†µ
            kubectl get secret fortune-https -o yaml
            Secretå¯¹è±¡æ˜¯Base64ç¼–ç ï¼ŒConfigMapå¯¹è±¡æ˜¯æ­£å¸¸å†…å®¹
        4.7 åœ¨Secretä¸­ä½¿ç”¨StringDataå­—æ®µ
            å®ƒæ˜¯åªå†™å±æ€§ï¼Œä½¿ç”¨getå‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œæ— æ³•çœ‹åˆ°è¯¥å­—æ®µ
        4.8 åœ¨podä¸­ä½¿ç”¨Secretå¯¹è±¡
            4.8.1 ä¿®æ”¹ConfigMapä¸­çš„https,å¢åŠ ä»¥ä¸‹å†…å®¹
                å‘½ä»¤ï¼škubectl edit configmap fortune-config
                kubectl create configmap fortune-config --from-file=configmap-files
                å†…å®¹ï¼š
                    listen                443 ssl;
                    ssl_certificate       certs/https.cert;
                    ssl_certificate_key   certs/https.key;
                    ssl_protocols         TLSv1 TLSv1.1 TLSv1.2;
                    ssl_ciphers           HIGH:!aNULL:!MD5;
            4.8.2 å°†åˆ›å»ºçš„SecretsæŒ‚è½½åˆ°podï¼šfortune-pod-https.yaml
                apiVersion: v1
                kind: Pod
                metadata:
                  name: fortune-https
                spec:
                  containers:
                  - image: hexingjiehao/fortune:env
                    name: html-generator
                    env:
                    - name: INTERVAL
                      valueFrom:
                        configMapKeyRef:
                          name: fortune-config
                          key: sleep-interval
                    volumeMounts:
                    - name: html
                      mountPath: /var/htdocs
                  - image: nginx:alpine
                    name: web-server
                    volumeMounts:
                    - name: html
                      mountPath: /usr/share/nginx/html
                      readOnly: true
                    - name: config
                      mountPath: /etc/nginx/conf.d
                      readOnly: true
                    - name: certs
                      mountPath: /etc/nginx/certs/
                      readOnly: true
                    ports:
                    - containerPort: 80
                    - containerPort: 443
                  volumes:
                  - name: html
                    emptyDir: {}
                  - name: config
                    configMap:
                      name: fortune-config
                      items:
                      - key: my-nginx-config.conf
                        path: https.conf
                  - name: certs
                    secret:
                      secretName: fortune-https
                æ³¨æ„âš ï¸ï¼šæŸ¥çœ‹podå¯åŠ¨é”™è¯¯çš„æ–¹æ³•ï¼škubectl logs podåå­—
                        åœ¨å†™é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ï¼ˆåˆ†å·ï¼›ï¼‰ã€‚
                        å½“ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œä¸€å®šè¦é‡æ–°åŠ è½½configmapå’Œpodã€‚è€Œä¸”è¯ä¹¦çš„ä½ç½®ä¸€å®šè¦åœ¨configMapä¸‹
            4.8.3 è¿›å…¥podçš„ä¸åŒå®¹å™¨
                kubectl exec -it fortune-https -c html-generator bash
                kubectl exec -it fortune-https -c web-server sh
            4.8.4 æµ‹è¯•nginxæœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨Secret
                kubectl port-forward fortune-https 8443:443 &  //å°†å®¹å™¨æœåŠ¡æš´éœ²åˆ°å¤–éƒ¨å¹¶å¯¹åº”ç«¯å£åå°è¿è¡Œ
                curl https://localhost:8443 -k  //æœ¬åœ°æµ‹è¯•
                //è¯¦ç»†çš„å“åº”ä¿¡æ¯
                curl https://localhost:8443 -k -v

                kubectl port-forward fortune-https 8080:80 &
                curl https://localhost:8080 -k
            4.8.5 Secretå·å­˜å‚¨åœ¨å†…å­˜ä¸­
                kubectl exec fortune-https -c web-server -- mount | grep certs
            4.8.6 é€šè¿‡ç¯å¢ƒå˜é‡æš´éœ²Secretå®ä½“ã€ä¸æ¨èï¼Œä½¿ç”¨Secretçš„æ–¹æ³•æœ€å¥½æ˜¯volumeã€‘
                æœ¬è´¨ï¼šå’ŒConfigMapçš„å˜é‡è®¾ç½®æ˜¯ä¸€è‡´çš„
                    env:
                    - name: FOO_SECRET
                      valueFrom:
                        secretKeyRef:
                          name: fortune-https
                          key: foo
        4.9 ä»ç§æœ‰imageä»“åº“æ‹‰å–images,é€šè¿‡Secret
            4.9.1 ä½¿ç”¨DOCKER HUBä¸Šçš„ç§æœ‰æ˜ åƒå­˜å‚¨åº“
                ä¸ºDockeræ³¨å†Œè¡¨åˆ›å»ºä¸€ä¸ªåŒ…å«å‡­æ®çš„ç§˜å¯†ã€‚
                åœ¨podçš„æè¿°æ–‡ä»¶ä¸­çš„imagePullSecretså­—æ®µä¸­å¼•ç”¨Secret
            4.9.2 åˆ›å»ºDocker registryéœ€è¦çš„Secret
                kubectl create secret docker-registry mydockerhubsecret --docker-username=hexingjiehao --docker-password=xj15928286403 --docker-email=xj2711992339@163.com
            4.9.3 åˆ›å»ºamlæ–‡ä»¶pod-with-private-image.yaml
                apiVersion: v1
                kind: Pod
                metadata:
                  name: private-pod
                spec:
                  imagePullSecrets:
                  - name: mydockerhubsecret
                  containers:
                  - image: hexingjiehao/private
                    name: main
                æ³¨æ„âš ï¸ï¼šå½“å°†Secretæ·»åŠ åˆ°ServiceAccountä¸Šæ—¶ï¼Œä¸ç”¨ä¸ºæ¯ä¸ªpodæ‹‰å–ç§æœ‰imageè€Œè®¾ç½®Secret


ä»åº”ç”¨ç¨‹åºè®¿é—®podå…ƒæ•°æ®å’Œå…¶ä»–èµ„æº---ä¹Ÿå°±æ˜¯å°†podçš„å…ƒä¿¡æ¯æš´éœ²ç»™å®¹å™¨
    1.é€šè¿‡ç¯å¢ƒå˜é‡æš´éœ²metadataï¼šdownward-api-env.yaml
        apiVersion: v1
        kind: Pod
        metadata:
          name: downward
        spec:
          containers:
          - name: main
            image: busybox
            command: ["sleep", "9999999"]
            resources:
              requests:
                cpu: 15m
                memory: 100Ki
              limits:
                cpu: 100m
                memory: 4Mi
            env:
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  fieldPath: spec.serviceAccountName
            - name: CONTAINER_CPU_REQUEST_MILLICORES
              valueFrom:
                resourceFieldRef:
                  resource: requests.cpu
                  divisor: 1m
            - name: CONTAINER_MEMORY_LIMIT_KIBIBYTES
              valueFrom:
                resourceFieldRef:
                  resource: limits.memory
                  divisor: 1Ki
    2.åœ¨podçš„å®¹å™¨ä¸­æŸ¥çœ‹metadata
        kubectl exec downward env
    3.ä½¿ç”¨downwardAPIå· ä¼ é€’ metadata æ•°æ®
        å°†podçš„æ ‡ç­¾å’Œæ³¨é‡Šæš´éœ²åˆ°å®¹å™¨ä¸­ï¼Œåœ¨å®¹å™¨ä¸­çš„ä¿å­˜å½¢å¼æ˜¯å¤šç§æ–‡ä»¶ï¼šdownward-api-volume.yaml
        apiVersion: v1
        kind: Pod
        metadata:
          name: downward
          labels:
            foo: bar
          annotations:
            key1: value1
            key2: |
              multi
              line
              value
        spec:
          containers:
          - name: main
            image: busybox
            command: ["sleep", "9999999"]
            resources:
              requests:
                cpu: 15m
                memory: 100Ki
              limits:
                cpu: 100m
                memory: 4Mi
            volumeMounts:
            - name: downward
              mountPath: /etc/downward
          volumes:
          - name: downward
            downwardAPI:
              items:
              - path: "podName"
                fieldRef:
                  fieldPath: metadata.name
              - path: "podNamespace"
                fieldRef:
                  fieldPath: metadata.namespace
              - path: "labels"
                fieldRef:
                  fieldPath: metadata.labels
              - path: "annotations"
                fieldRef:
                  fieldPath: metadata.annotations
              - path: "containerCpuRequestMilliCores"
                resourceFieldRef:
                  containerName: main
                  resource: requests.cpu
                  divisor: 1m
              - path: "containerMemoryLimitBytes"
                resourceFieldRef:
                  containerName: main
                  resource: limits.memory
                  divisor: 1
    4.æŸ¥çœ‹æš´éœ²æˆå·çš„podæ•°æ®çš„å†…å®¹
        kubectl exec downward ls /etc/downward
        kubectl exec downward cat /etc/downward/labels
        kubectl exec downward cat /etc/downward/annotations
        æ³¨æ„ï¼šå½“ä½¿ç”¨ç¯å¢ƒå˜é‡æš´éœ²æ ‡ç­¾å’Œæ³¨é‡Šæ—¶ï¼Œä¿®æ”¹å®ƒä»¬ï¼Œå®¹å™¨ä¸­çš„å€¼ä¸ä¼šæ›´æ–°
    5. ä¸Kubernetes APIæœåŠ¡å™¨å¯¹è¯
        5.1 æ¢ç´¢Kubernetes REST API
            kubectl cluster-info
        5.2 ä½¿ç”¨kubectl proxyè®¿é—®APIæœåŠ¡å™¨
            kubectl proxy
            curl http:127.0.0.1:8001  //æŸ¥çœ‹APIæœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯,é‡Œé¢æœ‰å„ç§APIåœ°å€
        5.3 åœ¨podä¸­è®¿é—®API æœåŠ¡å™¨
            æ‰¾åˆ°APIæœåŠ¡å™¨ä½ç½®ï¼›å¹¶ç¡®å®šä¸æœåŠ¡å™¨å¯¹è¯ï¼Œè€Œä¸æ˜¯æ¨¡æ‹Ÿå™¨ï¼›ä½¿ç”¨æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯;å¦åˆ™å®ƒä¸ä¼šè®©ä½ çœ‹åˆ°æˆ–åšä»»ä½•äº‹æƒ…ã€‚
            5.3.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šcurl.yaml
                apiVersion: v1
                kind: Pod
                metadata:
                  name: curl
                spec:
                  containers:
                  - name: main
                    image: tutum/curl
                    command: ["sleep", "9999999"]
            5.3.2 æŸ¥çœ‹ä¿¡æ¯å¹¶æ‰¾åˆ°APIæœåŠ¡å™¨åœ°å€
                kubectl exec -it curl bash
                kubectl get svc   //kubernetesæœåŠ¡å°±æ˜¯APIæœåŠ¡å™¨
                åœ¨å®¹å™¨ä¸­æ‰§è¡Œenvï¼šå…¶ä¸­æœåŠ¡å™¨IPå’Œç«¯å£å¦‚ä¸‹ï¼šKUBERNETES_SERVICE_PORT=443
                                                    KUBERNETES_SERVICE_HOST=10.0.0.1
                åœ¨å®¹å™¨ä¸­è®¿é—®APIæœåŠ¡å™¨ï¼šcurl https://kubernetes   //âš ï¸âš ï¸âš ï¸è¿™é‡ŒæŠ¥é”™æ— æ³•è§£ækubernetesï¼Œå› ä¸ºk8sçš„å†…éƒ¨DNSæœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨
            5.3.3 åˆ—å‡ºå®¹å™¨ä¸­çš„è¯ä¹¦
                ls /var/run/secrets/kubernetes.io/serviceaccount/
                //è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œä¼ é€’æˆæƒè¯ä¹¦
                curl --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt https://kubernetes
                //å°†è¯ä¹¦è½¬åŒ–ä¸ºç¯å¢ƒå˜é‡
                export CURL_CA_BUNDLE=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
            5.3.4 APIæœåŠ¡å™¨çš„èº«ä»½éªŒè¯
                //å°†tokenè®¾ç½®ä¸ºç¯å¢ƒå˜é‡
                export TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
                //é‡æ–°è®¿é—®
                curl -H "Authorization: Bearer $TOKEN" https://10.96.0.1 -k    //æˆåŠŸåœ¨podä¸­è®¿é—®APIæœåŠ¡å™¨
                //æˆæƒæ‰€æœ‰æœåŠ¡è´¦æˆ·ç®¡ç†å‘˜æƒé™
                kubectl create clusterrolebinding permissive-binding --clusterrole=cluster-admin --group=system:serviceaccounts
            5.3.5 åœ¨podçš„å®¹å™¨ä¸­è·å–å‘½åç©ºé—´
                export NS=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace)
                //æµ‹è¯•å®¹å™¨å†…è®¿é—®æœ‰å‘½åç©ºé—´çš„API
                curl -H "Authorization: Bearer $TOKEN" https://10.96.0.1/api/v1/namespaces/$NS/pods -k
        5.4 ä½¿ç”¨å¤§ä½¿å®¹å™¨ç®€åŒ–å’ŒAPIæœåŠ¡å™¨çš„æ²Ÿé€š
            æœ¬è´¨æ˜¯å•ä¸ªå®¹å™¨httpè®¿é—®å¤§ä½¿å®¹å™¨ï¼Œç„¶åå¤§ä½¿å®¹å™¨httpsè®¿é—®APIæœåŠ¡å™¨ï¼Œç±»ä¼¼ä¸ç¿»å¢™çš„VPN
            5.4.1 åˆ›å»ºyamlæ–‡ä»¶ï¼šcurl-with-ambassador.yaml
                apiVersion: v1
                kind: Pod
                metadata:
                  name: curl-with-ambassador
                spec:
                  containers:
                  - name: main
                    image: tutum/curl
                    command: ["sleep", "9999999"]
                  - name: ambassador
                    image: luksa/kubectl-proxy:1.6.2   //æ–‡æ¡£ä½œè€…çš„imageï¼Œä¸Šä¼ åˆ°äº†docker hubå…¬æœ‰ä»“åº“ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè¯ä¹¦é—®é¢˜
                æ³¨æ„âš ï¸ï¼šæœ€å¥½æ˜¯è‡ªå·±åˆ›å»ºè¿™ä¸ªå¤§ä½¿å®¹å™¨ï¼Œå°†è¯ä¹¦æ·»åŠ åˆ°imageé‡Œé¢
            5.4.1 è¿›å…¥mainå®¹å™¨ç„¶åè®¿é—®å¤§ä½¿å®¹å™¨
                kubectl exec -it curl-with-ambassador -c main bash
                curl localhost:8001
        5.5 ä½¿ç”¨å®¢æˆ·ç«¯åº“æ²Ÿé€šAPIæœåŠ¡å™¨
            å®˜æ–¹ï¼š
                Golang clientâ€”https://github.com/kubernetes/client-go
                Pythonâ€”https://github.com/kubernetes-incubator/client-python
            ç¬¬ä¸‰æ–¹ï¼š
                Java client by Fabric8â€”https://github.com/fabric8io/kubernetes-client
                Java client by Amdatuâ€”https://bitbucket.org/amdatulabs/amdatu-kubernetes
                Node.js client by tenxcloudâ€”https://github.com/tenxcloud/node-kubernetes-client
                Node.js client by GoDaddyâ€”https://github.com/godaddy/kubernetes-client
                PHPâ€”https://github.com/devstub/kubernetes-api-php-client
                Another PHP clientâ€”https://github.com/maclof/kubernetes-client
                Rubyâ€”https://github.com/Ch00k/kubr
                Another Ruby clientâ€”https://github.com/abonas/kubeclient
                Clojureâ€”https://github.com/yanatan16/clj-kubernetes-api
                Scalaâ€”https://github.com/doriordan/skuber
                Perlâ€”https://metacpan.org/pod/Net::Kubernetes
            5.5.1 minikubeå¯ç”¨Swagger-UI
                minikube start --extra-config=apiserver.Features.Enable-SwaggerUI=true
            5.5.2 æŸ¥çœ‹ç•Œé¢
                http(s)://<api server>:<port>/swagger-ui
                https://https://192.168.99.110:8443/swagger-ui  //è¿™é‡Œéœ€è¦è¯ä¹¦


ä½¿ç”¨Deploymentsï¼šä»¥å£°æ˜çš„æ–¹å¼æ›´æ–°åº”ç”¨
    1.åˆ›å»ºDeployment: kubia-deployment-v1.yaml
        apiVersion: apps/v1beta1
        kind: Deployment
        metadata:
          name: kubia
        spec:
          replicas: 3
          template:
            metadata:
              name: kubia
              labels:
                app: kubia
            spec:
              containers:
              - image: luksa/kubia:v1
                name: nodejs
    2.æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
        kubectl get deployment
        kubectl describe deployment
        kubectl rollout status deployment kubia   //é‡è¦çš„å‘½ä»¤

ä½¿ç”¨StatefulSetsï¼šéƒ¨ç½²å‰¯æœ¬æœ‰çŠ¶æ€çš„åº”ç”¨
    1.åˆ›å»ºHeadless Serviceå¯¹è±¡
        apiVersion: v1
        kind: Service
        metadata:
          name: kubia
        spec:
          clusterIP: None
          selector:
            app: kubia
          ports:
          - name: http
            port: 80
    2.åˆ›å»ºStatefulSetå¯¹è±¡
        apiVersion: apps/v1beta1
        kind: StatefulSet
        metadata:
          name: kubia
        spec:
          serviceName: kubia
          replicas: 2
          template:
            metadata:
              labels:
                app: kubia
            spec:
              containers:
              - name: kubia
                image: luksa/kubia-pet
                ports:
                - name: http
                  containerPort: 8080
                volumeMounts:
                - name: data
                  mountPath: /var/data


å…¶ä»–äº‹é¡¹ï¼š
    Kubernetesé—´podçš„ç½‘ç»œé€šä¿¡æ˜¯ä½¿ç”¨CNIæ’ä»¶æ¥å£ï¼Œå®ƒçš„å®ç°æœ‰Flannelç­‰














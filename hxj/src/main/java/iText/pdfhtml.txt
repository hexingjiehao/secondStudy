1.å­¦ä¹ iText-pdfhtmlçŸ¥è¯†ç‚¹ï¼šğŸŒ¹ğŸŒ¹ğŸŒ¹
    æ¦‚å¿µï¼šä½¿ç”¨HTMLå’ŒCSSä½œä¸ºæ¨¡æ¿æ ¼å¼ç”ŸæˆPDFæ–‡æ¡£
    å†å²ï¼šHTMLWorkerå°†ç®€å•çš„htmlè½¬åŒ–ä¸ºitextå¯¹è±¡
         HTMLWorkeråºŸå¼ƒ
         pdfHtmlå‘å¸ƒï¼Œå®Œå…¨ä¸åŒçš„è®¾è®¡
    å…¥é—¨ç”µå­ä¹¦ï¼šã€ŠConverting HTML to PDF with pdfHTML.pdfã€‹
        ç¬¬1ç« ï¼šhello,worldç¨‹åºï¼Œä»htmlåˆ°pdfğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
            -ç¤ºä¾‹çš„ç»“æ„ï¼ˆæ ¸å¿ƒæ˜¯éœ€è¦å°†è®¸å¯è¯æ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œæ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼‰
                    public static final String HTML ="<h1>Test</h1><p>Hello World</p><img src=\"img/logo.png\">";
                    public static final String BASEURI = "src/main/resources/html/hello.html";

                    public static final String TARGET = "target/results/ch01/test-03.pdf";
                    publicstaticvoidmain(String[]args)throwsIOException{
                        LicenseKey.loadLicenseFile(System.getenv("ITEXT7_LICENSEKEY") + "/itextkey-html2pdf_typography.xml");
                        new C01E01_HelloWorld().createPdf(HTML, TARGET);
                    }
            -è½¬åŒ–htmlåˆ°pdf
                å­—ç¬¦ä¸²2Streamï¼š
                    public void createPdf(String baseUri, String html, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        HtmlConverter.convertToPdf(html, new FileOutputStream(dest), properties);
                    }
                æ–‡ä»¶2æ–‡ä»¶ï¼š
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        HtmlConverter.convertToPdf(new File(src), new File(dest));
                    }
                Stream2Streamï¼š
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        HtmlConverter.convertToPdf(new FileInputStream(src), new FileOutputStream(dest), properties);
                    }
                Stream2Writerï¼š
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        PdfWriter writer = new PdfWriter(dest,new WriterProperties().setFullCompressionMode(true));
                        HtmlConverter.convertToPdf(new FileInputStream(src), writer, properties);
                    }
                Stream2document
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        PdfWriter writer = new PdfWriter(dest);
                        PdfDocument pdf = new PdfDocument(writer);
                        pdf.setTagged();
                        HtmlConverter.convertToPdf(new FileInputStream(src), pdf, properties);
                    }
            -è½¬åŒ–htmlåˆ°itextå¯¹è±¡ï¼šï¼ˆconvertToDocument()å’ŒconvertToElements()ï¼‰
                åœ¨è½¬åŒ–è¿‡ç¨‹ä¸­å¾€pdfæ–‡ä»¶ä¸­æ·»åŠ ä¸œè¥¿
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        PdfWriter writer = new PdfWriter(dest);
                        PdfDocument pdf = new PdfDocument(writer);
                        Document document = HtmlConverter.convertToDocument(new FileInputStream(src), pdf, properties);
                        document.add(new Paragraph("Goodbye!"));
                        document.close();
                    }

                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        List<IElement> elements = HtmlConverter.convertToElements(new FileInputStream(src), properties);
                        PdfDocument pdf = new PdfDocument(new PdfWriter(dest));
                        Document document = new Document(pdf);
                        for (IElement element : elements) {
                            document.add(new Paragraph(element.getClass().getName()));
                            document.add((IBlockElement)element);
                        }
                        document.close();
                    }
            -æ€»ç»“
                æ ¸å¿ƒæ˜¯convertToPdf()ã€convertToDocument()å’ŒconvertToElements()

        ç¬¬2ç« ï¼šç”¨CSSå®šä¹‰æ ·å¼
            -ä¼ ç»Ÿhtml
                åœ¨<body>ä¸­ä½¿ç”¨æ ‡ç­¾<i>,<font>ç­‰
            -å†…è”CSS
               ç›´æ¥åœ¨æ ‡ç­¾ä¸­ä½¿ç”¨styleï¼Œidï¼Œclassç­‰ã€‚
            -å†…éƒ¨çš„CSS
                httpå¤´éƒ¨å®šä¹‰æ ·å¼æ ‡ç­¾
            -å¤–éƒ¨çš„CSS
                ä¸“é—¨çš„æ ·å¼æ–‡ä»¶ã€‚
            -ä½¿ç”¨ç»å¯¹å®šä½
                è®¾ç½®è·ç¦»å·¦è¾¹ç•Œå’Œä¸Šè¾¹ç•Œçš„è·ç¦»ã€‚
            -@pageæ³¨è§£æ ·å¼ï¼š(è®¾ç½®å½“å‰é¡µæ˜¯æ€»é¡µæ•°çš„ç¬¬å‡ é¡µ)
                <head>
                    <style>
                        @page {
                            @bottom-right {
                                content: "Page " counter(page) " of " counter(pages);
                            }
                        }
                    </style>
                </head>
            -æ·»åŠ åˆ†é¡µç¬¦
                <div style="page-break-after: always; width: 320pt;">
            -æ€»ç»“
                é»˜è®¤å­—ä½“æ˜¯Helvetica,æµè§ˆå™¨é»˜è®¤å­—ä½“serif

        ç¬¬3ç« ï¼šåŸºäºåª’ä½“æŸ¥è¯¢ç”ŸæˆPDF (ä¸åŒå¸ƒå±€)
            -åˆ›å»ºç”¨äºæ‰“å°çš„PDFæ–‡ä»¶ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                èŠ‚çº¦å¢¨ç›’ææ–™ï¼šæ˜¾ç¤ºæ—¶ç”¨ä¸€ä¸ªcssï¼Œæ‰“å°æ—¶ç”¨å¦ä¸€ä¸ªcss
                    <head>
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <link rel="stylesheet" type="text/css" href="css/sxsw.css"/>
                        <link rel="stylesheet" media="print only" href="css/sxsw_print.css">
                    </head>

                    //å±æ€§è®¾ç½®åª’ä½“è®¾å¤‡
                    public void createPdf(String baseUri, String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setBaseUri(baseUri);
                        MediaDeviceDescription mediaDeviceDescription =new MediaDeviceDescription(MediaType.PRINT);
                        properties.setMediaDeviceDescription(mediaDeviceDescription);
                        HtmlConverter.convertToPdf(new FileInputStream(src), new FileOutputStream(dest), properties);
                    }
            -åœ¨HTMLä¸­çš„å“åº”èƒ½åŠ›
                åªåœ¨é¡µé¢æ˜¾ç¤ºçš„æ ·å¼:(htmlé¡µé¢å’Œpdfçš„é¡µé¢æ ¼å¼é—®é¢˜)
                    @media only screen and (min-width: 600px) {
                        .col-1-m {width: 24.9%;}
                        .col-2-m {width: 49.9%;}
                        .col-3-m {width:74%}
                        .col-4-m {width: 99%;}
                        p{
                            font-size: 16pt;
                        }
                        h1{
                        font-size: 24pt;
                        }
                        h2{
                        font-size:18pt
                        }
                    }
            -ä¸ºæ¡Œé¢åˆ›å»ºPDF
                publicvoidcreatePdf(StringbaseUri,Stringsrc,Stringdest)throwsIOException{
                    PdfWriter writer = new PdfWriter(dest);
                    PdfDocument pdf = new PdfDocument(writer);
                    pdf.setTagged();
                    PageSize pageSize = PageSize.A4.rotate();
                    pdf.setDefaultPageSize(pageSize);

                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);

                    MediaDeviceDescription mediaDeviceDescription = new MediaDeviceDescription(MediaType.SCREEN);
                    mediaDeviceDescription.setWidth(pageSize.getWidth());
                    properties.setMediaDeviceDescription(mediaDeviceDescription);

                    HtmlConverter.convertToPdf(new FileInputStream(src), pdf, properties);
                }
            -ä¸ºå¹³æ¿ç”µè„‘åˆ›å»ºPDFï¼šï¼ˆåŒºåˆ«æ˜¯é¡µé¢çš„å¤§å°ï¼‰
                publicvoidcreatePdf(StringbaseUri,Stringsrc,Stringdest)throwsIOException{
                    PdfWriter writer = new PdfWriter(dest);
                    PdfDocument pdf = new PdfDocument(writer);
                    pdf.setTagged();
                    PageSize pageSize = new PageSize(575, 1500);
                    pdf.setDefaultPageSize(pageSize);

                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);

                    MediaDeviceDescription mediaDeviceDescription= new MediaDeviceDescription(MediaType.SCREEN);
                    mediaDeviceDescription.setWidth(pageSize.getWidth());
                    properties.setMediaDeviceDescription(mediaDeviceDescription);

                    HtmlConverter.convertToPdf(new FileInputStream(src), pdf, properties);
                }
            -ä¸ºæ™ºèƒ½æ‰‹æœºåˆ›å»ºPDFï¼šï¼ˆä¸€ä¸ªé¡µé¢å˜æˆäº†ä¸¤åˆ—ï¼‰
                publicvoidcreatePdf(StringbaseUri,Stringsrc,Stringdest)throwsIOException{
                     PdfWriter writer = new PdfWriter(dest);
                     PdfDocument pdf = new PdfDocument(writer);
                     pdf.setTagged();

                     PageSize pageSize = new PageSize(440, 2000);
                     pdf.setDefaultPageSize(pageSize);

                     ConverterProperties properties = new ConverterProperties();
                     properties.setBaseUri(baseUri);

                     MediaDeviceDescription mediaDeviceDescription= new MediaDeviceDescription(MediaType.SCREEN);
                     mediaDeviceDescription.setWidth(pageSize.getWidth());
                     properties.setMediaDeviceDescription(mediaDeviceDescription);

                     HtmlConverter.convertToPdf(new FileInputStream(src), pdf, properties);
                }
            -æ–‡æ¡£çš„è¯­ä¹‰ç»“æ„
                 pdf.setTagged();   //è®¾ç½®æ ‡è®°ï¼Œç”¨äºä¿å­˜é¡µé¢çš„æ ·å¼ã€‚åœ¨æŸ¥çœ‹å™¨çš„å·¦è¾¹èƒ½çœ‹åˆ°æ ‘ç»“æ„
            -æ€»ç»“
                600px = 6.25in = 450pt
                768px = 8in = 576pt
                æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå“åº”HTMLæ–‡ä»¶ï¼Œå¹¶é€šè¿‡å®šä¹‰ä¸åŒçš„åª’ä½“æŸ¥è¯¢å°†è¯¥æ–‡ä»¶è½¬æ¢ä¸ºä¸åŒçš„PDFæ–‡æ¡£ã€‚

        ç¬¬4ç« ï¼šä½¿ç”¨pdfHTMLåˆ›å»ºæŠ¥è¡¨
            -ç”¨ä¾‹çš„æè¿°
                ä¸‰ç§æ–¹å¼åˆ›å»ºpdfæ–‡æ¡£ï¼š
                    ä»å¤´åˆ›å»ºä¸€ä¸ªpdfæ–‡æ¡£
                    å¡«å……ä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„è¡¨æ ¼ï¼ˆacroForm æˆ–è€… XFAï¼‰
                    ä½¿ç”¨pdfhtmlè½¬åŒ–
                ä½¿ç”¨ä¸€ä¸ªxmlæ–‡ä»¶æè¿°ä¿¡æ¯ï¼Œç”Ÿæˆä¸åŒçš„pdfæ–‡ä»¶

            -ä½¿ç”¨XSLTå°†XMLè½¬æ¢ä¸ºHTMLï¼šï¼ˆxml -> html ->pdf ï¼‰ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                app.createPdf(app.createHtml(XML, XSL), BASEURI, DEST);

                public byte[] createHtml(String xmlPath, String xslPath) throws IOException, TransformerException {
                    ByteArrayOutputStream baos = new ByteArrayOutputStream();
                    Writer writer = new OutputStreamWriter(baos);
                    StreamSource xml = new StreamSource(new File(xmlPath));
                    StreamSource xsl = new StreamSource(new File(xslPath));
                    TransformerFactory factory = TransformerFactory.newInstance();
                    Transformer transformer = factory.newTransformer(xsl);
                    transformer.transform(xml, new StreamResult(writer));
                    writer.flush();
                    writer.close();
                    return baos.toByteArray();
                }

                public void createPdf(byte[] html, String baseUri, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), new FileOutputStream(dest), properties);
                }
            -æ·»åŠ èƒŒæ™¯å’Œè‡ªå®šä¹‰é¡µçœ‰æˆ–é¡µè„šï¼ˆä½¿ç”¨äº‹ä»¶ç›‘å¬è§£å†³ï¼‰
                class Background implements IEventHandler{
                    PdfXObject stationery;

                    public Background(PdfDocument pdf, String src) throws IOException {
                        PdfDocument template = new PdfDocument(new PdfReader(src));
                        PdfPage page = template.getPage(1);
                        stationery = page.copyAsFormXObject(pdf);
                        template.close();
                    }

                    @Override
                    public void handleEvent(Event event) {
                        PdfDocumentEvent docEvent = (PdfDocumentEvent) event;
                        PdfDocument pdf = docEvent.getDocument();
                        PdfPage page = docEvent.getPage();
                        PdfCanvas pdfCanvas = new PdfCanvas(
                        page.newContentStreamBefore(), page.getResources(), pdf);
                        pdfCanvas.addXObject(stationery, 0, 0);

                        Rectangle rect = new Rectangle(36, 32, 36, 64);
                        Canvas canvas = new Canvas(pdfCanvas, pdf, rect);
                        canvas.add(new Paragraph(String.valueOf(pdf.getNumberOfPages()))
                              .setFontSize(48)
                              .setFontColor(Color.WHITE));
                        canvas.close();
                    }
                }

                public void createPdf(byte[]html,String baseUri,String stationery,String dest)throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);
                    PdfWriter writer = new PdfWriter(dest);
                    PdfDocument pdf = new PdfDocument(writer);

                    IEventHandler handler = new Background(pdf, stationery);
                    pdf.addEventHandler(PdfDocumentEvent.START_PAGE, handler);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), pdf, properties);
                }
            -å°†HTMLé¡µé¢è½¬æ¢ä¸ºå•é¡µPDFï¼ˆå°†å†…å®¹è½¬åŒ–ä¸ºèƒ½å¤Ÿå­˜æ”¾åˆ°ä¸€å¼ pdfçš„å¤§å°ï¼Œå¦åˆ™è¶…è¿‡çš„éƒ¨åˆ†æ˜¯ç©ºç™½ï¼‰
                public void createPdf(byte[] html,String baseUri,String dest) throws IOException {
                     ConverterProperties properties = new ConverterProperties();
                     properties.setBaseUri(baseUri);
                     PdfWriter writer = new PdfWriter(dest);
                     PdfDocument pdf = new PdfDocument(writer);
                     pdf.setDefaultPageSize(new PageSize(595, 14400));

                     Document document = HtmlConverter.convertToDocument(new ByteArrayInputStream(html), pdf, properties);
                     EndPosition endPosition = new EndPosition();
                     LineSeparator separator = new LineSeparator(endPosition);
                     document.add(separator);
                     document.getRenderer().close();

                     PdfPage page = pdf.getPage(1);
                     float y = endPosition.getY() - 36;
                     page.setMediaBox(new Rectangle(0, y, 595, 14400 - y));
                     document.close();
                }

                class EndPosition implements ILineDrawer{
                    protected float y;

                    public float getY() {
                        return y;
                    }

                    @Override
                    public void draw(PdfCanvas pdfCanvas, Rectangle rect) {
                        this.y = rect.getY();
                    }
                    @Override
                    public Color getColor() {return null;}
                    @Override
                    public float getLineWidth() {return 0;}
                    @Override
                    public void setColor(Color color) {}
                    @Override
                    public void setLineWidth(float lineWidth) {}
                }
            -å‘æŠ¥è¡¨æ·»åŠ ä¹¦ç­¾ (æ¯”å¦‚æŒ‡å®šæ ‡é¢˜ï¼Œèƒ½è·³è½¬åˆ°ç›¸åº”çš„è¯¦ç»†ä¿¡æ¯--ä¹¦ç­¾å¥æŸ„)
                public void createPdf(byte[] html, String baseUri, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);

                    OutlineHandler outlineHandler = OutlineHandler.createStandardHandler();
                    properties.setOutlineHandler(outlineHandler);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), new FileOutputStream(dest), properties);
                }

                public void createPdf(byte[] html, String baseUri, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);

                    OutlineHandler outlineHandler = new OutlineHandler();
                    outlineHandler.putTagPriorityMapping("h1", 1);
                    outlineHandler.putTagPriorityMapping("p", 2);

                    properties.setOutlineHandler(outlineHandler);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), new FileOutputStream(dest), properties);
                }
            -ä½¿ç”¨pdfHTMLåˆ›å»ºPDF/Aæ–‡æ¡£
                public void createPdf(byte[] html, String baseUri, String dest, String intent) throws IOException {
                    PdfWriter writer = new PdfWriter(dest);
                    PdfADocument pdf = new PdfADocument(writer,
                                                        PdfAConformanceLevel.PDF_A_2B,
                                                        new PdfOutputIntent("Custom",
                                                                            "",
                                                                            "http://www.color.org",
                                                                            "sRGB IEC61966-2.1",
                                                                            new FileInputStream(intent)));
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), pdf, properties);
                }

                //ä¸åŒçš„æƒé™
                public void createPdf(byte[] html, String baseUri, String dest, String intent) throws IOException {
                    PdfWriter writer = new PdfWriter(dest);
                    PdfADocument pdf = new PdfADocument(writer,
                                                        PdfAConformanceLevel.PDF_A_2A,
                                                        new PdfOutputIntent("Custom",
                                                                            "",
                                                                            "http://www.color.org",
                                                                            "sRGB IEC61966-2.1",
                                                                            new FileInputStream(intent)));
                    pdf.setTagged();
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), pdf, properties);
                }

                //æ·»åŠ é™„ä»¶
                public void createPdf(byte[] xml, byte[] html, String baseUri, String dest, String intent) throws IOException {
                    PdfWriter writer = new PdfWriter(dest);
                    PdfADocument pdf = new PdfADocument(writer,
                                                        PdfAConformanceLevel.PDF_A_3A,
                                                        new PdfOutputIntent("Custom",
                                                                            "",
                                                                            "http://www.color.org",
                                                                            "sRGB IEC61966-2.1",
                                                                            new FileInputStream(intent)));
                    pdf.setTagged();
                    pdf.addFileAttachment("Movie info", xml, "movies.xml",PdfName.ApplicationXml, new PdfDictionary(), PdfName.Data);
                    ConverterProperties properties = new ConverterProperties();
                    properties.setBaseUri(baseUri);
                    HtmlConverter.convertToPdf(new ByteArrayInputStream(html), pdf, properties);
                }
            -æ€»ç»“
                PDF/Aä¹Ÿç§°ä¸ºISO 19005æ ‡å‡†ã€‚å¾…è½¬åŒ–çš„htmlä¸å…è®¸javascriptå’ŒåŠ å¯†æ“ä½œ
                æˆ‘ä»¬ä½¿ç”¨XSLTä»XMLåˆ›å»ºHTMLï¼Œä»¥ä¾¿åˆ›å»ºæŠ¥å‘Šå’Œå‘ç¥¨

        ç¬¬5ç« ï¼šè‡ªå®šä¹‰å·¥ä½œæ ‡ç­¾å’ŒCSSåº”ç”¨ç¨‹åº
            -æ›´æ”¹æ ‡è®°çš„è¡Œä¸º
                æ ¸å¿ƒæ˜¯DefaultTagWorkerFactoryå’ŒDefaultCssApplierFactory
                æ ‡ç­¾å¯¹åº”çš„ç±»ï¼šPTagWorkerï¼š<p>
                            SpanTagWorkerï¼š<span>,<b>,<i>
                            ATagWorkerï¼š<a>
                æ ¸å¿ƒæ¥å£å’Œå®ç°æ–¹æ³•ï¼š
                    ITagWorkerå’Œ4ä¸ªå®ç°æ–¹æ³•
                æ¡ˆä¾‹ä»£ç ï¼š
                    public void createPdf(String src, String dest) throws IOException {
                        ConverterProperties converterProperties = new ConverterProperties();
                        converterProperties.setTagWorkerFactory(new DefaultTagWorkerFactory() {

                            @Override
                            public ITagWorker getCustomTagWorker( IElementNode tag, ProcessorContext context) {
                                if ("a".equalsIgnoreCase(tag.name()) ) {
                                    return new SpanTagWorker(tag, context);
                                }
                                return null;
                            }
                        });
                        HtmlConverter.convertToPdf(new File(src), new File(dest), converterProperties);
                    }
            -ä»‹ç»è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆç”¨æ¥åšæ¨¡ç‰ˆä¹‹ç±»çš„ï¼‰ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                public void createPdf(String name, String src, String dest) throws IOException {
                    SimpleDateFormat sdf = new SimpleDateFormat("MMMM d, yyyy", Locale.ENGLISH);
                    ConverterProperties converterProperties = new ConverterProperties();
                    converterProperties.setTagWorkerFactory(new DefaultTagWorkerFactory() {

                        @Override
                        public ITagWorker getCustomTagWorker( IElementNode tag, ProcessorContext context) {
                            if ("name".equalsIgnoreCase(tag.name()) ) {
                                return new SpanTagWorker(tag, context){

                                            @Override
                                            public boolean processContent(String content, ProcessorContext context) {
                                                return super.processContent(name, context);
                                            }
                                        };
                            }else if ("date".equalsIgnoreCase(tag.name()) ) {
                                return new SpanTagWorker(tag, context) {

                                            @Override
                                            public boolean processContent(String content, ProcessorContext context) {
                                                return super.processContent(sdf.format(new Date()), context);
                                            }
                                        };
                            }
                            return null;
                        }
                    });
                    HtmlConverter.convertToPdf(new File(src), new File(dest), converterProperties);
                }
            -åˆ›å»ºè‡ªå·±çš„ITagWorkerå®ç°ï¼ˆå®ç°äºŒç»´ç çš„pdfï¼‰
                class QRCodeTagWorkerFactory extends DefaultTagWorkerFactory {
                    @Override
                    public ITagWorker getCustomTagWorker(IElementNode tag, ProcessorContext context) {
                        if(tag.name().equals("qr")){
                            return new QRCodeTagWorker(tag, context);
                        }
                        return null;
                    }
                }

                static class QRCodeTagWorker implements ITagWorker{
                    private static String[] allowedErrorCorrection ={"L","M","Q","H"};
                    private static String[] allowedCharset ={"Cp437","Shift_JIS","ISO-8859-1","ISO-8859-16"};
                    private BarcodeQRCode qrCode;
                    private Image qrCodeAsImage;

                    public QRCodeTagWorker(IElementNode element, ProcessorContext context){
                        Map<EncodeHintType, Object> hints = new HashMap<>();
                        String charset = element.getAttribute("charset");
                        if(checkCharacterSet(charset)){
                            hints.put(EncodeHintType.CHARACTER_SET, charset);
                        }
                        String errorCorrection = element.getAttribute("errorcorrection");
                        if(checkErrorCorrectionAllowed(errorCorrection)){
                            ErrorCorrectionLevel errorCorrectionLevel = getErrorCorrectionLevel(errorCorrection);
                            hints.put(EncodeHintType.ERROR_CORRECTION, errorCorrectionLevel);
                        }
                        qrCode = new BarcodeQRCode("placeholder",hints);
                    }

                    @Override
                    public boolean processContent(String content, ProcessorContext context) {
                        qrCode.setCode(content);
                        return true;
                    }
                    @Override
                    public boolean processTagChild(ITagWorker childTagWorker, ProcessorContext context) {
                        return false;
                    }
                    @Override
                    public void processEnd(IElementNode element, ProcessorContext context) {
                        qrCodeAsImage = new Image(qrCode.createFormXObject(context.getPdfDocument()));
                    }

                    @Override ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                    public IPropertyContainer getElementResult() {
                        return qrCodeAsImage;
                    }
                    private static boolean checkErrorCorrectionAllowed(String toCheck){
                        for(int i = 0; i<allowedErrorCorrection.length;i++){
                            if(toCheck.toUpperCase().equals(allowedErrorCorrection[i])){
                                return true;
                            }
                        }
                        return false;
                    }
                    private static boolean checkCharacterSet(String toCheck){
                        for(int i = 0; i<allowedCharset.length;i++){
                            if(toCheck.equals(allowedCharset[i])){
                                return true;
                            }
                        }
                        return false;
                    }
                    private static ErrorCorrectionLevel getErrorCorrectionLevel(String level){
                        switch(level) {
                            case "L":
                            return ErrorCorrectionLevel.L;
                            case "M":
                            return ErrorCorrectionLevel.M;
                            case "Q":
                            return ErrorCorrectionLevel.Q;
                            case "H":
                            return ErrorCorrectionLevel.H;
                        }
                        return null;
                    }
                }

                class QRCodeTagCssApplierFactory extends DefaultCssApplierFactory {
                    @Override
                    public ICssApplier getCustomCssApplier(IElementNode tag) {
                        if (tag.name().equals("qr")) {
                            return new BlockCssApplier();
                        }
                        return null;
                    }
                }

                public void createPdf(String src, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setCssApplierFactory(new QRCodeTagCssApplierFactory())
                              .setTagWorkerFactory(new QRCodeTagWorkerFactory());
                    HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                }
            -åˆ›å»ºè‡ªå®šä¹‰CSSåº”ç”¨ç¨‹åº
                å®ç°æ¥å£æ–¹æ³•apply(),åªä½œç”¨äº<div>
                class GrayBackgroundBlockCssApplier implements ICssApplier {

                    public void apply(ProcessorContext context,IStylesContainer stylesContainer, ITagWorker tagWorker){
                        Map<String, String> cssProps = stylesContainer.getStyles();
                        IPropertyContainer container = tagWorker.getElementResult();
                        if (container != null && cssProps.containsKey(CssConstants.BACKGROUND_COLOR)) {
                            cssProps.put(CssConstants.BACKGROUND_COLOR, "#dddddd");
                            BackgroundApplierUtil.applyBackground(cssProps, context, container);
                        }
                    }
                }
            -å®ç°ä½ çš„è‡ªå®šä¹‰CSS:(åœ¨æµè§ˆå™¨ä¸­æ— æ•ˆï¼Œåœ¨pdfä¸­æœ‰æ•ˆ)
                public static final Map<String, String> KLEUR = new HashMap<String, String>();
                static {
                    KLEUR.put("wit", "white");
                    KLEUR.put("zwart", "black");
                    KLEUR.put("rood", "red");
                    KLEUR.put("groen", "green");
                    KLEUR.put("blauw", "blue");
                }

                classDutchColorCssApplierextendsBlockCssApplier{
                    @Override
                    public void apply(ProcessorContext context,IStylesContainer stylesContainer, ITagWorker tagWorker){
                        Map<String, String> cssStyles = stylesContainer.getStyles();
                        if(cssStyles.containsKey("kleur")){
                            cssStyles.put(CssConstants.COLOR,KLEUR.get(cssStyles.get("kleur")));
                            stylesContainer.setStyles(cssStyles);
                        }
                        if(cssStyles.containsKey("achtergrond")){
                            cssStyles.put(CssConstants.BACKGROUND_COLOR,KLEUR.get(cssStyles.get("achtergrond")));
                            stylesContainer.setStyles(cssStyles);
                        }
                        super.apply(context, stylesContainer,tagWorker);
                    }
                }

                public void createPdf(String src, String dest) throws IOException {
                    ConverterProperties converterProperties = new ConverterProperties();
                    converterProperties.setCssApplierFactory(new DefaultCssApplierFactory() {

                        ICssApplier dutchCssColor = new DutchColorCssApplier();
                        @Override
                        public ICssApplier getCustomCssApplier(IElementNode tag) {
                            if(tag.name().equals(TagConstants.H1)|| tag.name().equals(TagConstants.DIV)){
                                return dutchCssColor;
                            }
                            return null;
                        }
                    });
                    HtmlConverter.convertToPdf(new File(src), new File(dest), converterProperties);
                }
            -æ€»ç»“
                æˆ‘ä»¬é€šè¿‡æ”¹å˜æ ‡ç­¾å’ŒCSSçš„è§£é‡Šæ–¹å¼æ¥æ”¹å˜pdfHTMLé™„åŠ ç»„ä»¶çš„æ ¸å¿ƒåŠŸèƒ½

        ç¬¬6ç« ï¼šä½¿ç”¨pdfHTMLä¸­çš„å­—ä½“
            -æ ‡å‡†å­—ä½“ï¼ˆ14ç§ï¼‰
                Times-Roman / Helvetica / Courier / Symbol
                Times-Bold / Helvetica-Bold / Courier-Bold
                Times-Italic / Helvetica-Oblique / Courier-Oblique / ZapfDingbats
                Times-BoldItalic / Helvetica-Boldoblique / Courier-Boldoblique
            -iTexté™„å¸¦çš„å­—ä½“(12ç§)
                sans: å¸¸è§„å­—ä½“/ç²—ä½“/æ–œä½“/ç²—æ–œä½“
                serif: å¸¸è§„å­—ä½“/ç²—ä½“/æ–œä½“/ç²—æ–œä½“
                monospace: å¸¸è§„å­—ä½“/ç²—ä½“/æ–œä½“/ç²—æ–œä½“
            -ç³»ç»Ÿå­—ä½“
                FontProvider provider = new DefaultFontProvider(true,true,false);
                åˆ†åˆ«å¯¹åº”å‚æ•°ï¼š
                    registerStandardPdfFonts--æ³¨å†Œ14ç§æ ‡å‡†å­—ä½“,é»˜è®¤true
                    registerShippedFreeFonts--æ³¨å†Œ12ç§å·²å‘å¸ƒå­—ä½“,é»˜è®¤true
                    registerSystemFonts--æ³¨å†Œç³»ç»Ÿå­—ä½“,é»˜è®¤false

                public void createPdf(String src, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    properties.setFontProvider(new DefaultFontProvider(true, true, true));
                    HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                }
            -Webå¼€æ”¾å­—ä½“æ ¼å¼çš„å­—ä½“
                @font-face {
                    font-family: "SourceSerifPro-Regular";
                    src: url("fonts/SourceSerifPro-Regular.otf.woff") format("woff");
                }
                .regular {
                    font-family: "SourceSerifPro-Regular";
                }
                <td class="regular">lalalalalalal</td>
            -å‘å­—ä½“æä¾›ç¨‹åºæ·»åŠ é€‰å®šå­—ä½“
                //å¯ä»¥æ·»åŠ å…·ä½“å­—ä½“ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å­—ä½“ç›®å½•
                public static final String FONT = "src/main/resources/fonts/cardo/Cardo-Regular.ttf";

                public void createPdf(String src, String font, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();

                    FontProvider fontProvider = new DefaultFontProvider();
                    FontProgram fontProgram = FontProgramFactory.createFont(font);
                    fontProvider.addFont(fontProgram);
                    properties.setFontProvider(fontProvider);

                    HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                }

            -ä¸ºå­—ä½“é€‰æ‹©å™¨é€‰æ‹©æ­£ç¡®çš„é¡ºåº
                æ·»åŠ ç›®å½•æ—¶ï¼Œæ— æ³•æ§åˆ¶å­—ä½“æ³¨å†Œçš„é¡ºåº
                    public void createPdf(String src, String[] fonts, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        FontProvider fontProvider = new DefaultFontProvider(false, false, false);
                        for (String font : fonts) {
                                FontProgram fontProgram = FontProgramFactory.createFont(font);
                                fontProvider.addFont(fontProgram);
                            }
                        properties.setFontProvider(fontProvider);
                        HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                    }
                é¡ºåºçš„é‡è¦æ€§ï¼šç¬¬ä¸€ä¸ªå­—ä½“åŒ…å«æ‰€æœ‰æ¸²æŸ“éœ€æ±‚,ç¬¬äºŒä¸ªå­—ä½“è¢«æŠ›å¼ƒäº†,åè¿‡æ¥ä¹Ÿä¸€æ ·
                    public static final String[] FONTS = {
                        "src/main/resources/fonts/cardo/Cardo-Regular.ttf",
                        "src/main/resources/fonts/noto/NotoSans-Regular.ttf"
                    };
                å…ˆä»htmlä¸­æ‰¾å­—ä½“ï¼Œç„¶åæ‰æ˜¯å¾ªç¯æ–¹å¼æ‰¾å­—ä½“æä¾›ç¨‹åº
            -é€‰æ‹©é€‚åˆæ‚¨çš„ç¼–ç 
                è‡³å°‘åº”è¯¥æ˜¯toUnicodeçš„æ˜ å°„
                public static final String FONT = "src/main/resources/fonts/cardo/Cardo-Regular.ttf";
                public void createPdf(String src, String font, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    FontProvider fontProvider = new DefaultFontProvider(false, false, false);
                    FontProgram fontProgram = FontProgramFactory.createFont(font);
                    fontProvider.addFont(fontProgram, "Winansi");
                    properties.setFontProvider(fontProvider);
                    HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                }

                ä½¿ç”¨(Win)Ansiç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å­˜å‚¨ä¸ºä¸€ä¸ªå­—èŠ‚ï¼›ä½¿ç”¨Identity-Hç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å­˜å‚¨ä¸ºä¸¤ä¸ªå­—èŠ‚
            -å›½é™…åŒ–
                æ ‡æ˜æ–‡ä»¶çš„ç±»å‹ã€‚å¦åˆ™å¯èƒ½ä¹±ç ã€‚æ¯”å¦‚<meta charset="UTF-8">
                ä¸åŒçš„è¯­è¨€å¯èƒ½éœ€è¦ç‰¹æ®Šæ’ç‰ˆåŠŸèƒ½ï¼Œè¿™éœ€è¦pdfCalligraphé™„åŠ ç»„ä»¶
                å¯ä»¥é€šè¿‡å¯¼å…¥ç›¸å…³çš„å­—ä½“è§£å†³ä¹±ç å’Œæ’ç‰ˆé—®é¢˜

                public static final String[] FONTS = {
                    "src/main/resources/fonts/noto/NotoSans-Regular.ttf",
                    "src/main/resources/fonts/noto/NotoSans-Bold.ttf",
                    "src/main/resources/fonts/noto/NotoSansCJKsc-Regular.otf",
                    "src/main/resources/fonts/noto/NotoSansCJKjp-Regular.otf",
                    "src/main/resources/fonts/noto/NotoSansCJKkr-Regular.otf",
                    "src/main/resources/fonts/noto/NotoNaskhArabic-Regular.ttf",
                    "src/main/resources/fonts/noto/NotoSansHebrew-Regular.ttf"
                };

                public void createPdf(String src, String[] fonts, String dest) throws IOException {
                    ConverterProperties properties = new ConverterProperties();
                    FontProvider fontProvider = new DefaultFontProvider(false, false, false);
                    for (String font : fonts) {
                        FontProgram fontProgram = FontProgramFactory.createFont(font);
                        fontProvider.addFont(fontProgram);
                    }
                    properties.setFontProvider(fontProvider);
                    HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                }
            -æ€»ç»“
                æ”¯æŒçš„å­—ä½“ç±»å‹æœ‰(.AFM/.PFB/.TTF/.otf/.ttf/.ttc/.woff)
                æ ¸å¿ƒç»„ä»¶DefaultFontProvider

        ç¬¬7ç« ï¼šæœ‰å…³pdfHTMLçš„å¸¸è§é—®é¢˜
            -å¦‚ä½•å°†ASPæˆ–JSPé¡µé¢è½¬æ¢ä¸ºPDF? ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿
                ç­”ï¼šå¯¹htmlçš„æŠ½è±¡ï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œå°†å…¶åˆ›å»ºä¸ºhtmlã€‚pdfHtmlåªèƒ½è§£æhtmå’Œcss

            -å¦‚ä½•å°†å¤šä¸ªHTMLæ–‡ä»¶è§£æä¸ºä¸€ä¸ªPDF?
                ç­”ï¼šç¬¬ä¸€ç§ï¼šå°†æ¯ä¸ªHTMLè½¬æ¢ä¸ºå†…å­˜ä¸­çš„ä¸€ä¸ªå•ç‹¬çš„PDFæ–‡ä»¶ã€‚ä½¿ç”¨pdfmergeå°†è¿™äº›æ–‡ä»¶åˆå¹¶ä¸ºå•ä¸ªPDFã€‚å¯èƒ½å­˜åœ¨ä¸­é—´æœ‰å¤§é‡ç©ºæ ¼
                        public void createPdf(String baseUri, String[] src, String dest) throws IOException {
                            ConverterProperties properties = new ConverterProperties();
                            properties.setBaseUri(baseUri);
                            PdfWriter writer = new PdfWriter(dest);
                            PdfDocument pdf = new PdfDocument(writer);
                            PdfMerger merger = new PdfMerger(pdf);

                            for (String html : src) {
                                ByteArrayOutputStream baos = new ByteArrayOutputStream();
                                PdfDocument temp = new PdfDocument(new PdfWriter(baos));
                                HtmlConverter.convertToPdf(new FileInputStream(html), temp, properties);

                                temp = new PdfDocument(new PdfReader(new ByteArrayInputStream(baos.toByteArray())));
                                merger.merge(temp, 1, temp.getNumberOfPages());
                                temp.close();
                            }
                            pdf.close();
                        }
                   ç¬¬äºŒç§ï¼š(æ¨è--é¡µé¢æ›´åŠ ç´§å‡‘) å°†ä¸åŒçš„HTMLæ–‡ä»¶è§£æä¸ºä¸€ç³»åˆ—iTextå…ƒç´ ã€‚æˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›å…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªPDFæ–‡æ¡£ä¸­ã€‚
                        public void createPdf(String baseUri, String[] src, String dest) throws IOException {
                            ConverterProperties properties = new ConverterProperties();
                            properties.setBaseUri(baseUri);
                            PdfWriter writer = new PdfWriter(dest);
                            PdfDocument pdf = new PdfDocument(writer);
                            Document document = new Document(pdf);
                            for (String html : src) {
                                List<IElement> elements =
                                HtmlConverter.convertToElements(new FileInputStream(html), properties);
                                for (IElement element : elements) {
                                    document.add((IBlockElement)element);
                                }
                            }
                            document.close();
                        }

            -pdfHTMLå¯ä»¥å°†Base64å›¾åƒå‘ˆç°ä¸ºPDFæ ¼å¼å—?
                ç­”ï¼šå¯ä»¥

            -æˆ‘å¯ä»¥ä»URLç”ŸæˆPDFè€Œä¸æ˜¯ä»ç£ç›˜ä¸Šçš„æ–‡ä»¶?
                ç­”ï¼šå¯ä»¥ã€‚å¯ä»¥ä»ä»»ä½•HTML InputStreamç”ŸæˆPDF
                    new C07E04_CreateFromURL().createPdf(new URL("https://stackoverflow.com/help/on-topic"), DEST);
                    public void createPdf(URL url, String dest) throws IOException {
                        HtmlConverter.convertToPdf(url.openStream(), new FileOutputStream(dest));
                    }

                    //è‡ªå®šä¹‰é¡µé¢å¤§å°æ¥é€‚åº”ç»“æœ
                    public void createPdf(URL url, String dest) throws IOException {
                        PdfWriter writer = new PdfWriter(dest);
                        PdfDocument pdf = new PdfDocument(writer);
                        PageSize pageSize = new PageSize(850, 1700);
                        pdf.setDefaultPageSize(pageSize);

                        ConverterProperties properties = new ConverterProperties();
                        MediaDeviceDescription mediaDeviceDescription = new MediaDeviceDescription(MediaType.SCREEN);
                        mediaDeviceDescription.setWidth(pageSize.getWidth());
                        properties.setMediaDeviceDescription(mediaDeviceDescription);

                        HtmlConverter.convertToPdf(url.openStream(), pdf, properties);
                    }

            -æˆ‘ä»¬æ˜¯å¦éœ€è¦ä¸€ä¸ªæµè§ˆå™¨å¼•æ“æ¥å°†HTML+CSSå‘ˆç°ä¸ºPDFï¼Ÿ
                ç­”ï¼šä¸éœ€è¦ã€‚

            -æˆ‘çš„HTMLå¿…é¡»æ˜¯æœ‰æ•ˆçš„XMLå—?
                ç­”ï¼šiText5éœ€è¦ã€‚pdfHTMLä¸éœ€è¦

            -å¦‚ä½•ä½¿ç”¨pdfHTMLå‘PDFæ·»åŠ å…ƒæ•°æ®?
                ç­”ï¼špublic void createPdf(String src, String dest) throws IOException {
                      PdfWriter writer = new PdfWriter(dest, new WriterProperties().addXmpMetadata());
                      HtmlConverter.convertToPdf(new FileInputStream(src), writer);
                   }

            -HTMLä¸­çš„åº¦é‡ç³»ç»Ÿå¦‚ä½•ä¸PDFä¸­çš„åº¦é‡ç³»ç»Ÿç›¸å…³è”?
                ç­”ï¼š1 in = 25.4 mm = 2.54 cm = 0.254 dm = 0.0254 m = 72 user units = 72pt = 96 px =6 pc

            -æˆ‘å¯ä»¥æŠŠHTMLè¡¨å•è½¬æ¢æˆPDFæ ¼å¼å—?
                ç­”ï¼šå¯ä»¥ã€‚ä½†æ˜¯å±€é™äºæ–‡æœ¬ã€‚
                    public void createPdf(String src, String dest) throws IOException {
                        ConverterProperties properties = new ConverterProperties();
                        properties.setCreateAcroForm(true);  //è®¾ç½®äº¤äº’å¼è¡¨å•
                        HtmlConverter.convertToPdf(new File(src), new File(dest), properties);
                    }

            -å¦‚ä½•å‘ˆç°ç‰¹å®šçš„HTMLå®ä½“(å¦‚ç®­å¤´)æˆPDF?
                ç­”ï¼šç‰¹å®šç¬¦å·å¯ä»¥ä½¿ç”¨ä¸“é—¨çš„å­—ä½“è¡¨ç°ã€‚

            -ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½åµŒå…¥å­—ä½“ç”±äºè®¸å¯è¯çš„é™åˆ¶?
                ç­”ï¼šæœ‰äº›å­—ä½“æ˜¯éœ€è¦ä»˜è´¹è®¸å¯çš„ã€‚

            -pdfHTMLæ”¯æŒå“ªäº›è¯­è¨€?
                ç­”ï¼šåªè¦æä¾›é€‚å½“çš„å­—ä½“ï¼Œå°±æ”¯æŒæ¯ç§è¯­è¨€

            -å¦‚ä½•å°†åŒ…å«é˜¿æ‹‰ä¼¯/å¸Œä¼¯æ¥å­—ç¬¦çš„HTMLè½¬æ¢ä¸ºPDF?
                ç­”ï¼šä½¿ç”¨ä¸“é—¨å­—ä½“ã€‚æ·»åŠ pdfCalligraphç»„ä»¶åˆ°ç±»è·¯å¾„

            -ä¸ºä»€ä¹ˆæˆ‘çš„PDFå°‘äº†å‡ ä¸ªå­—ç¬¦?
                ç­”ï¼šæ‚¨æ²¡æœ‰æä¾›èƒ½å¤Ÿå‘ˆç°è¿™äº›å­—ç¬¦çš„å­—ä½“ã€‚æä¾›å¯¹åº”çš„å­—ä½“å³å¯è§£å†³ã€‚


